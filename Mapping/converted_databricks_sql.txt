CREATE OR REPLACE TEMPORARY VIEW latest_factor_a AS
SELECT
  relnr,
  volgnr,
  FACTA_AMOUNT,
  VALIDFRM,
  facta_jaar,
  RANK() OVER (PARTITION BY relnr, volgnr ORDER BY VALIDFRM DESC) AS rnk
FROM factor_a;


CREATE OR REPLACE TEMPORARY VIEW join_4 AS
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.mutnr_p,
  t1.h_sys_code_op,
  t1.h_sys_code_kap,
  t1.h_sys_code_wp,
  t1.h_djr_bep_code,
  t1.h_status,
  t1.aep_code_p,
  t1.geb_dat_verzek_p,
  t1.geb_dat_verzor_p,
  t1.ct_polis_p,
  t1.verzekde_gesl_cd,
  t1.verzrgde_gesl_cd,
  t1.grpnr,
  t1.versie_nr,
  t1.wyze_bet,
  t1.aanvangs_dat,
  t1.ontslag_dat_p,
  t1.h_post_met_fin,
  t1.h_franch,
  t1.h_inval_ad,
  t1.h_perc_op_1,
  t1.parttime_perc_dt_p,
  t1.h_einddat,
  t1.djr_v_dat_p,
  t1.wzp_inv_std_endlft,
  t1.eindlft_wzp_p,
  t1.is_dekkings_code,
  t1.act_toesl_cat,
  t1.inact_toesl_cat,
  t1.act_toesl_mom,
  t1.inact_toesl_mom,
  t1.act_max_toesl_perc,
  t1.inact_max_toesl_perc,
  t1.act_fin_TYPE,
  t1.inact_fin_TYPE,
  t1.act_maatstaf_TYPE,
  t1.inact_maatstaf_TYPE,
  t1.reglement_aand,
  t2.px_srt_regeling,
  t2.px_status,
  t2.px_TYPE_aanwending,
  t2.px_ingekocht,
  t1.h_eindlft_ip,
  t2.px_te_bereiken,
  t2.px_opgebouwd_kapitaal,
  t2.px_upo_idt_rel_op_boven_verw,
  t2.px_upo_idt_rel_op_volgens_verw,
  t2.px_upo_idt_rel_op_onder_verw,
  t2.px_mpo_idt_rel_op_boven_verw,
  t2.px_mpo_idt_rel_op_volgens_verw,
  t2.px_mpo_idt_rel_op_onder_verw,
  t2.px_pensioenleeftijd,
  t2.px_upo_ind_prog_methode,
  t2.px_mpo_ind_prog_methode,
  t2.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.ltst_mut_dat_p,
  t1.munt_code,
  t1.h_end_age,
  t1.act_min_toesl_perc,
  t1.inact_min_toesl_perc,
  t1.act_maatstaf_peil_mnd,
  t1.inact_maatstaf_peil_mnd,
  t1.vz_vorm_g_1,
  t1.vz_vorm_g_2,
  t1.vz_vorm_g_3,
  t1.vz_vorm_g_4,
  t1.vz_vorm_g_5,
  t1.vz_vorm_g_6,
  t1.vz_vorm_g_7,
  t1.vz_vorm_g_8,
  t1.byz_5_code_herv_p,
  t1.werkgr_nr,
  t1.team_nr,
  t1.echtsch_vereven_code,
  t1.aanw_som_bet_prem_code_p,
  t1.h_tot_som_betaalde_prem,
  t1.tot_verz,
  t1.in_dienst_dat_p,
  t2.px_upo_kap_verw_nominaal,
  t2.px_bedrag_pg,
  t2.px_bedrag_salaris,
  t2.px_bedrag_franchise,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t2.px_upo_idt_nom_op_volgens_verw,
  t2.px_upo_udt_nom_op_volgens_verw,
  t2.px_upo_idt_nom_pp_volgens_verw,
  t2.px_upo_udt_nom_pp_volgens_verw,
  t1.sys_code_opt,
  t1.act_toesl_jr_t0,
  t1.act_verleend_toesl_prc_t0,
  t1.act_regl_maatstaf_perc_t0,
  t1.inact_toesl_jr_t0,
  t1.inact_verleend_toesl_prc_t0,
  t1.inact_regl_maatstaf_perc_t0,
  t1.act_toesl_jr_tmin1,
  t1.act_verleend_toesl_prc_tmin1,
  t1.act_regl_maatstaf_perc_tmin1,
  t1.act_toesl_jr_tmin2,
  t1.act_verleend_toesl_prc_tmin2,
  t1.act_regl_maatstaf_perc_tmin2,
  t1.act_toesl_jr_tmin3,
  t1.act_verleend_toesl_prc_tmin3,
  t1.act_regl_maatstaf_perc_tmin3,
  t1.act_toesl_jr_tmin4,
  t1.act_verleend_toesl_prc_tmin4,
  t1.act_regl_maatstaf_perc_tmin4,
  t1.inact_toesl_jr_tmin1,
  t1.inact_verleend_toesl_prc_tmin1,
  t1.inact_regl_maatstaf_perc_tmin1,
  t1.inact_toesl_jr_tmin2,
  t1.inact_verleend_toesl_prc_tmin2,
  t1.inact_regl_maatstaf_perc_tmin2,
  t1.inact_toesl_jr_tmin3,
  t1.inact_verleend_toesl_prc_tmin3,
  t1.inact_regl_maatstaf_perc_tmin3,
  t1.inact_toesl_jr_tmin4,
  t1.inact_verleend_toesl_prc_tmin4,
  t1.inact_regl_maatstaf_perc_tmin4,
  t1.h_wpr_afwyk_code,
  t1.h_ind_lifelong,
  t2.px_np_in_dnst_volgens_verw,
  t2.px_np_uit_dnst_volgens_verw,
  t1.verwdt_log,
  t1.puv_id,
  t1.byz_4_code_anw_p,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.lego_netto_groep_ind,
  t2.px_mpo_idt_nom_op_volgens_verw,
  t2.px_mpo_idt_nom_pp_volgens_verw,
  t2.px_mpo_udt_nom_op_volgens_verw,
  t2.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.veren_pensg_code,
  t1.tmp_aan_vz_dat_code_3_flag,
  t2.px_mpo_kap_verw_nominaal,
  t1.tmp_vz_dat_1_7,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.bedrijfstak,
  (t1.relnr || '.' || t1.volgnr) AS pb_polis_nummer,
  CASE 
    WHEN t1.h_status = 'ge' THEN 'm5.01'
    ELSE CASE 
      WHEN t1.tmp_srt_pensioen = '02' THEN 'm1.01'
      ELSE CASE 
        WHEN t1.tmp_srt_pensioen = '03' THEN 'm1.01'
        ELSE CASE 
          WHEN t1.tmp_srt_pensioen = '04' AND t1.h_sys_code_kap IN ('1','2','3','4','5','6') THEN 'm2.01'
          ELSE CASE 
            WHEN t1.tmp_srt_pensioen = '04' AND t1.h_sys_code_kap NOT IN ('1','2','3','4','5','6') THEN 'm1.01'
            ELSE CASE 
              WHEN t1.tmp_srt_pensioen = '05' AND t1.h_sys_code_kap IN ('7','8','9','10') THEN 'm2.02'
              ELSE CASE 
                WHEN t1.tmp_srt_pensioen = '05' AND t1.h_sys_code_kap NOT IN ('7','8','9','10') THEN 'm1.02'
                ELSE CASE 
                  WHEN t1.tmp_srt_pensioen = '06' THEN 'm1.01'
                  ELSE 'm1.01'
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_overeenkomst_TYPE_step1,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
         AND t1.aep_code_p IN ('1','2','3') 
         AND t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48' 
    THEN 'm4.01'
    ELSE CASE
      WHEN tmp_overeenkomst_TYPE_step1 = 'm2.01' 
           AND t1.aep_code_p IN ('1','2','3') 
           AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
      THEN 'm4.05'
      ELSE CASE
        WHEN tmp_overeenkomst_TYPE_step1 = 'm2.01' 
             AND t1.aep_code_p IN ('1','2','3') 
             AND t1.vz_cd_pa >= '60' AND t1.vz_cd_pa <= '65' 
             AND t2.px_TYPE_aanwending = '4'
        THEN 'm4.05'
        ELSE CASE
          WHEN tmp_overeenkomst_TYPE_step1 = 'm2.02' 
               AND t1.aep_code_p IN ('1','2','3') 
               AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                    OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
          THEN 'm4.07'
          ELSE CASE
            WHEN tmp_overeenkomst_TYPE_step1 = 'm2.02' 
                 AND t1.aep_code_p IN ('1','2','3') 
                 AND t1.vz_cd_pa >= '60' AND t1.vz_cd_pa <= '65' 
                 AND t2.px_TYPE_aanwending = '4'
            THEN 'm4.07'
            ELSE CASE
              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                   AND t1.aep_code_p IN ('5','6') 
                   AND t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48'
              THEN 'm4.01'
              ELSE CASE
                WHEN tmp_overeenkomst_TYPE_step1 = 'm2.01' 
                     AND t1.aep_code_p IN ('5','6') 
                     AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                          OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
                THEN 'm4.05'
                ELSE CASE
                  WHEN tmp_overeenkomst_TYPE_step1 = 'm2.01' 
                       AND t1.aep_code_p IN ('5','6') 
                       AND t1.vz_cd_pa >= '60' AND t1.vz_cd_pa <= '65' 
                       AND t2.px_TYPE_aanwending = '4'
                  THEN 'm4.05'
                  ELSE CASE
                    WHEN tmp_overeenkomst_TYPE_step1 = 'm2.02' 
                         AND t1.aep_code_p IN ('5','6') 
                         AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                              OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
                    THEN 'm4.07'
                    ELSE CASE
                      WHEN tmp_overeenkomst_TYPE_step1 = 'm2.02' 
                           AND t1.aep_code_p IN ('5','6') 
                           AND t1.vz_cd_pa >= '60' AND t1.vz_cd_pa <= '65' 
                           AND t2.px_TYPE_aanwending = '4'
                      THEN 'm4.07'
                      ELSE CASE
                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                             AND t1.echtsch_vereven_code = '7' 
                             AND (t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                             AND t1.ct_polis_p NOT IN ('8','9')
                        THEN 'm4.01'
                        ELSE CASE
                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                               AND t1.aep_code_p IN ('1','2','3','5','6') 
                               AND t1.h_djr_bep_code = '0'
                          THEN '10'
                          ELSE CASE
                            WHEN t1.h_sys_code_op IN ('1','2') AND t1.h_djr_bep_code = '1'
                            THEN '02'
                            ELSE CASE
                              WHEN t1.h_sys_code_op IN ('1','2') AND t1.h_djr_bep_code IN ('2','3')
                              THEN '03'
                              ELSE CASE
                                WHEN t1.h_sys_code_op IN ('1','2') AND t1.h_djr_bep_code = '4'
                                THEN '10'
                                ELSE CASE
                                  WHEN t1.h_sys_code_op = '3' THEN '06'
                                  ELSE CASE
                                    WHEN t1.h_sys_code_op = '7' THEN '04'
                                    ELSE CASE
                                      WHEN t1.h_sys_code_op IN ('8','9','10','11','12','13') THEN '05'
                                      ELSE CASE
                                        WHEN t1.h_sys_code_op IN ('4','5','6') OR t1.h_sys_code_op > '14' THEN '10'
                                        ELSE CASE
                                          WHEN t1.h_sys_code_op = '14' THEN '07'
                                          ELSE CASE
                                            WHEN t1.h_sys_code_kap IN ('1','2','3','4','5','6') THEN '04'
                                            ELSE CASE
                                              WHEN t1.h_sys_code_kap IN ('7','8','9','10') THEN '05'
                                              ELSE CASE
                                                WHEN t1.h_sys_code_wp IN ('1','2') AND t1.h_djr_bep_code = '0' THEN '10'
                                                ELSE CASE
                                                  WHEN t1.h_sys_code_wp IN ('1','2') AND t1.h_djr_bep_code = '1' THEN '02'
                                                  ELSE CASE
                                                    WHEN t1.h_sys_code_wp IN ('1','2') AND t1.h_djr_bep_code IN ('2','3') THEN '03'
                                                    ELSE CASE
                                                      WHEN t1.h_sys_code_wp IN ('1','2') AND t1.h_djr_bep_code = '4' THEN '10'
                                                      ELSE CASE
                                                        WHEN t1.h_sys_code_wp = '3' THEN '06'
                                                        ELSE CASE
                                                          WHEN t1.h_sys_code_wp = '7' THEN '04'
                                                          ELSE CASE
                                                            WHEN t1.h_sys_code_wp IN ('10','11','12','13') THEN '05'
                                                            ELSE CASE
                                                              WHEN t1.h_sys_code_wp IN ('4','5','6','8','9') OR t1.h_sys_code_op > '13' 
                                                              THEN '10'
                                                              ELSE CASE
                                                                WHEN t1.sys_code_opt <> '0' THEN '06'
                                                                ELSE '10'
                                                              END
                                                            END
                                                          END
                                                        END
                                                      END
                                                    END
                                                  END
                                                END
                                              END
                                            END
                                          END
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_srt_pensioen,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
         AND t1.aep_code_p IN ('1','2','3') 
    THEN 'y'
    ELSE CASE
      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
           AND t1.aep_code_p IN ('1','2','3')
      THEN 'y'
      ELSE CASE
        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
             AND t1.aep_code_p IN ('5','6') 
             AND t1.vz_cd_pa IN ('61','65') 
             AND t2.px_TYPE_aanwending IN ('1','2','3')
        THEN 'y'
        ELSE CASE
          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
               AND t1.aep_code_p IN ('5','6') 
               AND t1.vz_cd_pa IN ('60','62','63','64') 
               AND t2.px_TYPE_aanwending = '3'
          THEN 'y'
          ELSE 'n'
        END
      END
    END
  END AS tmp_ind_split_policy_divorce,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' AND t1.aep_code_p = '0' THEN '1'
    ELSE CASE
      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' AND t1.aep_code_p = '0' THEN '1'
      ELSE CASE
        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
             AND t1.aep_code_p IN ('1','2','3') 
             AND t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48' 
        THEN '2'
        ELSE CASE
          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
               AND t1.aep_code_p IN ('1','2','3') 
               AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48') 
          THEN '1'
          ELSE CASE
            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                 AND t1.aep_code_p IN ('1','2','3') 
                 AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                      OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
            THEN '2'
            ELSE CASE
              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                   AND t1.aep_code_p IN ('1','2','3') 
                   AND t1.vz_cd_pa IN ('61','65') 
                   AND t2.px_TYPE_aanwending IN ('1','2')
              THEN '1'
              ELSE CASE
                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                     AND t1.aep_code_p IN ('1','2','3') 
                     AND t1.vz_cd_pa IN ('61','65') 
                     AND t2.px_TYPE_aanwending = '3'
                THEN '1'
                ELSE CASE
                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                       AND t1.aep_code_p IN ('1','2','3') 
                       AND t1.vz_cd_pa IN ('61','65') 
                       AND t2.px_TYPE_aanwending = '4'
                  THEN '2'
                  ELSE CASE
                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                         AND t1.aep_code_p IN ('1','2','3') 
                         AND t1.vz_cd_pa IN ('60','62','63','64') 
                         AND t2.px_TYPE_aanwending IN ('1','2')
                    THEN '1'
                    ELSE CASE
                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                           AND t1.aep_code_p IN ('1','2','3') 
                           AND t1.vz_cd_pa IN ('60','62','63','64') 
                           AND t2.px_TYPE_aanwending = '3'
                      THEN '1'
                      ELSE CASE
                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                             AND t1.aep_code_p IN ('1','2','3') 
                             AND t1.vz_cd_pa IN ('60','62','63','64') 
                             AND t2.px_TYPE_aanwending = '4'
                        THEN '2'
                        ELSE CASE
                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                               AND t1.aep_code_p IN ('1','2','3')
                          THEN '1'
                          ELSE CASE
                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                 AND t1.aep_code_p IN ('4','7','8','9')
                            THEN '1'
                            ELSE CASE
                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                   AND t1.aep_code_p IN ('4','7','8','9')
                              THEN '1'
                              ELSE CASE
                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                     AND t1.aep_code_p IN ('5','6') 
                                     AND t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48'
                                THEN '2'
                                ELSE CASE
                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                       AND t1.aep_code_p IN ('5','6') 
                                       AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48')
                                  THEN '1'
                                  ELSE CASE
                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                         AND t1.aep_code_p IN ('5','6') 
                                         AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                                              OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
                                    THEN '2'
                                    ELSE CASE
                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                           AND t1.aep_code_p IN ('5','6') 
                                           AND t1.vz_cd_pa IN ('61','65') 
                                           AND t2.px_TYPE_aanwending IN ('1','2')
                                      THEN '1'
                                      ELSE CASE
                                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                             AND t1.aep_code_p IN ('5','6') 
                                             AND t1.vz_cd_pa IN ('61','65') 
                                             AND t2.px_TYPE_aanwending = '3'
                                        THEN '1'
                                        ELSE CASE
                                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                               AND t1.aep_code_p IN ('5','6') 
                                               AND t1.vz_cd_pa IN ('61','65') 
                                               AND t2.px_TYPE_aanwending = '4'
                                          THEN '2'
                                          ELSE CASE
                                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                 AND t1.aep_code_p IN ('5','6') 
                                                 AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                 AND t2.px_TYPE_aanwending IN ('1','2')
                                            THEN '1'
                                            ELSE CASE
                                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                   AND t1.aep_code_p IN ('5','6') 
                                                   AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                   AND t2.px_TYPE_aanwending = '3'
                                              THEN '1'
                                              ELSE CASE
                                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                     AND t1.aep_code_p IN ('5','6') 
                                                     AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                     AND t2.px_TYPE_aanwending = '4'
                                                THEN '2'
                                                ELSE CASE
                                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                       AND t1.aep_code_p IN ('5','6')
                                                  THEN '1'
                                                  ELSE CASE
                                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                         AND t1.echtsch_vereven_code = '7' 
                                                         AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48') 
                                                         AND t1.ct_polis_p NOT IN ('8','9')
                                                    THEN '2'
                                                    ELSE CASE
                                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                           AND t1.echtsch_vereven_code = '7' 
                                                           AND (t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                                                           AND t1.ct_polis_p NOT IN ('8','9')
                                                      THEN '2'
                                                      ELSE CASE
                                                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                             AND t1.echtsch_vereven_code = '6' 
                                                             AND t1.vz_cd_pa >= '11' 
                                                             AND t1.vz_cd_pa <= '17'
                                                        THEN '1'
                                                        ELSE CASE
                                                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                               AND t1.aep_code_p NOT IN ('1','2','3','5','6') 
                                                               AND t1.vz_cd_pa >= '11' 
                                                               AND t1.vz_cd_pa <= '17'
                                                          THEN '1'
                                                          ELSE CASE
                                                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                 AND t1.aep_code_p IN ('1','2','3','5','6') 
                                                                 AND t1.vz_cd_pa >= '11' 
                                                                 AND t1.vz_cd_pa <= '17'
                                                            THEN '1'
                                                            ELSE CASE
                                                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                   AND t1.aep_code_p IN ('1','2','3','5','6')
                                                              THEN '2'
                                                              ELSE CASE
                                                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                     AND t1.aep_code_p IN ('1','2','3','5','6')
                                                                THEN '1'
                                                                ELSE CASE
                                                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                       AND t1.aep_code_p NOT IN ('1','2','3','5','6')
                                                                  THEN '1'
                                                                  ELSE CASE
                                                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                         AND t1.aep_code_p NOT IN ('1','2','3','5','6')
                                                                    THEN '1'
                                                                    ELSE CASE
                                                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                           AND t1.ct_polis_p IN ('8','9')
                                                                      THEN '2'
                                                                      ELSE ''
                                                                    END
                                                                  END
                                                                END
                                                              END
                                                            END
                                                          END
                                                        END
                                                      END
                                                    END
                                                  END
                                                END
                                              END
                                            END
                                          END
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_ind_recipient,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' AND t1.aep_code_p = '0' THEN 'f'
    ELSE CASE
      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' AND t1.aep_code_p = '0' THEN 'f'
      ELSE CASE
        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
             AND t1.aep_code_p IN ('1','2','3') 
             AND t1.vz_cd_pa >= '20' 
             AND t1.vz_cd_pa <= '48' 
        THEN 't'
        ELSE CASE
          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
               AND t1.aep_code_p IN ('1','2','3') 
               AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48')
          THEN 't'
          ELSE CASE
            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                 AND t1.aep_code_p IN ('1','2','3') 
                 AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                      OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
            THEN 't'
            ELSE CASE
              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                   AND t1.aep_code_p IN ('1','2','3') 
                   AND t1.vz_cd_pa IN ('61','65') 
                   AND t2.px_TYPE_aanwending IN ('1','2')
              THEN 't'
              ELSE CASE
                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                     AND t1.aep_code_p IN ('1','2','3') 
                     AND t1.vz_cd_pa IN ('61','65') 
                     AND t2.px_TYPE_aanwending = '3'
                THEN 't'
                ELSE CASE
                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                       AND t1.aep_code_p IN ('1','2','3') 
                       AND t1.vz_cd_pa IN ('61','65') 
                       AND t2.px_TYPE_aanwending = '4'
                  THEN 't'
                  ELSE CASE
                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                         AND t1.aep_code_p IN ('1','2','3') 
                         AND t1.vz_cd_pa IN ('60','62','63','64') 
                         AND t2.px_TYPE_aanwending IN ('1','2')
                    THEN 't'
                    ELSE CASE
                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                           AND t1.aep_code_p IN ('1','2','3') 
                           AND t1.vz_cd_pa IN ('60','62','63','64') 
                           AND t2.px_TYPE_aanwending = '3'
                      THEN 't'
                      ELSE CASE
                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                             AND t1.aep_code_p IN ('1','2','3') 
                             AND t1.vz_cd_pa IN ('60','62','63','64') 
                             AND t2.px_TYPE_aanwending = '4'
                        THEN 't'
                        ELSE CASE
                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                               AND t1.aep_code_p IN ('1','2','3')
                          THEN 't'
                          ELSE CASE
                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                 AND t1.aep_code_p IN ('4','7','8','9')
                            THEN 'f'
                            ELSE CASE
                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                   AND t1.aep_code_p IN ('4','7','8','9')
                              THEN 'f'
                              ELSE CASE
                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                     AND t1.aep_code_p IN ('5','6') 
                                     AND t1.vz_cd_pa >= '20' 
                                     AND t1.vz_cd_pa <= '48'
                                THEN 't'
                                ELSE CASE
                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm1' 
                                       AND t1.aep_code_p IN ('5','6') 
                                       AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48')
                                  THEN 't'
                                  ELSE CASE
                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                         AND t1.aep_code_p IN ('5','6') 
                                         AND ((t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                                              OR (t1.vz_cd_pa >= '66' AND t1.vz_cd_pa <= '69'))
                                    THEN 't'
                                    ELSE CASE
                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                           AND t1.aep_code_p IN ('5','6') 
                                           AND t1.vz_cd_pa IN ('61','65') 
                                           AND t2.px_TYPE_aanwending IN ('1','2')
                                      THEN 't'
                                      ELSE CASE
                                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                             AND t1.aep_code_p IN ('5','6') 
                                             AND t1.vz_cd_pa IN ('61','65') 
                                             AND t2.px_TYPE_aanwending = '3'
                                        THEN 't'
                                        ELSE CASE
                                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                               AND t1.aep_code_p IN ('5','6') 
                                               AND t1.vz_cd_pa IN ('61','65') 
                                               AND t2.px_TYPE_aanwending = '4'
                                          THEN 't'
                                          ELSE CASE
                                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                 AND t1.aep_code_p IN ('5','6') 
                                                 AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                 AND t2.px_TYPE_aanwending IN ('1','2')
                                            THEN 't'
                                            ELSE CASE
                                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                   AND t1.aep_code_p IN ('5','6') 
                                                   AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                   AND t2.px_TYPE_aanwending = '3'
                                              THEN 't'
                                              ELSE CASE
                                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                     AND t1.aep_code_p IN ('5','6') 
                                                     AND t1.vz_cd_pa IN ('60','62','63','64') 
                                                     AND t2.px_TYPE_aanwending = '4'
                                                THEN 't'
                                                ELSE CASE
                                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm2' 
                                                       AND t1.aep_code_p IN ('5','6')
                                                  THEN 't'
                                                  ELSE CASE
                                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                         AND t1.echtsch_vereven_code = '7' 
                                                         AND (t1.vz_cd_pa < '20' OR t1.vz_cd_pa > '48') 
                                                         AND t1.ct_polis_p NOT IN ('8','9')
                                                    THEN 't'
                                                    ELSE CASE
                                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                           AND t1.echtsch_vereven_code = '7' 
                                                           AND (t1.vz_cd_pa >= '20' AND t1.vz_cd_pa <= '48') 
                                                           AND t1.ct_polis_p NOT IN ('8','9')
                                                      THEN 't'
                                                      ELSE CASE
                                                        WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                             AND t1.echtsch_vereven_code = '6' 
                                                             AND t1.vz_cd_pa >= '11' 
                                                             AND t1.vz_cd_pa <= '17'
                                                        THEN 'f'
                                                        ELSE CASE
                                                          WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                               AND t1.aep_code_p NOT IN ('1','2','3','5','6') 
                                                               AND t1.vz_cd_pa >= '11' 
                                                               AND t1.vz_cd_pa <= '17'
                                                          THEN 'f'
                                                          ELSE CASE
                                                            WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                 AND t1.aep_code_p IN ('1','2','3','5','6') 
                                                                 AND t1.vz_cd_pa >= '11' 
                                                                 AND t1.vz_cd_pa <= '17'
                                                            THEN 't'
                                                            ELSE CASE
                                                              WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                   AND t1.aep_code_p IN ('1','2','3','5','6')
                                                              THEN 't'
                                                              ELSE CASE
                                                                WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                     AND t1.aep_code_p IN ('1','2','3','5','6')
                                                                THEN 't'
                                                                ELSE CASE
                                                                  WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                       AND t1.aep_code_p NOT IN ('1','2','3','5','6')
                                                                  THEN 'f'
                                                                  ELSE CASE
                                                                    WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                         AND t1.aep_code_p NOT IN ('1','2','3','5','6')
                                                                    THEN 'f'
                                                                    ELSE CASE
                                                                      WHEN LEFT(tmp_overeenkomst_TYPE_step1,2) = 'm5' 
                                                                           AND t1.ct_polis_p IN ('8','9')
                                                                      THEN 'f'
                                                                      ELSE ''
                                                                    END
                                                                  END
                                                                END
                                                              END
                                                            END
                                                          END
                                                        END
                                                      END
                                                    END
                                                  END
                                                END
                                              END
                                            END
                                          END
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_ind_PARTNER_is_exPARTNER,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
         AND t1.aep_code_p IN ('0') 
         AND t1.vz_cd_pa >= '60' 
         AND t1.vz_cd_pa <= '71'
    THEN 'y'
    ELSE CASE
      WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
           AND t1.aep_code_p IN ('1','2','3') 
           AND t1.vz_cd_pa IN ('61','65') 
           AND t2.px_TYPE_aanwending IN ('1','2','3')
      THEN 'y'
      ELSE CASE
        WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
             AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
             AND t1.aep_code_p IN ('1','2','3') 
             AND t1.vz_cd_pa IN ('61','65') 
             AND t2.px_TYPE_aanwending = '4'
        THEN 'y'
        ELSE CASE
          WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
               AND t1.aep_code_p IN ('1','2','3') 
               AND t1.vz_cd_pa IN ('60','62','63','64') 
               AND t2.px_TYPE_aanwending IN ('1','2','3')
          THEN 'y'
          ELSE CASE
            WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                 AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                 AND t1.aep_code_p IN ('1','2','3') 
                 AND t1.vz_cd_pa IN ('60','62','63','64') 
                 AND t2.px_TYPE_aanwending = '4'
            THEN 'y'
            ELSE CASE
              WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                   AND t1.aep_code_p IN ('1','2','3') 
                   AND t1.vz_cd_pa IN ('70','71')
              THEN 'y'
              ELSE CASE
                WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                     AND t1.aep_code_p IN ('4','7','8','9') 
                     AND t1.vz_cd_pa >= '60' 
                     AND t1.vz_cd_pa <= '71'
                THEN 'y'
                ELSE CASE
                  WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                       AND t1.aep_code_p IN ('5','6') 
                       AND t1.vz_cd_pa IN ('61','65') 
                       AND t2.px_TYPE_aanwending IN ('1','2','3')
                  THEN 'y'
                  ELSE CASE
                    WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                         AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                         AND t1.aep_code_p IN ('5','6') 
                         AND t1.vz_cd_pa IN ('61','65') 
                         AND t2.px_TYPE_aanwending = '4'
                    THEN 'y'
                    ELSE CASE
                      WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                           AND t1.aep_code_p IN ('5','6') 
                           AND t1.vz_cd_pa IN ('60','62','63','64') 
                           AND t2.px_TYPE_aanwending IN ('1','2','3')
                      THEN 'y'
                      ELSE CASE
                        WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                             AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                             AND t1.aep_code_p IN ('5','6') 
                             AND t1.vz_cd_pa IN ('60','62','63','64') 
                             AND t2.px_TYPE_aanwending = '4'
                        THEN 'y'
                        ELSE 'n'
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_ind_kapitaal_bij_leven,
  CASE 
    WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
         AND t1.aep_code_p IN ('0') 
         AND t1.vz_cd_pa >= '60' 
         AND t1.vz_cd_pa <= '71'
    THEN 'y'
    ELSE CASE
      WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
           AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
           AND t1.aep_code_p IN ('1','2','3') 
           AND t1.vz_cd_pa IN ('66','67','68','69','70','71')
      THEN 'y'
      ELSE CASE
        WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
             AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
             AND t1.aep_code_p IN ('1','2','3') 
             AND t1.vz_cd_pa IN ('61','65') 
             AND t2.px_TYPE_aanwending = '4'
        THEN 'y'
        ELSE CASE
          WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
               AND t1.aep_code_p IN ('1','2','3') 
               AND t1.vz_cd_pa IN ('60','62','63','64') 
               AND t2.px_TYPE_aanwending IN ('1','2')
          THEN 'y'
          ELSE CASE
            WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                 AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                 AND t1.aep_code_p IN ('1','2','3') 
                 AND t1.vz_cd_pa IN ('60','62','63','64') 
                 AND t2.px_TYPE_aanwending = '4'
            THEN 'y'
            ELSE CASE
              WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                   AND t1.aep_code_p IN ('1','2','3') 
                   AND t1.vz_cd_pa IN ('70','71')
              THEN 'y'
              ELSE CASE
                WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                     AND t1.aep_code_p IN ('4','7','8','9') 
                     AND t1.vz_cd_pa >= '60' 
                     AND t1.vz_cd_pa <= '71'
                THEN 'y'
                ELSE CASE
                  WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                       AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                       AND t1.aep_code_p IN ('5','6') 
                       AND t1.vz_cd_pa IN ('66','67','68','69','70','71')
                  THEN 'y'
                  ELSE CASE
                    WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                         AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                         AND t1.aep_code_p IN ('5','6') 
                         AND t1.vz_cd_pa IN ('61','65') 
                         AND t2.px_TYPE_aanwending = '4'
                    THEN 'y'
                    ELSE CASE
                      WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                           AND t1.aep_code_p IN ('5','6') 
                           AND t1.vz_cd_pa IN ('60','62','63','64') 
                           AND t2.px_TYPE_aanwending IN ('1','2')
                      THEN 'y'
                      ELSE CASE
                        WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm4' 
                             AND LEFT(tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2') 
                             AND t1.aep_code_p IN ('5','6') 
                             AND t1.vz_cd_pa IN ('60','62','63','64') 
                             AND t2.px_TYPE_aanwending = '4'
                        THEN 'y'
                        ELSE CASE
                          WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) = 'm2' 
                               AND t1.aep_code_p IN ('5','6') 
                               AND t1.vz_cd_pa IN ('70','71')
                          THEN 'y'
                          ELSE 'n'
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_ind_kapitaal_bij_overlijden
FROM
  lego_base t1
  LEFT JOIN px_base t2 
    ON t1.relnr = t2.relnr
   AND t1.volgnr = t2.volgnr
   AND t1.vz_cd_pa = t2.vz_cd_pa
   AND t1.run_id = t2.run_id
   AND t1.reference_date = t2.reference_date
   AND t1.verwdt = t2.verwdt;


CREATE OR REPLACE TEMPORARY VIEW px_base AS
SELECT DISTINCT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  reference_date,
  verwdt,
  px_srt_regeling,
  px_status,
  px_TYPE_aanwending,
  px_ingekocht,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  px_upo_kap_verw_nominaal,
  px_bedrag_salaris,
  px_bedrag_franchise,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  px_bedrag_pg,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  px_mpo_kap_verw_nominaal
FROM `cv_out_z21_o953_px_base`;


CREATE OR REPLACE TEMPORARY VIEW lego_base AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  mutnr_p,
  h_sys_code_op,
  h_sys_code_kap,
  h_sys_code_wp,
  h_djr_bep_code,
  h_status,
  aep_code_p,
  geb_dat_verzek_p,
  geb_dat_verzor_p,
  ct_polis_p,
  verzekde_gesl_cd,
  verzrgde_gesl_cd,
  grpnr,
  versie_nr,
  wyze_bet,
  aanvangs_dat,
  ontslag_dat_p,
  h_post_met_fin,
  h_franch,
  h_inval_ad,
  h_perc_op_1,
  parttime_perc_dt_p,
  h_einddat,
  djr_v_dat_p,
  wzp_inv_std_endlft,
  eindlft_wzp_p,
  is_dekkings_code,
  act_toesl_cat,
  inact_toesl_cat,
  act_toesl_mom,
  inact_toesl_mom,
  act_max_toesl_perc,
  inact_max_toesl_perc,
  act_fin_TYPE,
  inact_fin_TYPE,
  act_maatstaf_TYPE,
  inact_maatstaf_TYPE,
  reglement_aand,
  h_eindlft_ip,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  ltst_mut_dat_p,
  munt_code,
  h_end_age,
  act_min_toesl_perc,
  inact_min_toesl_perc,
  act_maatstaf_peil_mnd,
  inact_maatstaf_peil_mnd,
  vz_vorm_g_1,
  vz_vorm_g_2,
  vz_vorm_g_3,
  vz_vorm_g_4,
  vz_vorm_g_5,
  vz_vorm_g_6,
  vz_vorm_g_7,
  vz_vorm_g_8,
  byz_5_code_herv_p,
  werkgr_nr,
  team_nr,
  echtsch_vereven_code,
  aanw_som_bet_prem_code_p,
  h_tot_som_betaalde_prem,
  tot_verz,
  in_dienst_dat_p,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  sys_code_opt,
  act_toesl_jr_t0,
  act_verleend_toesl_prc_t0,
  act_regl_maatstaf_perc_t0,
  inact_toesl_jr_t0,
  inact_verleend_toesl_prc_t0,
  inact_regl_maatstaf_perc_t0,
  act_toesl_jr_tmin1,
  act_verleend_toesl_prc_tmin1,
  act_regl_maatstaf_perc_tmin1,
  act_toesl_jr_tmin2,
  act_verleend_toesl_prc_tmin2,
  act_regl_maatstaf_perc_tmin2,
  act_toesl_jr_tmin3,
  act_regl_maatstaf_perc_tmin3,
  act_verleend_toesl_prc_tmin3,
  act_toesl_jr_tmin4,
  act_verleend_toesl_prc_tmin4,
  act_regl_maatstaf_perc_tmin4,
  inact_toesl_jr_tmin1,
  inact_verleend_toesl_prc_tmin1,
  inact_regl_maatstaf_perc_tmin1,
  inact_toesl_jr_tmin2,
  inact_verleend_toesl_prc_tmin2,
  inact_regl_maatstaf_perc_tmin2,
  inact_toesl_jr_tmin3,
  inact_verleend_toesl_prc_tmin3,
  inact_regl_maatstaf_perc_tmin3,
  inact_toesl_jr_tmin4,
  inact_verleend_toesl_prc_tmin4,
  inact_regl_maatstaf_perc_tmin4,
  h_wpr_afwyk_code,
  h_ind_lifelong,
  verwdt_log,
  puv_id,
  byz_4_code_anw_p,
  h_eindlft_op,
  eindlft_pr_bet_wp,
  lego_netto_groep_ind,
  ct_vz,
  h_eindlft_vz_datum,
  vz_dat_v_1,
  vz_dat_v_2,
  vz_dat_v_3,
  vz_dat_v_4,
  vz_dat_v_5,
  vz_dat_v_6,
  vz_dat_v_7,
  vz_dat_v_8,
  vz_dat_code_v_1,
  vz_dat_code_v_2,
  vz_dat_code_v_3,
  vz_dat_code_v_4,
  vz_dat_code_v_5,
  vz_dat_code_v_6,
  vz_dat_code_v_7,
  vz_dat_code_v_8,
  veren_pensg_code,
  h_base_create_ind,
  afgel_wzp_verz_p,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  upo_verv_code,
  soort_rel_code,
  bedrijfstak,
  invalid_ind,
  CASE
    WHEN vz_dat_code_v_1 = 't' THEN vz_dat_v_1
    WHEN vz_dat_code_v_2 = 't' THEN vz_dat_v_2
    WHEN vz_dat_code_v_3 = 't' THEN vz_dat_v_3
    WHEN vz_dat_code_v_4 = 't' THEN vz_dat_v_4
    WHEN vz_dat_code_v_5 = 't' THEN vz_dat_v_5
    WHEN vz_dat_code_v_6 = 't' THEN vz_dat_v_6
    WHEN vz_dat_code_v_7 = 't' THEN vz_dat_v_7
    WHEN vz_dat_code_v_8 = 't' THEN vz_dat_v_8
    ELSE ''
  END AS tmp_uit_vz_dat_pre,
  CASE
    WHEN vz_dat_code_v_1 = '5' THEN vz_dat_v_1
    WHEN vz_dat_code_v_2 = '5' THEN vz_dat_v_2
    WHEN vz_dat_code_v_3 = '5' THEN vz_dat_v_3
    WHEN vz_dat_code_v_4 = '5' THEN vz_dat_v_4
    WHEN vz_dat_code_v_5 = '5' THEN vz_dat_v_5
    WHEN vz_dat_code_v_6 = '5' THEN vz_dat_v_6
    WHEN vz_dat_code_v_7 = '5' THEN vz_dat_v_7
    WHEN vz_dat_code_v_8 = '5' THEN vz_dat_v_8
    ELSE ''
  END AS tmp_aan_vz_dat_code_5,
  CASE
    WHEN vz_dat_code_v_1 = 'n' THEN vz_dat_v_1
    WHEN vz_dat_code_v_2 = 'n' THEN vz_dat_v_2
    WHEN vz_dat_code_v_3 = 'n' THEN vz_dat_v_3
    WHEN vz_dat_code_v_4 = 'n' THEN vz_dat_v_4
    WHEN vz_dat_code_v_5 = 'n' THEN vz_dat_v_5
    WHEN vz_dat_code_v_6 = 'n' THEN vz_dat_v_6
    WHEN vz_dat_code_v_7 = 'n' THEN vz_dat_v_7
    WHEN vz_dat_code_v_8 = 'n' THEN vz_dat_v_8
    ELSE ''
  END AS tmp_aan_vz_dat_code_n,
  CASE
    WHEN vz_dat_code_v_1 = '3' THEN 'x'
    WHEN vz_dat_code_v_2 = '3' THEN 'x'
    WHEN vz_dat_code_v_3 = '3' THEN 'x'
    WHEN vz_dat_code_v_4 = '3' THEN 'x'
    WHEN vz_dat_code_v_5 = '3' THEN 'x'
    WHEN vz_dat_code_v_6 = '3' THEN 'x'
    WHEN vz_dat_code_v_7 = '3' THEN 'x'
    WHEN vz_dat_code_v_8 = '3' THEN 'x'
    ELSE ''
  END AS tmp_aan_vz_dat_code_3_flag,
  CASE
    WHEN vz_dat_code_v_1 = '1' THEN vz_dat_v_1
    WHEN vz_dat_code_v_2 = '1' THEN vz_dat_v_2
    WHEN vz_dat_code_v_3 = '1' THEN vz_dat_v_3
    WHEN vz_dat_code_v_4 = '1' THEN vz_dat_v_4
    WHEN vz_dat_code_v_5 = '1' THEN vz_dat_v_5
    WHEN vz_dat_code_v_6 = '1' THEN vz_dat_v_6
    WHEN vz_dat_code_v_7 = '1' THEN vz_dat_v_7
    WHEN vz_dat_code_v_8 = '1' THEN vz_dat_v_8
    ELSE ''
  END AS tmp_vz_dat_code_1,
  CASE
    WHEN vz_dat_code_v_1 = '7' THEN vz_dat_v_1
    WHEN vz_dat_code_v_2 = '7' THEN vz_dat_v_2
    WHEN vz_dat_code_v_3 = '7' THEN vz_dat_v_3
    WHEN vz_dat_code_v_4 = '7' THEN vz_dat_v_4
    WHEN vz_dat_code_v_5 = '7' THEN vz_dat_v_5
    WHEN vz_dat_code_v_6 = '7' THEN vz_dat_v_6
    WHEN vz_dat_code_v_7 = '7' THEN vz_dat_v_7
    WHEN vz_dat_code_v_8 = '7' THEN vz_dat_v_8
    ELSE ''
  END AS tmp_vz_dat_code_7,
  CASE
    WHEN NOT(tmp_vz_dat_code_1 IS NULL) AND dats_is_valid(tmp_vz_dat_code_1) THEN tmp_vz_dat_code_1
    WHEN NOT(tmp_vz_dat_code_7 IS NULL) AND dats_is_valid(tmp_vz_dat_code_7) THEN tmp_vz_dat_code_7
    ELSE ''
  END AS tmp_vz_dat_1_7
FROM
  cv_out_z21_o951_base
WHERE
  run_TYPE != 'd'
  OR (run_TYPE = 'd' AND invalid_ind != 'x')

CREATE OR REPLACE TEMPORARY VIEW union_1 AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  mutnr_p,
  h_sys_code_op,
  h_sys_code_kap,
  h_sys_code_wp,
  h_djr_bep_code,
  h_status,
  aep_code_p,
  geb_dat_verzek_p,
  geb_dat_verzor_p,
  ct_polis_p,
  verzekde_gesl_cd,
  verzrgde_gesl_cd,
  grpnr,
  versie_nr,
  wyze_bet,
  aanvangs_dat,
  ontslag_dat_p,
  h_post_met_fin,
  h_franch,
  h_inval_ad,
  h_perc_op_1,
  parttime_perc_dt_p,
  h_einddat,
  djr_v_dat_p,
  wzp_inv_std_endlft,
  eindlft_wzp_p,
  is_dekkings_code,
  act_toesl_cat,
  inact_toesl_cat,
  act_toesl_mom,
  inact_toesl_mom,
  act_max_toesl_perc,
  inact_max_toesl_perc,
  act_fin_TYPE,
  inact_fin_TYPE,
  act_maatstaf_TYPE,
  inact_maatstaf_TYPE,
  reglement_aand,
  px_srt_regeling,
  px_status,
  px_TYPE_aanwending,
  px_ingekocht,
  h_eindlft_ip,
  pb_polis_nummer,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  ltst_mut_dat_p,
  munt_code,
  h_end_age,
  act_min_toesl_perc,
  inact_min_toesl_perc,
  act_maatstaf_peil_mnd,
  inact_maatstaf_peil_mnd,
  vz_vorm_g_1,
  vz_vorm_g_2,
  vz_vorm_g_3,
  vz_vorm_g_4,
  vz_vorm_g_5,
  vz_vorm_g_6,
  vz_vorm_g_7,
  vz_vorm_g_8,
  byz_5_code_herv_p,
  werkgr_nr,
  team_nr,
  echtsch_vereven_code,
  aanw_som_bet_prem_code_p,
  h_tot_som_betaalde_prem,
  tot_verz,
  in_dienst_dat_p,
  px_upo_kap_verw_nominaal,
  px_bedrag_salaris,
  px_bedrag_franchise,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  act_toesl_jr_t0,
  act_verleend_toesl_prc_t0,
  act_regl_maatstaf_perc_t0,
  inact_toesl_jr_t0,
  inact_verleend_toesl_prc_t0,
  inact_regl_maatstaf_perc_t0,
  act_toesl_jr_tmin1,
  act_verleend_toesl_prc_tmin1,
  act_regl_maatstaf_perc_tmin1,
  act_toesl_jr_tmin2,
  act_verleend_toesl_prc_tmin2,
  act_regl_maatstaf_perc_tmin2,
  act_toesl_jr_tmin3,
  act_regl_maatstaf_perc_tmin3,
  act_verleend_toesl_prc_tmin3,
  act_toesl_jr_tmin4,
  act_verleend_toesl_prc_tmin4,
  act_regl_maatstaf_perc_tmin4,
  inact_toesl_jr_tmin1,
  inact_verleend_toesl_prc_tmin1,
  inact_regl_maatstaf_perc_tmin1,
  inact_toesl_jr_tmin2,
  inact_verleend_toesl_prc_tmin2,
  inact_regl_maatstaf_perc_tmin2,
  inact_toesl_jr_tmin3,
  inact_verleend_toesl_prc_tmin3,
  inact_regl_maatstaf_perc_tmin3,
  inact_toesl_jr_tmin4,
  inact_verleend_toesl_prc_tmin4,
  inact_regl_maatstaf_perc_tmin4,
  h_wpr_afwyk_code,
  h_ind_lifelong,
  sys_code_opt,
  tmp_overeenkomst_TYPE_step1 pb_overeenkomst_TYPE_step1,
  `_____________________`,
  tmp_srt_pensioen,
  tmp_overeenkomst_TYPE_step2 pb_overeenkomst_TYPE_step2,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  puv_id,
  px_bedrag_pg,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  tmp_ind_split_policy_divorce,
  byz_4_code_anw_p,
  h_eindlft_op,
  eindlft_pr_bet_wp,
  lego_netto_groep_ind,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  px_mpo_kap_verw_nominaal,
  ct_vz,
  h_eindlft_vz_datum,
  tmp_uit_vz_dat_pre,
  tmp_aan_vz_dat_code_5,
  tmp_aan_vz_dat_code_n,
  veren_pensg_code,
  tmp_aan_vz_dat_code_3_flag,
  tmp_vz_dat_1_7,
  naam,
  ondnr,
  niet_pw_contract,
  upo_verv_code,
  soort_rel_code,
  verk_naam,
  bedrijfstak
FROM
  join_4

UNION ALL

SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  mutnr_p,
  h_sys_code_op,
  h_sys_code_kap,
  h_sys_code_wp,
  h_djr_bep_code,
  h_status,
  aep_code_p,
  geb_dat_verzek_p,
  geb_dat_verzor_p,
  ct_polis_p,
  verzekde_gesl_cd,
  verzrgde_gesl_cd,
  grpnr,
  versie_nr,
  wyze_bet,
  aanvangs_dat,
  ontslag_dat_p,
  h_post_met_fin,
  h_franch,
  h_inval_ad,
  h_perc_op_1,
  parttime_perc_dt_p,
  h_einddat,
  djr_v_dat_p,
  wzp_inv_std_endlft,
  eindlft_wzp_p,
  is_dekkings_code,
  act_toesl_cat,
  inact_toesl_cat,
  act_toesl_mom,
  inact_toesl_mom,
  act_max_toesl_perc,
  inact_max_toesl_perc,
  act_fin_TYPE,
  inact_fin_TYPE,
  act_maatstaf_TYPE,
  inact_maatstaf_TYPE,
  reglement_aand,
  px_srt_regeling,
  px_status,
  px_TYPE_aanwending,
  px_ingekocht,
  h_eindlft_ip,
  pb_polis_nummer,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  ltst_mut_dat_p,
  munt_code,
  h_end_age,
  act_min_toesl_perc,
  inact_min_toesl_perc,
  act_maatstaf_peil_mnd,
  inact_maatstaf_peil_mnd,
  vz_vorm_g_1,
  vz_vorm_g_2,
  vz_vorm_g_3,
  vz_vorm_g_4,
  vz_vorm_g_5,
  vz_vorm_g_6,
  vz_vorm_g_7,
  vz_vorm_g_8,
  byz_5_code_herv_p,
  werkgr_nr,
  team_nr,
  echtsch_vereven_code,
  aanw_som_bet_prem_code_p,
  h_tot_som_betaalde_prem,
  tot_verz,
  in_dienst_dat_p,
  px_upo_kap_verw_nominaal,
  px_bedrag_salaris,
  px_bedrag_franchise,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  act_toesl_jr_t0,
  act_verleend_toesl_prc_t0,
  act_regl_maatstaf_perc_t0,
  inact_toesl_jr_t0,
  inact_verleend_toesl_prc_t0,
  inact_regl_maatstaf_perc_t0,
  act_toesl_jr_tmin1,
  act_verleend_toesl_prc_tmin1,
  act_regl_maatstaf_perc_tmin1,
  act_toesl_jr_tmin2,
  act_verleend_toesl_prc_tmin2,
  act_regl_maatstaf_perc_tmin2,
  act_toesl_jr_tmin3,
  act_regl_maatstaf_perc_tmin3,
  act_verleend_toesl_prc_tmin3,
  act_toesl_jr_tmin4,
  act_verleend_toesl_prc_tmin4,
  act_regl_maatstaf_perc_tmin4,
  inact_toesl_jr_tmin1,
  inact_verleend_toesl_prc_tmin1,
  inact_regl_maatstaf_perc_tmin1,
  inact_toesl_jr_tmin2,
  inact_verleend_toesl_prc_tmin2,
  inact_regl_maatstaf_perc_tmin2,
  inact_toesl_jr_tmin3,
  inact_verleend_toesl_prc_tmin3,
  inact_regl_maatstaf_perc_tmin3,
  inact_toesl_jr_tmin4,
  inact_verleend_toesl_prc_tmin4,
  inact_regl_maatstaf_perc_tmin4,
  h_wpr_afwyk_code,
  h_ind_lifelong,
  sys_code_opt,
  tmp_overeenkomst_TYPE_step1 pb_overeenkomst_TYPE_step1,
  `_____________________`,
  tmp_srt_pensioen,
  tmp_overeenkomst_TYPE_step2 pb_overeenkomst_TYPE_step2,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  puv_id,
  px_bedrag_pg,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  tmp_ind_split_policy_divorce,
  byz_4_code_anw_p,
  h_eindlft_op,
  eindlft_pr_bet_wp,
  lego_netto_groep_ind,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  px_mpo_kap_verw_nominaal,
  ct_vz,
  h_eindlft_vz_datum,
  tmp_uit_vz_dat_pre,
  tmp_aan_vz_dat_code_5,
  tmp_aan_vz_dat_code_n,
  veren_pensg_code,
  NULL AS tmp_aan_vz_dat_code_3_flag,
  tmp_vz_dat_1_7,
  naam,
  ondnr,
  niet_pw_contract,
  upo_verv_code,
  soort_rel_code,
  verk_naam,
  bedrijfstak
FROM
  generate_m4;


CREATE OR REPLACE TEMPORARY VIEW rank_1 AS
SELECT
  relnr,
  volgnr,
  h_end_age AS highest_h_end_age,
  sort_h_end_age,
  RANK() OVER (PARTITION BY relnr, volgnr ORDER BY sort_h_end_age DESC)
FROM h_end_age;


CREATE OR REPLACE TEMPORARY VIEW join_3 AS
SELECT
  t2.tmp_number_of_records_in_policy,
  t2.pb_aop_bedrag_org,
  t2.pb_uitbreidingsleeftijd_kind,
  t2.tmp_policy_has_vz_27,
  t2.tmp_policy_has_vz_not_in,
  t2.tmp_policy_has_vz_65,
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.mutnr_p,
  t1.h_sys_code_op,
  t1.h_sys_code_kap,
  t1.h_sys_code_wp,
  t1.h_djr_bep_code,
  t1.h_status,
  t1.aep_code_p,
  t1.geb_dat_verzek_p,
  t1.geb_dat_verzor_p,
  t1.ct_polis_p,
  t1.verzekde_gesl_cd,
  t1.verzrgde_gesl_cd,
  t1.grpnr,
  t1.versie_nr,
  t1.wyze_bet,
  t1.aanvangs_dat,
  t1.ontslag_dat_p,
  t1.h_post_met_fin,
  t1.h_franch,
  t1.h_inval_ad,
  t1.h_perc_op_1,
  t1.parttime_perc_dt_p,
  t1.h_einddat,
  t1.djr_v_dat_p,
  t1.wzp_inv_std_endlft,
  t1.eindlft_wzp_p,
  t1.is_dekkings_code,
  t1.act_toesl_cat,
  t1.inact_toesl_cat,
  t1.act_toesl_mom,
  t1.inact_toesl_mom,
  t1.act_max_toesl_perc,
  t1.inact_max_toesl_perc,
  t1.act_fin_TYPE,
  t1.inact_fin_TYPE,
  t1.act_maatstaf_TYPE,
  t1.inact_maatstaf_TYPE,
  t1.reglement_aand,
  t1.px_srt_regeling,
  t1.px_status,
  t1.px_TYPE_aanwending,
  t1.px_ingekocht,
  t1.h_eindlft_ip,
  t1.pb_polis_nummer,
  t1.pb_overeenkomst_TYPE_step2 tmp_overeenkomst_TYPE_step2,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.ltst_mut_dat_p,
  t1.munt_code,
  t1.h_end_age,
  t1.act_min_toesl_perc,
  t1.inact_min_toesl_perc,
  t1.act_maatstaf_peil_mnd,
  t1.inact_maatstaf_peil_mnd,
  t1.vz_vorm_g_1,
  t1.vz_vorm_g_2,
  t1.vz_vorm_g_3,
  t1.vz_vorm_g_4,
  t1.vz_vorm_g_5,
  t1.vz_vorm_g_6,
  t1.vz_vorm_g_7,
  t1.vz_vorm_g_8,
  t1.byz_5_code_herv_p,
  t1.werkgr_nr,
  t1.team_nr,
  t1.echtsch_vereven_code,
  t1.aanw_som_bet_prem_code_p,
  t1.h_tot_som_betaalde_prem,
  t1.tot_verz,
  t1.in_dienst_dat_p,
  t1.px_upo_kap_verw_nominaal,
  t1.px_bedrag_pg,
  t1.px_bedrag_salaris,
  t1.px_bedrag_franchise,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.act_toesl_jr_t0,
  t1.act_verleend_toesl_prc_t0,
  t1.act_regl_maatstaf_perc_t0,
  t1.inact_toesl_jr_t0,
  t1.inact_verleend_toesl_prc_t0,
  t1.inact_regl_maatstaf_perc_t0,
  t1.act_toesl_jr_tmin1,
  t1.act_verleend_toesl_prc_tmin1,
  t1.act_regl_maatstaf_perc_tmin1,
  t1.act_toesl_jr_tmin2,
  t1.act_verleend_toesl_prc_tmin2,
  t1.act_regl_maatstaf_perc_tmin2,
  t1.act_toesl_jr_tmin3,
  t1.act_regl_maatstaf_perc_tmin3,
  t1.act_verleend_toesl_prc_tmin3,
  t1.act_toesl_jr_tmin4,
  t1.act_verleend_toesl_prc_tmin4,
  t1.act_regl_maatstaf_perc_tmin4,
  t1.inact_toesl_jr_tmin1,
  t1.inact_verleend_toesl_prc_tmin1,
  t1.inact_regl_maatstaf_perc_tmin1,
  t1.inact_toesl_jr_tmin2,
  t1.inact_verleend_toesl_prc_tmin2,
  t1.inact_regl_maatstaf_perc_tmin2,
  t1.inact_toesl_jr_tmin3,
  t1.inact_verleend_toesl_prc_tmin3,
  t1.inact_regl_maatstaf_perc_tmin3,
  t1.inact_toesl_jr_tmin4,
  t1.inact_verleend_toesl_prc_tmin4,
  t1.inact_regl_maatstaf_perc_tmin4,
  t1.h_wpr_afwyk_code,
  t1.h_ind_lifelong,
  t1.verwdt_log,
  t1.puv_id,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.tmp_ind_split_policy_divorce,
  t1.byz_4_code_anw_p,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.lego_netto_groep_ind,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.px_mpo_kap_verw_nominaal,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t2.tmp_policy_has_vz_20_38,
  t2.tmp_policy_has_vz_40_48,
  t2.tmp_policy_has_vz_11_19,
  t1.veren_pensg_code,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t1.pb_overeenkomst_TYPE_step1 tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.bedrijfstak
FROM union_1 t1
LEFT JOIN pol_lev_attr t2;


CREATE OR REPLACE TEMPORARY VIEW factor_a AS
SELECT relnr,
       volgnr,
       run_TYPE,
       reference_date,
       VALIDFRM,
       FACTA_AMOUNT
FROM cv_full_z21_o964_facta_return_values
WHERE run_TYPE = 'u'
  AND reference_date = '$$ip_reference_date$$'
GROUP BY relnr,
         volgnr,
         run_TYPE,
         reference_date,
         VALIDFRM,
         FACTA_AMOUNT

CREATE OR REPLACE TEMPORARY VIEW pol_lev_attr AS
SELECT
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  tmp_number_of_records_in_policy,
  pb_aop_bedrag AS pb_aop_bedrag_org,
  pb_uitbreidingsleeftijd_kind,
  tmp_policy_has_vz_27,
  tmp_policy_has_vz_65,
  tmp_policy_has_vz_20_38,
  tmp_policy_has_vz_40_48,
  tmp_policy_has_vz_11_19,
  tmp_policy_has_vz_not_in
FROM cv_dlo_pubs_policy_level_logic;


CREATE OR REPLACE TEMPORARY VIEW union_2 AS
SELECT
  pb_uit_uitkering_code,
  pb_uit_uitkering_duur,
  pb_uit_ingangslftd_uitkering,
  pb_uit_ingangsdatum_uitkering,
  pb_uit_bepaling_eind_uitk_code,
  pb_uit_eindleeftijd_uitkering,
  pb_uit_einddatum_uitkering,
  pb_uit_uitkering_bedrag,
  pb_uit_stijging_bedrag,
  pb_uit_stijging_percentage,
  pb_uit_stijging_TYPE,
  pb_uit_stijging_duur,
  pb_uit_aanvangsdatum_stijging,
  pb_uit_einddatum_tijd_stijging,
  pb_uit_uitk_status_code,
  pb_uit_scenariomoment,
  ZVOLGNR_uit,
  ZFLD_UITKERING_uit,
  ZUITKERINGCD,
  ZUITKDUUR,
  ZXML_FLD_INGLFTUITK,
  ZXML_FLD_INGDATUITK,
  ZBEP_END_UITKERINGCD,
  ZXML_FLD_ENDLFTUITK,
  ZXML_FLD_ENDDATUITK,
  ZXML_FLD_UITKBDRG,
  ZXML_FLD_STYGBDRG,
  ZXML_FLD_STYGPERC,
  zxml_fld_stygTYPE,
  ZXML_FLD_STYGDUUR,
  ZXML_FLD_AANVDATSTYG,
  ZXML_FLD_ENDDATTYDSTYG,
  ZUITKSTATCD,
  ZXML_FLD_SCENMOMENT,
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2 pb_overeenkomst_TYPE,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_betaalde_premie,
  pb_klantnummer,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  NULL AS ZVOLGNR_aan,
  NULL AS ZPENSRTCD,
  NULL AS ZAANSPRSTATCD,
  NULL AS ZINGUITKCD,
  NULL AS ZEINDUIKTCD,
  NULL AS ZHERKUITKCD,
  NULL AS ZXML_FLD_OMSLAGCD,
  NULL AS ZXML_FLD_LFTOMSLAG,
  NULL AS ZXML_FLD_DATOMSLAG,
  NULL AS ZXML_FLD_FINANCD,
  NULL AS ZXML_FLD_FLEXAOWMIN2,
  NULL AS ZXML_FLD_FLEXAOW,
  NULL AS ZXML_FLD_FLEXAOWplus1,
  NULL AS ZFLD_UITKERING_aan,
  NULL AS pb_aan_pensioensoortcode,
  NULL AS pb_aan_aanspraakstatuscode,
  NULL AS pb_aan_bepaling_ing_uitk_code,
  NULL AS pb_aan_ingangslftd_uitkering,
  NULL AS pb_aan_ingangsdatum_uitkering,
  NULL AS pb_aan_bepaling_eind_uitk_code,
  NULL AS pb_aan_eindleeftijd_uitkering,
  NULL AS pb_aan_einddatum_uitkering,
  NULL AS pb_aan_herkomst_uitkering_code,
  NULL AS pb_aan_omslag_code,
  NULL AS pb_aan_leeftijd_omslag,
  NULL AS pb_aan_datum_omslag,
  NULL AS pb_aan_financiering_code,
  NULL AS pb_aan_uitkering_bedrag,
  NULL AS pb_aan_stijging_bedrag,
  NULL AS pb_aan_stijging_percentage,
  NULL AS pb_aan_stijging_TYPE,
  NULL AS pb_aan_stijging_duur,
  NULL AS pb_aan_aanvangsdatum_stijging,
  NULL AS pb_aan_einddatum_tijd_stijging,
  NULL AS pb_aan_flex_aow_min2,
  NULL AS pb_aan_flex_aow,
  NULL AS pb_aan_flex_aow_plus1,
  NULL AS pb_aan_scenariomoment,
  NULL AS pb_aan_stijg_als_ovl_voor_lft,
  pb_ind_premievrijst_jn,
  pb_uit_afwijkende_stijging_jn,
  ct_vz,
  tmp_VZ_GROUP_uit,
  h_eindlft_vz_datum,
  tmp_uit_vz_dat_pre,
  tmp_uitkering_flag,
  NULL AS tmp_VZ_GROUP_lat,
  NULL AS pb_aan_afwijkende_stijging_jn,
  NULL AS pb_aan_stijging_tot_eindlftPARTNER,
  pb_vereniging_gepensioneerden,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  naam,
  ondnr,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date,
  verk_naam,
  pb_bericht_versie,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_code_PARTNER_bep_onbep
FROM `m5_uitk`
UNION ALL
SELECT
  NULL AS pb_uit_uitkering_code,
  NULL AS pb_uit_uitkering_duur,
  NULL AS pb_uit_ingangslftd_uitkering,
  NULL AS pb_uit_ingangsdatum_uitkering,
  NULL AS pb_uit_bepaling_eind_uitk_code,
  NULL AS pb_uit_eindleeftijd_uitkering,
  NULL AS pb_uit_einddatum_uitkering,
  NULL AS pb_uit_uitkering_bedrag,
  NULL AS pb_uit_stijging_bedrag,
  NULL AS pb_uit_stijging_percentage,
  NULL AS pb_uit_stijging_TYPE,
  NULL AS pb_uit_stijging_duur,
  NULL AS pb_uit_aanvangsdatum_stijging,
  NULL AS pb_uit_eendatum_tijd_stijging,
  NULL AS pb_uit_uitk_status_code,
  NULL AS pb_uit_scenariomoment,
  NULL AS ZVOLGNR_uit,
  NULL AS ZFLD_UITKERING_uit,
  NULL AS ZUITKERINGCD,
  NULL AS ZUITKDUUR,
  ZXML_FLD_INGLFTUITK,
  ZXML_FLD_INGDATUITK,
  NULL AS ZBEP_END_UITKERINGCD,
  ZXML_FLD_ENDLFTUITK,
  ZXML_FLD_ENDDATUITK,
  ZXML_FLD_UITKBDRG,
  ZXML_FLD_STYGBDRG,
  ZXML_FLD_STYGPERC,
  zxml_fld_stygTYPE,
  ZXML_FLD_STYGDUUR,
  ZXML_FLD_AANVDATSTYG,
  ZXML_FLD_ENDDATTYDSTYG,
  NULL AS ZUITKSTATCD,
  ZXML_FLD_SCENMOMENT,
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2 pb_overeenkomst_TYPE,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_betaalde_premie,
  pb_klantnummer,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  ZVOLGNR_aan,
  ZPENSRTCD,
  ZAANSPRSTATCD,
  ZINGUITKCD,
  ZEINDUIKTCD,
  ZHERKUITKCD,
  ZXML_FLD_OMSLAGCD,
  ZXML_FLD_LFTOMSLAG,
  ZXML_FLD_DATOMSLAG,
  ZXML_FLD_FINANCD,
  ZXML_FLD_FLEXAOWMIN2,
  ZXML_FLD_FLEXAOW,
  ZXML_FLD_FLEXAOWplus1,
  ZFLD_UITKERING_aan,
  pb_aan_pensioensoortcode,
  pb_aan_aanspraakstatuscode,
  pb_aan_bepaling_ing_uitk_code,
  pb_aan_ingangslftd_uitkering,
  pb_aan_ingangsdatum_uitkering,
  pb_aan_bepaling_eind_uitk_code,
  pb_aan_eindleeftijd_uitkering,
  pb_aan_einddatum_uitkering,
  pb_aan_herkomst_uitkering_code,
  pb_aan_omslag_code,
  pb_aan_leeftijd_omslag,
  pb_aan_datum_omslag,
  pb_aan_financiering_code,
  pb_aan_uitkering_bedrag,
  pb_aan_stijging_bedrag,
  pb_aan_stijging_percentage,
  pb_aan_stijging_TYPE,
  pb_aan_stijging_duur,
  pb_aan_aanvangsdatum_stijging,
  pb_aan_einddatum_tijd_stijging,
  pb_aan_flex_aow_min2,
  pb_aan_flex_aow,
  pb_aan_flex_aow_plus1,
  pb_aan_scenariomoment,
  pb_aan_stijg_als_ovl_voor_lft,
  pb_ind_premievrijst_jn,
  NULL AS pb_uit_afwijkende_stijging_jn,
  NULL AS ct_vz,
  NULL AS tmp_VZ_GROUP_uit,
  NULL AS h_eindlft_vz_datum,
  NULL AS tmp_uit_vz_dat_pre,
  NULL AS tmp_uitkering_flag,
  NULL AS tmp_VZ_GROUP_lat,
  pb_aan_afwijkende_stijging_jn,
  pb_aan_stijging_tot_eindlftPARTNER,
  pb_vereniging_gepensioneerden,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  naam,
  ondnr,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date,
  verk_naam,
  pb_bericht_versie,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_code_PARTNER_bep_onbep
FROM `m1_2_4_aanspr`
UNION ALL
SELECT
  NULL AS pb_uit_uitkering_code,
  NULL AS pb_uit_uitkering_duur,
  NULL AS pb_uit_ingangslftd_uitkering,
  NULL AS pb_uit_ingangsdatum_uitkering,
  NULL AS pb_uit_bepaling_eind_uitk_code,
  NULL AS pb_uit_eindleeftijd_uitkering,
  NULL AS pb_uit_einddatum_uitkering,
  NULL AS pb_uit_uitkering_bedrag,
  NULL AS pb_uit_stijging_bedrag,
  NULL AS pb_uit_stijging_percentage,
  NULL AS pb_uit_stijging_TYPE,
  NULL AS pb_uit_stijging_duur,
  NULL AS pb_uit_aanvangsdatum_stijging,
  NULL AS pb_uit_einddatum_tijd_stijging,
  NULL AS pb_uit_uitk_status_code,
  NULL AS pb_uit_scenariomoment,
  NULL AS ZVOLGNR_uit,
  NULL AS ZFLD_UITKERING_uit,
  NULL AS ZUITKERINGCD,
  NULL AS ZUITKDUUR,
  ZXML_FLD_INGLFTUITK,
  ZXML_FLD_INGDATUITK,
  NULL AS ZBEP_END_UITKERINGCD,
  ZXML_FLD_ENDLFTUITK,
  ZXML_FLD_ENDDATUITK,
  ZXML_FLD_UITKBDRG,
  ZXML_FLD_STYGBDRG,
  ZXML_FLD_STYGPERC,
  zxml_fld_stygTYPE,
  ZXML_FLD_STYGDUUR,
  ZXML_FLD_AANVDATSTYG,
  ZXML_FLD_ENDDATTYDSTYG,
  NULL AS ZUITKSTATCD,
  ZXML_FLD_SCENMOMENT,
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2 pb_overeenkomst_TYPE,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_betaalde_premie,
  pb_klantnummer,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  ZVOLGNR_aan,
  ZPENSRTCD,
  ZAANSPRSTATCD,
  ZINGUITKCD,
  ZEINDUIKTCD,
  ZHERKUITKCD,
  ZXML_FLD_OMSLAGCD,
  ZXML_FLD_LFTOMSLAG,
  ZXML_FLD_DATOMSLAG,
  ZXML_FLD_FINANCD,
  ZXML_FLD_FLEXAOWMIN2,
  ZXML_FLD_FLEXAOW,
  ZXML_FLD_FLEXAOWplus1,
  ZFLD_UITKERING_aan,
  pb_aan_pensioensoortcode,
  pb_aan_aanspraakstatuscode,
  pb_aan_bepaling_ing_uitk_code,
  pb_aan_ingangslftd_uitkering,
  pb_aan_ingangsdatum_uitkering,
  pb_aan_bepaling_eind_uitk_code,
  pb_aan_eindleeftijd_uitkering,
  pb_aan_einddatum_uitkering,
  pb_aan_herkomst_uitkering_code,
  pb_aan_omslag_code,
  pb_aan_leeftijd_omslag,
  pb_aan_datum_omslag,
  pb_aan_financiering_code,
  pb_aan_uitkering_bedrag,
  pb_aan_stijging_bedrag,
  pb_aan_stijging_percentage,
  pb_aan_stijging_TYPE,
  pb_aan_stijging_duur,
  pb_aan_aanvangsdatum_stijging,
  pb_aan_einddatum_tijd_stijging,
  pb_aan_flex_aow_min2,
  pb_aan_flex_aow,
  pb_aan_flex_aow_plus1,
  pb_aan_scenariomoment,
  pb_aan_stijg_als_ovl_voor_lft,
  pb_ind_premievrijst_jn,
  NULL AS pb_uit_afwijkende_stijging_jn,
  ct_vz,
  tmp_VZ_GROUP_uit,
  h_eindlft_vz_datum,
  NULL AS tmp_uit_vz_dat_pre,
  NULL AS tmp_uitkering_flag,
  tmp_VZ_GROUP_lat,
  pb_aan_afwijkende_stijging_jn,
  pb_aan_stijging_tot_eindlftPARTNER,
  pb_vereniging_gepensioneerden,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  naam,
  ondnr,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date,
  verk_naam,
  pb_bericht_versie,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_code_PARTNER_bep_onbep
FROM `m4_m5_aanspr`;


CREATE OR REPLACE TEMPORARY VIEW join_8 AS
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.mutnr_p,
  t1.h_sys_code_op,
  t1.h_sys_code_kap,
  t1.h_sys_code_wp,
  t1.h_djr_bep_code,
  t1.h_status,
  t1.aep_code_p,
  t1.geb_dat_verzek_p,
  t1.geb_dat_verzor_p,
  t1.ct_polis_p,
  t1.verzekde_gesl_cd,
  t1.verzrgde_gesl_cd,
  t1.grpnr,
  t1.versie_nr,
  t1.wyze_bet,
  t1.aanvangs_dat,
  t1.ontslag_dat_p,
  t1.h_post_met_fin,
  t1.h_franch,
  t1.h_inval_ad,
  t1.h_perc_op_1,
  t1.parttime_perc_dt_p,
  t1.h_einddat,
  t1.djr_v_dat_p,
  t1.wzp_inv_std_endlft,
  t1.eindlft_wzp_p,
  t1.is_dekkings_code,
  t1.act_toesl_cat,
  t1.inact_toesl_cat,
  t1.act_toesl_mom,
  t1.inact_toesl_mom,
  t1.act_max_toesl_perc,
  t1.inact_max_toesl_perc,
  t1.act_fin_TYPE,
  t1.inact_fin_TYPE,
  t1.act_maatstaf_TYPE,
  t1.inact_maatstaf_TYPE,
  t1.reglement_aand,
  t1.px_srt_regeling,
  t1.px_status,
  t1.px_TYPE_aanwending,
  t1.px_ingekocht,
  t1.h_eindlft_ip,
  t1.pb_polis_nummer,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.ltst_mut_dat_p,
  t1.munt_code,
  t1.pb_aop_bedrag_org,
  t1.pb_uitbreidingsleeftijd_kind AS pb_uitbreidingsleeftijd_kind_nw,
  t1.h_end_age,
  t1.act_min_toesl_perc,
  t1.inact_min_toesl_perc,
  t1.act_maatstaf_peil_mnd,
  t1.inact_maatstaf_peil_mnd,
  t1.vz_vorm_g_1,
  t1.vz_vorm_g_2,
  t1.vz_vorm_g_3,
  t1.vz_vorm_g_4,
  t1.vz_vorm_g_5,
  t1.vz_vorm_g_6,
  t1.vz_vorm_g_7,
  t1.vz_vorm_g_8,
  t1.byz_5_code_herv_p,
  t1.werkgr_nr,
  t1.team_nr,
  t1.echtsch_vereven_code,
  t1.aanw_som_bet_prem_code_p,
  t1.h_tot_som_betaalde_prem,
  t1.tot_verz,
  t1.in_dienst_dat_p,
  t1.px_upo_kap_verw_nominaal,
  t1.px_bedrag_pg,
  t1.px_bedrag_salaris,
  t1.px_bedrag_franchise,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.tmp_policy_has_vz_27,
  t1.tmp_policy_has_vz_not_in,
  t1.tmp_policy_has_vz_65,
  t1.act_toesl_jr_t0,
  t1.act_verleend_toesl_prc_t0,
  t1.act_regl_maatstaf_perc_t0,
  t1.inact_toesl_jr_t0,
  t1.inact_verleend_toesl_prc_t0,
  t1.inact_regl_maatstaf_perc_t0,
  t1.act_toesl_jr_tmin1,
  t1.act_verleend_toesl_prc_tmin1,
  t1.act_regl_maatstaf_perc_tmin1,
  t1.act_toesl_jr_tmin2,
  t1.act_verleend_toesl_prc_tmin2,
  t1.act_regl_maatstaf_perc_tmin2,
  t1.act_toesl_jr_tmin3,
  t1.act_regl_maatstaf_perc_tmin3,
  t1.act_verleend_toesl_prc_tmin3,
  t1.act_toesl_jr_tmin4,
  t1.act_verleend_toesl_prc_tmin4,
  t1.act_regl_maatstaf_perc_tmin4,
  t1.inact_toesl_jr_tmin1,
  t1.inact_verleend_toesl_prc_tmin1,
  t1.inact_regl_maatstaf_perc_tmin1,
  t1.inact_toesl_jr_tmin2,
  t1.inact_verleend_toesl_prc_tmin2,
  t1.inact_regl_maatstaf_perc_tmin2,
  t1.inact_toesl_jr_tmin3,
  t1.inact_verleend_toesl_prc_tmin3,
  t1.inact_regl_maatstaf_perc_tmin3,
  t1.inact_toesl_jr_tmin4,
  t1.inact_verleend_toesl_prc_tmin4,
  t1.inact_regl_maatstaf_perc_tmin4,
  t1.h_wpr_afwyk_code,
  t1.h_ind_lifelong,
  t1.verwdt_log,
  t1.puv_id,
  t2.facta_jaar,
  t2.FACTA_AMOUNT,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.tmp_ind_split_policy_divorce,
  t1.byz_4_code_anw_p,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.lego_netto_groep_ind,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.px_mpo_kap_verw_nominaal,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_policy_has_vz_20_38,
  t1.tmp_policy_has_vz_40_48,
  t1.tmp_policy_has_vz_11_19,
  t1.veren_pensg_code,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.bedrijfstak,
  LEFT(t1.reference_date, 4) AS facta_jaar_pre,
  CASE WHEN t2.FACTA_AMOUNT IS NULL THEN 0 ELSE t2.FACTA_AMOUNT END AS FACTA_AMOUNT_pre
FROM
  join_3 t1
  LEFT JOIN latest_factor_a t2
    ON t1.relnr = t2.relnr
    AND t1.volgnr = t2.volgnr;


CREATE OR REPLACE TEMPORARY VIEW min_vz_cd_pa AS
SELECT
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  MIN(vz_cd_pa) AS vz_cd_pa
FROM generic_logic
GROUP BY
  pb_polis_nummer,
  pb_polis_nummer_toevoeging;


CREATE OR REPLACE TEMPORARY VIEW generate_m4 AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  mutnr_p,
  h_sys_code_op,
  h_sys_code_kap,
  h_sys_code_wp,
  h_djr_bep_code,
  h_status,
  aep_code_p,
  geb_dat_verzek_p,
  geb_dat_verzor_p,
  ct_polis_p,
  verzekde_gesl_cd,
  verzrgde_gesl_cd,
  grpnr,
  versie_nr,
  wyze_bet,
  aanvangs_dat,
  ontslag_dat_p,
  h_post_met_fin,
  h_franch,
  h_inval_ad,
  h_perc_op_1,
  parttime_perc_dt_p,
  h_einddat,
  djr_v_dat_p,
  wzp_inv_std_endlft,
  eindlft_wzp_p,
  is_dekkings_code,
  act_toesl_cat,
  inact_toesl_cat,
  act_toesl_mom,
  inact_toesl_mom,
  act_max_toesl_perc,
  inact_max_toesl_perc,
  act_fin_TYPE,
  inact_fin_TYPE,
  act_maatstaf_TYPE,
  inact_maatstaf_TYPE,
  reglement_aand,
  px_srt_regeling,
  px_status,
  px_TYPE_aanwending,
  px_ingekocht,
  h_eindlft_ip,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  ltst_mut_dat_p,
  munt_code,
  h_end_age,
  act_min_toesl_perc,
  inact_min_toesl_perc,
  act_maatstaf_peil_mnd,
  inact_maatstaf_peil_mnd,
  vz_vorm_g_1,
  vz_vorm_g_2,
  vz_vorm_g_3,
  vz_vorm_g_4,
  vz_vorm_g_5,
  vz_vorm_g_6,
  vz_vorm_g_7,
  vz_vorm_g_8,
  byz_5_code_herv_p,
  werkgr_nr,
  team_nr,
  echtsch_vereven_code,
  aanw_som_bet_prem_code_p,
  h_tot_som_betaalde_prem,
  tot_verz,
  in_dienst_dat_p,
  px_upo_kap_verw_nominaal,
  px_bedrag_pg,
  px_bedrag_salaris,
  px_bedrag_franchise,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  sys_code_opt,
  act_toesl_jr_t0,
  act_verleend_toesl_prc_t0,
  act_regl_maatstaf_perc_t0,
  inact_toesl_jr_t0,
  inact_verleend_toesl_prc_t0,
  inact_regl_maatstaf_perc_t0,
  act_toesl_jr_tmin1,
  act_verleend_toesl_prc_tmin1,
  act_regl_maatstaf_perc_tmin1,
  act_toesl_jr_tmin2,
  act_verleend_toesl_prc_tmin2,
  act_regl_maatstaf_perc_tmin2,
  act_toesl_jr_tmin3,
  act_regl_maatstaf_perc_tmin3,
  act_verleend_toesl_prc_tmin3,
  act_toesl_jr_tmin4,
  act_verleend_toesl_prc_tmin4,
  act_regl_maatstaf_perc_tmin4,
  inact_toesl_jr_tmin1,
  inact_verleend_toesl_prc_tmin1,
  inact_regl_maatstaf_perc_tmin1,
  inact_toesl_jr_tmin2,
  inact_verleend_toesl_prc_tmin2,
  inact_regl_maatstaf_perc_tmin2,
  inact_toesl_jr_tmin3,
  inact_verleend_toesl_prc_tmin3,
  inact_regl_maatstaf_perc_tmin3,
  inact_toesl_jr_tmin4,
  inact_verleend_toesl_prc_tmin4,
  inact_regl_maatstaf_perc_tmin4,
  h_wpr_afwyk_code,
  h_ind_lifelong,
  pb_polis_nummer,
  tmp_overeenkomst_TYPE_step1,
  byz_4_code_anw_p,
  h_eindlft_op,
  eindlft_pr_bet_wp,
  tmp_srt_pensioen,
  verwdt_log,
  puv_id,
  lego_netto_groep_ind,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  px_mpo_kap_verw_nominaal,
  ct_vz,
  h_eindlft_vz_datum,
  tmp_uit_vz_dat_pre,
  tmp_aan_vz_dat_code_5,
  tmp_aan_vz_dat_code_n,
  veren_pensg_code,
  tmp_vz_dat_1_7,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  upo_verv_code,
  soort_rel_code,
  bedrijfstak,
  CASE
    WHEN "tmp_overeenkomst_TYPE_step1" = 'm2.01' THEN 'm4.05'
    WHEN "tmp_overeenkomst_TYPE_step1" = 'm2.02' THEN 'm4.07'
    ELSE 'xx.xx'
  END AS tmp_overeenkomst_TYPE_step2,
  'y' AS tmp_ind_split_policy_divorce,
  '2' AS tmp_ind_recipient,
  't' AS tmp_ind_PARTNER_is_exPARTNER,
  CASE
    WHEN "aep_code_p" IN ('1','2','3','5','6') THEN 'y'
    ELSE 'n'
  END AS tmp_ind_kapitaal_bij_overlijden
FROM join_4
WHERE LEFT("tmp_overeenkomst_TYPE_step1", 2) = 'm2'
  AND "aep_code_p" IN ('1','2','3','5','6');


CREATE OR REPLACE TEMPORARY VIEW join_7 AS
SELECT
  t1.pb_polis_nummer,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.relnr,
  t1.grpnr,
  t1.versie_nr,
  t1.wyze_bet,
  t1.aanvangs_dat,
  t1.h_status,
  t1.ontslag_dat_p,
  t1.h_post_met_fin,
  t1.h_franch,
  t1.ct_polis_p,
  t1.h_sys_code_op,
  t1.h_inval_ad,
  t1.h_perc_op_1,
  t1.run_id,
  t1.reference_date,
  t1.verwdt,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.parttime_perc_dt_p,
  t1.h_einddat,
  t1.djr_v_dat_p,
  t1.wzp_inv_std_endlft,
  t1.eindlft_wzp_p,
  t1.is_dekkings_code,
  t1.act_toesl_cat,
  t1.inact_toesl_cat,
  t1.act_toesl_mom,
  t1.inact_toesl_mom,
  t1.act_max_toesl_perc,
  t1.inact_max_toesl_perc,
  t1.act_fin_TYPE,
  t1.inact_fin_TYPE,
  t1.act_maatstaf_TYPE,
  t1.inact_maatstaf_TYPE,
  t1.reglement_aand,
  t1.h_end_age,
  t1.act_min_toesl_perc,
  t1.inact_min_toesl_perc,
  t1.act_maatstaf_peil_mnd,
  t1.inact_maatstaf_peil_mnd,
  t1.vz_vorm_g_1,
  t1.vz_vorm_g_2,
  t1.vz_vorm_g_3,
  t1.vz_vorm_g_4,
  t1.vz_vorm_g_5,
  t1.vz_vorm_g_6,
  t1.vz_vorm_g_7,
  t1.vz_vorm_g_8,
  t1.byz_5_code_herv_p,
  t1.h_djr_bep_code,
  t1.echtsch_vereven_code,
  t1.px_bedrag_pg,
  t1.px_bedrag_salaris,
  t1.px_bedrag_franchise,
  t1.act_toesl_jr_t0,
  t1.act_verleend_toesl_prc_t0,
  t1.act_regl_maatstaf_perc_t0,
  t1.inact_toesl_jr_t0,
  t1.inact_verleend_toesl_prc_t0,
  t1.inact_regl_maatstaf_perc_t0,
  t1.act_toesl_jr_tmin1,
  t1.act_verleend_toesl_prc_tmin1,
  t1.act_regl_maatstaf_perc_tmin1,
  t1.act_toesl_jr_tmin2,
  t1.act_verleend_toesl_prc_tmin2,
  t1.act_regl_maatstaf_perc_tmin2,
  t1.act_toesl_jr_tmin3,
  t1.act_regl_maatstaf_perc_tmin3,
  t1.act_verleend_toesl_prc_tmin3,
  t1.act_toesl_jr_tmin4,
  t1.act_verleend_toesl_prc_tmin4,
  t1.act_regl_maatstaf_perc_tmin4,
  t1.inact_toesl_jr_tmin1,
  t1.inact_verleend_toesl_prc_tmin1,
  t1.inact_regl_maatstaf_perc_tmin1,
  t1.inact_toesl_jr_tmin2,
  t1.inact_verleend_toesl_prc_tmin2,
  t1.inact_regl_maatstaf_perc_tmin2,
  t1.inact_toesl_jr_tmin3,
  t1.inact_verleend_toesl_prc_tmin3,
  t1.inact_regl_maatstaf_perc_tmin3,
  t1.inact_toesl_jr_tmin4,
  t1.inact_verleend_toesl_prc_tmin4,
  t1.inact_regl_maatstaf_perc_tmin4,
  t1.h_ingangsleeftijd,
  t1.puv_id,
  t2.pb_betaalde_premie,
  t2.pb_vrijgestelde_premie_org,
  t1.pb_polis_nummer_toevoeging,
  t1.byz_4_code_anw_p,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.styg_vz_code,
  t1.styg_vz_perc,
  t1.lego_netto_groep_ind,
  t1.tmp_policy_has_vz_20_38,
  t1.tmp_policy_has_vz_40_48,
  t1.tmp_policy_has_vz_11_19,
  t1.veren_pensg_code,
  t1.tmp_pensioensoort,
  t1.tmp_overeenkomst_TYPE_step1
FROM generic_logic t1
LEFT JOIN versch_premie t2
  ON t1.relnr = t2.relnr
  AND t1.volgnr = t2.volgnr;


CREATE OR REPLACE TEMPORARY VIEW besch_premie AS
SELECT DISTINCT
  relnr,
  volgnr,
  vz_cd_pa,
  pb_beschikbare_premie AS pb_beschikbare_premie_org
FROM cv_dlo_pubs_besch_prem;


CREATE OR REPLACE TEMPORARY VIEW generic_logic AS
SELECT
  `relnr`,
  `volgnr`,
  `vz_cd_pa`,
  `run_id`,
  `run_TYPE`,
  `reference_date`,
  `verwdt`,
  `run_timestamp`,
  `run_date`,
  `mutnr_p`,
  `h_sys_code_op`,
  `h_sys_code_kap`,
  `h_sys_code_wp`,
  `h_djr_bep_code`,
  `h_status`,
  `aep_code_p`,
  `geb_dat_verzek_p`,
  `geb_dat_verzor_p`,
  `ct_polis_p`,
  `verzekde_gesl_cd`,
  `verzrgde_gesl_cd`,
  `grpnr`,
  `versie_nr`,
  `wyze_bet`,
  `aanvangs_dat`,
  `ontslag_dat_p`,
  `h_post_met_fin`,
  `h_franch`,
  `h_inval_ad`,
  `h_perc_op_1`,
  `parttime_perc_dt_p`,
  `h_einddat`,
  `djr_v_dat_p`,
  `wzp_inv_std_endlft`,
  `eindlft_wzp_p`,
  `is_dekkings_code`,
  `act_toesl_cat`,
  `inact_toesl_cat`,
  `act_toesl_mom`,
  `inact_toesl_mom`,
  `act_max_toesl_perc`,
  `inact_max_toesl_perc`,
  `act_fin_TYPE`,
  `inact_fin_TYPE`,
  `act_maatstaf_TYPE`,
  `inact_maatstaf_TYPE`,
  `reglement_aand`,
  `px_srt_regeling`,
  `px_status`,
  `px_TYPE_aanwending`,
  `px_ingekocht`,
  `h_eindlft_ip`,
  `pb_polis_nummer`,
  `tmp_overeenkomst_TYPE_step2`,
  `px_te_bereiken`,
  `px_opgebouwd_kapitaal`,
  `px_upo_idt_rel_op_boven_verw`,
  `px_upo_idt_rel_op_volgens_verw`,
  `px_upo_idt_rel_op_onder_verw`,
  `px_mpo_idt_rel_op_boven_verw`,
  `px_mpo_idt_rel_op_volgens_verw`,
  `px_mpo_idt_rel_op_onder_verw`,
  `px_pensioenleeftijd`,
  `px_upo_ind_prog_methode`,
  `px_mpo_ind_prog_methode`,
  `px_eindleeftijd_aanwending`,
  `styg_vz_perc`,
  `styg_vz_code`,
  `styg_vz_bas_bedr`,
  `tmp_number_of_records_in_policy`,
  `ltst_mut_dat_p`,
  `munt_code`,
  `pb_aop_bedrag_org`,
  `pb_uitbreidingsleeftijd_kind_nw`,
  `h_end_age`,
  `act_min_toesl_perc`,
  `inact_min_toesl_perc`,
  `act_maatstaf_peil_mnd`,
  `inact_maatstaf_peil_mnd`,
  `vz_vorm_g_1`,
  `vz_vorm_g_2`,
  `vz_vorm_g_3`,
  `vz_vorm_g_4`,
  `vz_vorm_g_5`,
  `vz_vorm_g_6`,
  `vz_vorm_g_7`,
  `vz_vorm_g_8`,
  `byz_5_code_herv_p`,
  `werkgr_nr`,
  `team_nr`,
  `echtsch_vereven_code`,
  `aanw_som_bet_prem_code_p`,
  `h_tot_som_betaalde_prem`,
  `tot_verz`,
  `in_dienst_dat_p`,
  `px_upo_kap_verw_nominaal`,
  `px_bedrag_pg`,
  `px_bedrag_salaris`,
  `px_bedrag_franchise`,
  `h_ingangslft_vz_datum`,
  `h_ingangsleeftijd`,
  `px_upo_idt_nom_op_volgens_verw`,
  `px_upo_udt_nom_op_volgens_verw`,
  `px_upo_idt_nom_pp_volgens_verw`,
  `px_upo_udt_nom_pp_volgens_verw`,
  `px_np_in_dnst_volgens_verw`,
  `px_np_uit_dnst_volgens_verw`,
  `tmp_policy_has_vz_27`,
  `tmp_policy_has_vz_not_in`,
  `tmp_policy_has_vz_65`,
  `act_toesl_jr_t0`,
  `act_verleend_toesl_prc_t0`,
  `act_regl_maatstaf_perc_t0`,
  `inact_toesl_jr_t0`,
  `inact_verleend_toesl_prc_t0`,
  `inact_regl_maatstaf_perc_t0`,
  `act_toesl_jr_tmin1`,
  `act_verleend_toesl_prc_tmin1`,
  `act_regl_maatstaf_perc_tmin1`,
  `act_toesl_jr_tmin2`,
  `act_verleend_toesl_prc_tmin2`,
  `act_regl_maatstaf_perc_tmin2`,
  `act_toesl_jr_tmin3`,
  `act_regl_maatstaf_perc_tmin3`,
  `act_verleend_toesl_prc_tmin3`,
  `act_toesl_jr_tmin4`,
  `act_verleend_toesl_prc_tmin4`,
  `act_regl_maatstaf_perc_tmin4`,
  `inact_toesl_jr_tmin1`,
  `inact_verleend_toesl_prc_tmin1`,
  `inact_regl_maatstaf_perc_tmin1`,
  `inact_toesl_jr_tmin2`,
  `inact_verleend_toesl_prc_tmin2`,
  `inact_regl_maatstaf_perc_tmin2`,
  `inact_toesl_jr_tmin3`,
  `inact_verleend_toesl_prc_tmin3`,
  `inact_regl_maatstaf_perc_tmin3`,
  `inact_toesl_jr_tmin4`,
  `inact_verleend_toesl_prc_tmin4`,
  `inact_regl_maatstaf_perc_tmin4`,
  `h_wpr_afwyk_code`,
  `h_ind_lifelong`,
  `verwdt_log`,
  `puv_id`,
  `facta_jaar_pre`,
  `FACTA_AMOUNT_pre`,
  `tmp_ind_recipient`,
  `tmp_ind_PARTNER_is_exPARTNER`,
  `tmp_ind_kapitaal_bij_leven`,
  `tmp_ind_kapitaal_bij_overlijden`,
  `tmp_ind_split_policy_divorce`,
  `byz_4_code_anw_p`,
  `h_eindlft_op`,
  `eindlft_pr_bet_wp`,
  `lego_netto_groep_ind`,
  `px_mpo_idt_nom_op_volgens_verw`,
  `px_mpo_idt_nom_pp_volgens_verw`,
  `px_mpo_udt_nom_op_volgens_verw`,
  `px_mpo_udt_nom_pp_volgens_verw`,
  `px_mpo_kap_verw_nominaal`,
  `ct_vz`,
  `h_eindlft_vz_datum`,
  `tmp_uit_vz_dat_pre`,
  `tmp_aan_vz_dat_code_5`,
  `tmp_aan_vz_dat_code_n`,
  `tmp_policy_has_vz_20_38`,
  `tmp_policy_has_vz_40_48`,
  `tmp_policy_has_vz_11_19`,
  `veren_pensg_code`,
  `tmp_aan_vz_dat_code_3_flag`,
  `tmp_vz_dat_1_7`,
  `tmp_overeenkomst_TYPE_step1`,
  `ondnr`,
  `naam`,
  `verk_naam`,
  `niet_pw_contract`,
  `upo_verv_code`,
  `soort_rel_code`,
  `bedrijfstak`,
  '7' AS pb_bericht_versie,
  '7' AS pb_bronsysteem_code,
  `mutnr_p` AS pb_versie_id,
  '1' AS pb_label,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
    THEN '2'
    ELSE '1'
  END AS pb_polis_nummer_toevoeging,
  `ltst_mut_dat_p` AS pb_polis_mutatiedatum,
  CONCAT(
    LEFT(`run_timestamp`,4),
    '-',
    SUBSTRING(`run_timestamp`,5,2),
    '-',
    SUBSTRING(`run_timestamp`,7,2),
    '-',
    SUBSTRING(`run_timestamp`,9,2),
    ':',
    SUBSTRING(`run_timestamp`,11,2),
    ':',
    SUBSTRING(`run_timestamp`,13,2)
  ) AS pb_polis_extractiemoment,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2') THEN `geb_dat_verzek_p`
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4' THEN `geb_dat_verzor_p`
      ELSE CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
             AND `echtsch_vereven_code` = '7'
             AND `ct_polis_p` IN ('6','7','10') THEN `geb_dat_verzor_p`
        ELSE CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
               AND `echtsch_vereven_code` <> '7'
               AND `ct_polis_p` IN ('6','7','10') THEN `geb_dat_verzek_p`
          ELSE CASE
            WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
                 AND `ct_polis_p` IN ('8','9') THEN 'm1'
            ELSE 'm2'
          END
        END
      END
    END
  END AS tmp_verzekde_gesl_cd_pubs_format_0,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4' THEN `tmp_verzrgde_gesl_cd_pubs_format`
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
           AND `echtsch_vereven_code` = '7'
           AND `ct_polis_p` IN ('6','7','10') THEN `tmp_verzrgde_gesl_cd_pubs_format`
      ELSE CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
             AND `echtsch_vereven_code` <> '7'
             AND `ct_polis_p` IN ('6','7','10') THEN `tmp_verzekde_gesl_cd_pubs_format`
        ELSE CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm5'
               AND `ct_polis_p` IN ('8','9') THEN ''
          ELSE CASE
            WHEN `tmp_ind_recipient` = '1' THEN `geb_dat_verzor_p`
            ELSE CASE
              WHEN `tmp_ind_recipient` = '2' THEN `geb_dat_verzek_p`
              ELSE ''
            END
          END
        END
      END
    END
  END AS pb_geb_datum_PARTNER,
  CASE
    WHEN (
      LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
      AND `tmp_ind_PARTNER_is_exPARTNER` = 't'
    ) OR `ct_polis_p` IN ('8','9') THEN ''
    ELSE CASE
      WHEN `tmp_ind_recipient` = '1' THEN `tmp_verzrgde_gesl_cd_pubs_format`
      ELSE CASE
        WHEN `tmp_ind_recipient` = '2' THEN `tmp_verzekde_gesl_cd_pubs_format`
        ELSE ''
      END
    END
  END AS pb_geslacht_PARTNER,
  CASE
    WHEN `munt_code` = '250' THEN 'euro'
    ELSE CASE
      WHEN `munt_code` = '50' THEN 'usd'
      ELSE CASE
        WHEN `munt_code` = '9' THEN 'frc'
        ELSE ''
      END
    END
  END AS pb_currency,
  CASE
    WHEN (
      LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m4')
      AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m5')
    )
    OR (
      LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m5')
    ) THEN ''
    ELSE CASE
      WHEN `tmp_policy_has_vz_27` IS NOT NULL
           AND `tmp_policy_has_vz_27` = 'y' THEN CASE
        WHEN `tmp_policy_has_vz_not_in` IS NOT NULL
             AND `tmp_policy_has_vz_not_in` = 'y' THEN CASE
          WHEN `tmp_policy_has_vz_65` IS NOT NULL
               AND `tmp_policy_has_vz_65` = 'y'
               AND `tmp_number_of_records_in_policy` = 2
               AND `aanw_som_bet_prem_code_p` = '2' THEN ''
          ELSE `in_dienst_dat_p`
        END
        ELSE ''
      END
      ELSE `in_dienst_dat_p`
    END
  END AS pb_in_dienst,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND (
           `ct_polis_p` = '10'
           OR `h_status` = 'sl'
         )
         AND `ontslag_dat_p` NOT IN ('','00000000') THEN `ontslag_dat_p`
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m4')
           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
           AND (
             `ct_polis_p` = '10'
             OR `h_status` = 'sl'
           )
           AND `ontslag_dat_p` NOT IN ('','00000000') THEN `ontslag_dat_p`
      ELSE ''
    END
  END AS pb_uit_dienst,
  'n' AS pb_wtp_regeling_jn,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `aep_code_p` IN ('1','2','3','5','6','7','8') THEN 'vw'
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
           AND `aep_code_p` IN ('4','9') THEN 'af'
      ELSE CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
             AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
             AND `aep_code_p` IN ('1','2','3','5','6','7','8') THEN 'vw'
        ELSE CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
               AND `aep_code_p` IN ('4','9') THEN 'af'
          ELSE ''
        END
      END
    END
  END AS pb_code_bnp_verwerkt,
  'n' AS pb_reductie_np_toegepast,
  'n' AS pb_pensioenaanw_variabel_jn,
  CONCAT(`werkgr_nr`,'.',`team_nr`) AS pb_team_id,
  CONCAT('team lego ',`werkgr_nr`,'.',`team_nr`) AS pb_team_naam,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2') THEN `facta_jaar_pre`
    ELSE ''
  END AS pb_factora_jaar,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2') THEN `FACTA_AMOUNT_pre`
    ELSE 0
  END AS pb_factora_bedrag,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `tmp_ind_kapitaal_bij_leven` = 'y'
         AND `vz_cd_pa` IN ('60','61','62','63','64','65')
         AND '1231' = '1231' THEN `px_upo_kap_verw_nominaal`
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
           AND `tmp_ind_kapitaal_bij_leven` = 'y'
           AND `vz_cd_pa` IN ('60','61','62','63','64','65')
           AND '1231' <> '1231' THEN `px_mpo_kap_verw_nominaal`
      ELSE CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
             AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
             AND `tmp_ind_kapitaal_bij_leven` = 'y'
             AND `vz_cd_pa` IN ('60','61','62','63','64','65')
             AND '1231' = '1231' THEN `px_upo_kap_verw_nominaal`
        ELSE CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
               AND `tmp_ind_kapitaal_bij_leven` = 'y'
               AND `vz_cd_pa` IN ('60','61','62','63','64','65')
               AND '1231' <> '1231' THEN `px_mpo_kap_verw_nominaal`
          ELSE 0
        END
      END
    END
  END AS pb_kap_bij_leven_tdns_dnstverb,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `tmp_ind_kapitaal_bij_leven` = 'y'
         AND `vz_cd_pa` IN ('60','61','62','63','64','65')
    THEN ROUND(`px_ingekocht`,2)
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
           AND `tmp_ind_kapitaal_bij_leven` = 'y'
           AND `vz_cd_pa` IN ('60','61','62','63','64','65')
      THEN CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
             AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
             AND `vz_cd_pa` IN ('61','66','67','68','69','70','71') THEN CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
               AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
               AND `vz_cd_pa` = '65'
               AND `aanw_som_bet_prem_code_p` = '2'
               AND `h_tot_som_betaalde_prem` > 0
          THEN ROUND(`h_tot_som_betaalde_prem`,2)
          ELSE CASE
            WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
                 AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                 AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
                 AND `vz_cd_pa` IN ('61','66','67','68','69','70','71')
            THEN 0
          END
        END
      END
    END
  END AS pb_kap_bij_overl_tdns_dnstverb,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
         AND `vz_cd_pa` = '65'
         AND `aanw_som_bet_prem_code_p` = '2'
         AND `h_tot_som_betaalde_prem` > 0
    THEN ROUND(`h_tot_som_betaalde_prem`,2)
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
           AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
           AND `vz_cd_pa` IN ('61','66','67','68','69','70','71')
      THEN CASE
        WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
             AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
             AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
             AND `vz_cd_pa` = '65'
             AND `aanw_som_bet_prem_code_p` = '2'
             AND `h_tot_som_betaalde_prem` > 0
        THEN ROUND(`h_tot_som_betaalde_prem`,2)
        ELSE CASE
          WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
               AND `tmp_ind_kapitaal_bij_overlijden` = 'y'
               AND `vz_cd_pa` IN ('61','66','67','68','69','70','71')
          THEN 0
        END
      END
    END
  END AS pb_kap_bij_overl_na_dnstverb,
  CASE
    WHEN `tmp_ind_kapitaal_bij_overlijden` = 'y' THEN 'k'
    ELSE ''
  END AS pb_ind_kap_bij_overlijden_bron,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `tmp_pensioensoort` = 'act'
    THEN '104wkn'
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
           AND `tmp_pensioensoort` = 'act'
      THEN '104wkn'
      ELSE ''
    END
  END AS pb_aop_TYPE,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
         AND `tmp_pensioensoort` = 'act'
         AND `h_eindlft_ip` IS NOT NULL
         AND `h_eindlft_ip` <> '0'
         AND `h_eindlft_ip` <> ''
    THEN CAST(`h_eindlft_ip` AS INT)*12
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
           AND `tmp_pensioensoort` = 'act'
           AND `h_eindlft_ip` IS NOT NULL
           AND `h_eindlft_ip` <> '0'
           AND `h_eindlft_ip` <> ''
      THEN CAST(`h_eindlft_ip` AS INT)*12
      ELSE ''
    END
  END AS pb_aop_eindleeftijd,
  CASE
    WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2') THEN `pb_aop_bedrag_org`
    ELSE CASE
      WHEN LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
      THEN `pb_aop_bedrag_org`
      ELSE 0
    END
  END AS pb_aop_bedrag,
  'x' AS ____________________________________________,
  CASE
    WHEN `h_sys_code_op` IN ('1','2') AND `h_djr_bep_code` = '0' THEN '10'
    ELSE CASE
      WHEN `h_sys_code_op` IN ('1','2') AND `h_djr_bep_code` = '1' THEN '02'
      ELSE CASE
        WHEN `h_sys_code_op` IN ('1','2') AND `h_djr_bep_code` IN ('2','3') THEN '03'
        ELSE CASE
          WHEN `h_sys_code_op` IN ('1','2') AND `h_djr_bep_code` = '4' THEN '10'
          ELSE CASE
            WHEN `h_sys_code_op` = '3' THEN '06'
            ELSE CASE
              WHEN `h_sys_code_op` = '7' THEN '04'
              ELSE CASE
                WHEN `h_sys_code_op` IN ('8','9','10','11','12','13') THEN '05'
                ELSE CASE
                  WHEN `h_sys_code_op` IN ('4','5','6') OR `h_sys_code_op` > '14' THEN '10'
                  ELSE CASE
                    WHEN `h_sys_code_op` = '14' THEN '07'
                    ELSE CASE
                      WHEN `h_sys_code_kap` IN ('1','2','3','4','5','6') THEN '04'
                      ELSE CASE
                        WHEN `h_sys_code_kap` IN ('7','8','9','10') THEN '05'
                        ELSE CASE
                          WHEN `h_sys_code_wp` IN ('1','2') AND `h_djr_bep_code` = '0' THEN '10'
                          ELSE CASE
                            WHEN `h_sys_code_wp` IN ('1','2') AND `h_djr_bep_code` = '1' THEN '02'
                            ELSE CASE
                              WHEN `h_sys_code_wp` IN ('1','2') AND `h_djr_bep_code` IN ('2','3') THEN '03'
                              ELSE CASE
                                WHEN `h_sys_code_wp` IN ('1','2') AND `h_djr_bep_code` = '4' THEN '10'
                                ELSE CASE
                                  WHEN `h_sys_code_wp` = '3' THEN '06'
                                  ELSE CASE
                                    WHEN `h_sys_code_wp` = '7' THEN '04'
                                    ELSE CASE
                                      WHEN `h_sys_code_wp` IN ('10','11','12','13') THEN '05'
                                      ELSE CASE
                                        WHEN `h_sys_code_wp` IN ('4','5','6','8','9') THEN ''
                                        ELSE ''
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_srt_pensioen,
  CASE
    WHEN `verzekde_gesl_cd` = '1' THEN 'm'
    ELSE CASE
      WHEN `verzekde_gesl_cd` = '2' THEN 'v'
      ELSE ''
    END
  END AS tmp_verzekde_gesl_cd_pubs_format,
  CASE
    WHEN `verzrgde_gesl_cd` = '1' THEN 'm'
    ELSE CASE
      WHEN `verzrgde_gesl_cd` = '2' THEN 'v'
      ELSE ''
    END
  END AS tmp_verzrgde_gesl_cd_pubs_format,
  CASE
    WHEN (
      LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m4')
      AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m5')
    ) OR (
      LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m5')
    )
    THEN ''
    ELSE CASE
      WHEN `vz_cd_pa` IN ('11','12','13','14','18','19') THEN 'op'
      ELSE CASE
        WHEN `vz_cd_pa` IN ('15','16') THEN 'opt'
        ELSE CASE
          WHEN `vz_cd_pa` IN ('17') THEN 'opo'
          ELSE CASE
            WHEN `vz_cd_pa` IN ('20','21','22','30','31','32','40','42')
            THEN 'm1'
            ELSE CASE
              WHEN `vz_cd_pa` IN ('20','21','22','30','31','32','40','42')
                   AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
              THEN 'bpp'
              ELSE CASE
                WHEN `vz_cd_pa` IN ('23','24','33','34','43','44','50')
                THEN 'm1'
                ELSE CASE
                  WHEN `vz_cd_pa` IN ('23','24','33','34','43','44','50')
                       AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                  THEN 'bppt'
                  ELSE CASE
                    WHEN `vz_cd_pa` IN ('35','45') THEN 'm1'
                    ELSE CASE
                      WHEN `vz_cd_pa` IN ('35','45')
                           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                      THEN 'bppl'
                      ELSE CASE
                        WHEN `vz_cd_pa` IN ('35','45') THEN 'm1'
                        ELSE CASE
                          WHEN `vz_cd_pa` IN ('35','45') THEN 'm1'
                          ELSE CASE
                            WHEN `vz_cd_pa` IN ('35','45')
                                 AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                            THEN 'bppt'
                            ELSE CASE
                              WHEN `vz_cd_pa` IN ('35','45')
                                   AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                              THEN 'bpptu'
                              ELSE CASE
                                WHEN `vz_cd_pa` IN ('25','27') THEN 'anw'
                                ELSE CASE
                                  WHEN `vz_cd_pa` IN ('47')
                                       AND `h_wpr_afwyk_code` = '2'
                                  THEN 'anw'
                                  ELSE CASE
                                    WHEN `vz_cd_pa` IN ('37','47')
                                         AND `h_ind_lifelong` = 'y'
                                         AND `h_wpr_afwyk_code` <> '2'
                                    THEN 'pp_risk'
                                    ELSE CASE
                                      WHEN `vz_cd_pa` IN ('37','47')
                                           AND `h_ind_lifelong` = 'n'
                                      THEN 'ppt_risk'
                                      ELSE CASE
                                        WHEN `vz_cd_pa` IN ('28','38','48')
                                        THEN 'm1'
                                        ELSE CASE
                                          WHEN `vz_cd_pa` IN ('28','38','48')
                                               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                          THEN 'bppu'
                                          ELSE CASE
                                            WHEN `vz_cd_pa` IN ('28','38','48')
                                            THEN 'm1'
                                            ELSE CASE
                                              WHEN `vz_cd_pa` IN ('28','38','48')
                                                   AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                              THEN 'bppu_pd'
                                              ELSE CASE
                                                WHEN `vz_cd_pa` IN ('51','52','53','54','55','56','57','58','59')
                                                     AND `px_ingekocht` = 0
                                                THEN 'wzp_risk'
                                                ELSE CASE
                                                  WHEN `vz_cd_pa` IN ('51','52','53','54','55','56','57','58','59')
                                                  THEN 'wzp'
                                                  ELSE CASE
                                                    WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                         AND `px_TYPE_aanwending` = '1'
                                                    THEN 'kaplvn1'
                                                    ELSE CASE
                                                      WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                           AND `px_TYPE_aanwending` = '2'
                                                      THEN 'kaplvn2'
                                                      ELSE CASE
                                                        WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                             AND `px_TYPE_aanwending` = '3'
                                                             AND LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
                                                        THEN 'kaplvn3'
                                                        ELSE CASE
                                                          WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                               AND `px_TYPE_aanwending` = '3'
                                                               AND LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
                                                               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                          THEN 'bkaplvn3'
                                                          ELSE CASE
                                                            WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                                 AND `px_TYPE_aanwending` = '4'
                                                                 AND LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m1','m2')
                                                            THEN 'kaplvn4'
                                                            ELSE CASE
                                                              WHEN `vz_cd_pa` IN ('60','62','63','64')
                                                                   AND `px_TYPE_aanwending` = '4'
                                                                   AND LEFT(`tmp_overeenkomst_TYPE_step2`,2) = 'm4'
                                                                   AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                              THEN 'bkaplvn4'
                                                              ELSE CASE
                                                                WHEN `vz_cd_pa` IN ('61','65')
                                                                THEN 'm1'
                                                                ELSE CASE
                                                                  WHEN `vz_cd_pa` IN ('61','65')
                                                                       AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                  THEN 'bkaplvn1ovl'
                                                                  ELSE CASE
                                                                    WHEN `vz_cd_pa` IN ('61','65')
                                                                    THEN 'm1'
                                                                    ELSE CASE
                                                                      WHEN `vz_cd_pa` IN ('61','65')
                                                                           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                      THEN 'bkaplvn2ovl'
                                                                      ELSE CASE
                                                                        WHEN `vz_cd_pa` IN ('61','65')
                                                                        THEN 'm1'
                                                                        ELSE CASE
                                                                          WHEN `vz_cd_pa` IN ('61','65')
                                                                               AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                          THEN 'bkaplvn3ovl'
                                                                          ELSE CASE
                                                                            WHEN `vz_cd_pa` IN ('61','65')
                                                                            THEN 'm1'
                                                                            ELSE CASE
                                                                              WHEN `vz_cd_pa` IN ('61','65')
                                                                                   AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                              THEN 'bkaplvn4ovl'
                                                                              ELSE CASE
                                                                                WHEN `vz_cd_pa` IN ('66','67')
                                                                                THEN 'm1'
                                                                                ELSE CASE
                                                                                  WHEN `vz_cd_pa` IN ('66','67')
                                                                                       AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                                  THEN 'bkapovlll'
                                                                                  ELSE CASE
                                                                                    WHEN `vz_cd_pa` IN ('68','69','70','71')
                                                                                    THEN 'm1'
                                                                                    ELSE CASE
                                                                                      WHEN `vz_cd_pa` IN ('68','69','70','71')
                                                                                           AND LEFT(`tmp_overeenkomst_TYPE_step1`,2) IN ('m1','m2')
                                                                                      THEN 'bkapovl'
                                                                                      ELSE CASE
                                                                                        WHEN `vz_cd_pa` IN ('81')
                                                                                        THEN 'erf'
                                                                                        ELSE CASE
                                                                                          WHEN `vz_cd_pa` IN ('82','83')
                                                                                          THEN 'm5'
                                                                                          ELSE ''
                                                                                        END
                                                                                      END
                                                                                    END
                                                                                  END
                                                                                END
                                                                              END
                                                                            END
                                                                          END
                                                                        END
                                                                      END
                                                                    END
                                                                  END
                                                                END
                                                              END
                                                            END
                                                          END
                                                        END
                                                      END
                                                    END
                                                  END
                                                END
                                              END
                                            END
                                          END
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_VZ_GROUP_lat,
  CASE
    WHEN `h_status` IN ('ac','st') THEN 'act'
    ELSE CASE
      WHEN `h_status` IN ('as','sl') THEN 'ina'
      ELSE CASE
        WHEN `h_status` = 'ge' THEN 'uit'
        ELSE ''
      END
    END
  END AS tmp_pensioensoort,
  CASE
    WHEN NOT (LEFT(`tmp_overeenkomst_TYPE_step2`,2) IN ('m5')) THEN ''
    ELSE CASE
      WHEN `vz_cd_pa` IN ('11','12','13','14','18','19')
           AND `echtsch_vereven_code` <> '7'
      THEN 'op_uit'
      ELSE CASE
        WHEN `vz_cd_pa` IN ('11','12','13','14','18','19')
             AND `echtsch_vereven_code` = '7'
        THEN 'op_uit_ver'
        ELSE CASE
          WHEN `vz_cd_pa` IN ('15','16')
               AND `echtsch_vereven_code` <> '7'
          THEN 'opt_uit'
          ELSE CASE
            WHEN `vz_cd_pa` IN ('15','16')
                 AND `echtsch_vereven_code` = '7'
            THEN 'opt_uit_ver'
            ELSE CASE
              WHEN `vz_cd_pa` IN ('17')
              THEN 'opo_uit'
              ELSE CASE
                WHEN `vz_cd_pa` IN ('20','21','22','30','31','32','40','42')
                THEN 'pp_uit'
                ELSE CASE
                  WHEN `vz_cd_pa` IN ('35','45') AND `h_ind_lifelong` = 'y'
                  THEN 'pp_uit'
                  ELSE CASE
                    WHEN `vz_cd_pa` IN ('23','24','33','34','35','43','44','45','50')
                         AND `h_ind_lifelong` = 'n'
                    THEN 'ppt_uit'
                    ELSE CASE
                      WHEN `vz_cd_pa` IN ('25','27') AND `ct_vz` = '0'
                      THEN 'anw_uit_ctvz0'
                      ELSE CASE
                        WHEN `vz_cd_pa` IN ('25','27')
                        THEN 'anw_uit'
                        ELSE CASE
                          WHEN `vz_cd_pa` IN ('47')
                               AND `h_wpr_afwyk_code` = '2'
                               AND `ct_vz` = '0'
                          THEN 'anw_uit_ctvz0'
                          ELSE CASE
                            WHEN `vz_cd_pa` IN ('47')
                                 AND `h_wpr_afwyk_code` = '2'
                            THEN 'anw_uit'
                            ELSE CASE
                              WHEN `vz_cd_pa` IN ('37','47')
                                   AND `h_ind_lifelong` = 'y'
                                   AND `h_wpr_afwyk_code` <> '2'
                              THEN 'pp_risk_uit'
                              ELSE CASE
                                WHEN `vz_cd_pa` IN ('37','47')
                                     AND `h_ind_lifelong` = 'n'
                                THEN 'ppt_risk_uit'
                                ELSE CASE
                                  WHEN `vz_cd_pa` IN ('28','38','48')
                                       AND `ct_vz` = '0'
                                  THEN 'ppu_uit_ctvz0'
                                  ELSE CASE
                                    WHEN `vz_cd_pa` IN ('28','38','48')
                                    THEN 'ppu_uit'
                                    ELSE CASE
                                      WHEN `vz_cd_pa` IN ('51','52','53','54','55','56','57','58','59')
                                      THEN 'wzp_uit'
                                      ELSE CASE
                                        WHEN `vz_cd_pa` IN ('81')
                                        THEN 'erf_uit'
                                        ELSE CASE
                                          WHEN `vz_cd_pa` IN ('82','83')
                                          THEN 'aop_uit'
                                          ELSE ''
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS tmp_VZ_GROUP_uit
FROM `join_8`;


CREATE OR REPLACE TEMPORARY VIEW join_6 AS
SELECT
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.tmp_overeenkomst_TYPE_step2,
  t2.pb_beschikbare_premie_org,
  t1.relnr,
  t1.grpnr,
  t1.versie_nr,
  t1.wyze_bet,
  t1.aanvangs_dat,
  t1.h_status,
  t1.ontslag_dat_p,
  t1.h_post_met_fin,
  t1.h_franch,
  t1.ct_polis_p,
  t1.h_sys_code_op,
  t1.h_inval_ad,
  t1.h_perc_op_1,
  t1.run_id,
  t1.reference_date,
  t1.verwdt,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.parttime_perc_dt_p,
  t1.h_einddat,
  t1.djr_v_dat_p,
  t1.wzp_inv_std_endlft,
  t1.eindlft_wzp_p,
  t1.is_dekkings_code,
  t1.act_toesl_cat,
  t1.inact_toesl_cat,
  t1.act_toesl_mom,
  t1.inact_toesl_mom,
  t1.act_max_toesl_perc,
  t1.inact_max_toesl_perc,
  t1.act_fin_TYPE,
  t1.inact_fin_TYPE,
  t1.act_maatstaf_TYPE,
  t1.inact_maatstaf_TYPE,
  t1.reglement_aand,
  t1.h_end_age,
  t1.act_min_toesl_perc,
  t1.inact_min_toesl_perc,
  t1.act_maatstaf_peil_mnd,
  t1.inact_maatstaf_peil_mnd,
  t1.vz_vorm_g_1,
  t1.vz_vorm_g_2,
  t1.vz_vorm_g_3,
  t1.vz_vorm_g_4,
  t1.vz_vorm_g_5,
  t1.vz_vorm_g_6,
  t1.vz_vorm_g_7,
  t1.vz_vorm_g_8,
  t1.byz_5_code_herv_p,
  t1.h_djr_bep_code,
  t1.echtsch_vereven_code,
  t1.px_bedrag_pg,
  t1.px_bedrag_salaris,
  t1.px_bedrag_franchise,
  t1.act_toesl_jr_t0,
  t1.act_verleend_toesl_prc_t0,
  t1.act_regl_maatstaf_perc_t0,
  t1.inact_toesl_jr_t0,
  t1.inact_verleend_toesl_prc_t0,
  t1.inact_regl_maatstaf_perc_t0,
  t1.act_toesl_jr_tmin1,
  t1.act_verleend_toesl_prc_tmin1,
  t1.act_regl_maatstaf_perc_tmin1,
  t1.act_toesl_jr_tmin2,
  t1.act_verleend_toesl_prc_tmin2,
  t1.act_regl_maatstaf_perc_tmin2,
  t1.act_toesl_jr_tmin3,
  t1.act_regl_maatstaf_perc_tmin3,
  t1.act_verleend_toesl_prc_tmin3,
  t1.act_toesl_jr_tmin4,
  t1.act_verleend_toesl_prc_tmin4,
  t1.act_regl_maatstaf_perc_tmin4,
  t1.inact_toesl_jr_tmin1,
  t1.inact_verleend_toesl_prc_tmin1,
  t1.inact_regl_maatstaf_perc_tmin1,
  t1.inact_toesl_jr_tmin2,
  t1.inact_verleend_toesl_prc_tmin2,
  t1.inact_regl_maatstaf_perc_tmin2,
  t1.inact_toesl_jr_tmin3,
  t1.inact_verleend_toesl_prc_tmin3,
  t1.inact_regl_maatstaf_perc_tmin3,
  t1.inact_toesl_jr_tmin4,
  t1.inact_verleend_toesl_prc_tmin4,
  t1.inact_regl_maatstaf_perc_tmin4,
  t1.h_ingangsleeftijd,
  t1.puv_id,
  t1.pb_betaalde_premie,
  t1.pb_vrijgestelde_premie_org,
  t1.byz_4_code_anw_p,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.styg_vz_code,
  t1.styg_vz_perc,
  t1.lego_netto_groep_ind,
  t1.tmp_policy_has_vz_20_38,
  t1.tmp_policy_has_vz_40_48,
  t1.tmp_policy_has_vz_11_19,
  t1.veren_pensg_code,
  t1.tmp_pensioensoort,
  t1.tmp_overeenkomst_TYPE_step1
FROM join_7 t1
LEFT JOIN besch_premie t2
  ON t1.relnr = t2.relnr
  AND t1.volgnr = t2.volgnr
  AND t1.vz_cd_pa = t2.vz_cd_pa;


CREATE OR REPLACE TEMPORARY VIEW xml_lvl_logic_1 AS
SELECT
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  SUM(pb_kap_bij_leven_tdns_dnstverb) AS pb_kap_bij_leven_tdns_dnstverb,
  SUM(pb_kap_bij_leven_na_dnstverb) AS pb_kap_bij_leven_na_dnstverb,
  SUM(pb_kap_bij_overl_tdns_dnstverb) AS pb_kap_bij_overl_tdns_dnstverb,
  SUM(pb_kap_bij_overl_na_dnstverb) AS pb_kap_bij_overl_na_dnstverb,
  MAX(tmp_ind_kapitaal_bij_leven) AS tmp_ind_kapitaal_bij_leven,
  MAX(tmp_ind_kapitaal_bij_overlijden) AS tmp_ind_kapitaal_bij_overlijden,
  MAX(pb_ind_kap_bij_leven_bron) AS pb_ind_kap_bij_leven_bron,
  MAX(pb_ind_kap_bij_overlijden_bron) AS pb_ind_kap_bij_overlijden_bron
FROM generic_logic
GROUP BY pb_polis_nummer, pb_polis_nummer_toevoeging;


CREATE OR REPLACE TEMPORARY VIEW versch_premie AS
SELECT
  relnr,
  volgnr,
  pb_verschuldigde_premie AS pb_betaalde_premie,
  pb_vrijgestelde_premie AS pb_vrijgestelde_premie_org
FROM cv_dec_cv_dlo_pubs_versch_premie;


CREATE OR REPLACE TEMPORARY VIEW xml_lvl_logic_2 AS
SELECT
  t2.pb_polis_nummer,
  t2.pb_polis_nummer_toevoeging,
  t2.tmp_overeenkomst_TYPE_step2,
  t2.relnr,
  t2.grpnr,
  t2.versie_nr,
  t2.wyze_bet,
  t2.aanvangs_dat,
  t2.h_status,
  t2.ontslag_dat_p,
  t2.h_post_met_fin,
  t2.h_franch,
  t2.ct_polis_p,
  t2.h_sys_code_op,
  t2.h_inval_ad,
  t2.h_perc_op_1,
  t2.run_id,
  t2.reference_date,
  t2.verwdt,
  t2.volgnr,
  t2.vz_cd_pa,
  t2.parttime_perc_dt_p,
  t2.h_einddat,
  t2.djr_v_dat_p,
  t2.wzp_inv_std_endlft,
  t2.eindlft_wzp_p,
  t2.is_dekkings_code,
  t2.act_toesl_cat,
  t2.inact_toesl_cat,
  t2.act_toesl_mom,
  t2.inact_toesl_mom,
  t2.act_max_toesl_perc,
  t2.inact_max_toesl_perc,
  t2.act_fin_TYPE,
  t2.inact_fin_TYPE,
  t2.act_maatstaf_TYPE,
  t2.inact_maatstaf_TYPE,
  t2.reglement_aand,
  t2.h_end_age,
  t2.act_min_toesl_perc,
  t2.inact_min_toesl_perc,
  t2.act_maatstaf_peil_mnd,
  t2.inact_maatstaf_peil_mnd,
  t2.vz_vorm_g_1,
  t2.vz_vorm_g_2,
  t2.vz_vorm_g_3,
  t2.vz_vorm_g_4,
  t2.vz_vorm_g_5,
  t2.vz_vorm_g_6,
  t2.vz_vorm_g_7,
  t2.vz_vorm_g_8,
  t2.byz_5_code_herv_p,
  t2.h_djr_bep_code,
  t2.echtsch_vereven_code,
  t2.px_bedrag_pg,
  t2.px_bedrag_salaris,
  t2.px_bedrag_franchise,
  t2.act_toesl_jr_t0,
  t2.act_verleend_toesl_prc_t0,
  t2.act_regl_maatstaf_perc_t0,
  t2.inact_toesl_jr_t0,
  t2.inact_verleend_toesl_prc_t0,
  t2.inact_regl_maatstaf_perc_t0,
  t2.act_toesl_jr_tmin1,
  t2.act_verleend_toesl_prc_tmin1,
  t2.act_regl_maatstaf_perc_tmin1,
  t2.act_toesl_jr_tmin2,
  t2.act_verleend_toesl_prc_tmin2,
  t2.act_regl_maatstaf_perc_tmin2,
  t2.act_toesl_jr_tmin3,
  t2.act_regl_maatstaf_perc_tmin3,
  t2.act_verleend_toesl_prc_tmin3,
  t2.act_toesl_jr_tmin4,
  t2.act_verleend_toesl_prc_tmin4,
  t2.act_regl_maatstaf_perc_tmin4,
  t2.inact_toesl_jr_tmin1,
  t2.inact_verleend_toesl_prc_tmin1,
  t2.inact_regl_maatstaf_perc_tmin1,
  t2.inact_toesl_jr_tmin2,
  t2.inact_verleend_toesl_prc_tmin2,
  t2.inact_regl_maatstaf_perc_tmin2,
  t2.inact_toesl_jr_tmin3,
  t2.inact_verleend_toesl_prc_tmin3,
  t2.inact_regl_maatstaf_perc_tmin3,
  t2.inact_toesl_jr_tmin4,
  t2.inact_verleend_toesl_prc_tmin4,
  t2.inact_regl_maatstaf_perc_tmin4,
  t2.h_ingangsleeftijd,
  t2.puv_id,
  t2.pb_beschikbare_premie_org,
  t2.pb_betaalde_premie pb_betaalde_premie_org,
  t2.pb_vrijgestelde_premie_org,
  t2.byz_4_code_anw_p,
  t2.h_eindlft_op,
  t2.eindlft_pr_bet_wp,
  t2.styg_vz_code,
  t2.styg_vz_perc,
  t2.lego_netto_groep_ind,
  t2.tmp_policy_has_vz_20_38,
  t2.tmp_policy_has_vz_40_48,
  t2.tmp_policy_has_vz_11_19,
  t2.veren_pensg_code,
  t2.tmp_pensioensoort,
  t2.tmp_overeenkomst_TYPE_step1,
  t1.vz_cd_pa AS join_vz_cd_pa_vz_cd_pa,
  t1.pb_polis_nummer AS join_pb_polis_nummer_pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging AS join_pb_polis_nummer_toevoeging_pb_polis_nummer_toevoeging,
  CONCAT(t2.relnr, t2.grpnr, t2.versie_nr) AS pb_pensioenregeling_nummer,
  CASE WHEN t2.puv_id = '' THEN 'u0018' ELSE t2.puv_id END AS pb_pensioenuitvoerder_code,
  CASE WHEN t2.wyze_bet = '1' OR t2.lego_netto_groep_ind = 'j' THEN 'j' ELSE 'n' END AS pb_ind_regeling_netto_jn,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.aanvangs_dat NOT IN ('00000000','')
    THEN t2.aanvangs_dat
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.aanvangs_dat NOT IN ('00000000','')
    THEN t2.aanvangs_dat
    ELSE ''
  END AS pb_pensioenregeling_ingangsdat,
  t2.djr_v_dat_p AS pb_datum_begin_deelneming,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4' THEN '8'
    WHEN t2.h_status IN ('as','ac') AND t2.h_post_met_fin = 'y' THEN '1'
    WHEN t2.h_status IN ('as','ac') AND t2.h_post_met_fin = 'n' THEN '6'
    WHEN t2.h_status = 'sl' THEN '2'
    WHEN t2.h_status = 'st' AND t2.ontslag_dat_p = '00000000' THEN '3'
    WHEN t2.h_status = 'st' AND t2.ontslag_dat_p != '00000000' THEN '7'
    WHEN t2.h_status = 'ge' THEN '5'
    ELSE ''
  END AS pb_deelname_status_code,
  0 AS pb_aanvullende_premie,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.h_inval_ad = 'n'
         AND t2.tmp_pensioensoort = 'act'
    THEN ROUND(t2.px_bedrag_franchise,2)
    ELSE 0
  END AS pb_franchise,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.h_inval_ad = 'n'
         AND t2.tmp_pensioensoort = 'act'
    THEN ROUND(t2.px_bedrag_salaris,2)
    ELSE 0
  END AS pb_pensioengevend_salaris,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.h_inval_ad = 'n'
         AND t2.tmp_pensioensoort = 'act'
    THEN ROUND(t2.px_bedrag_pg,2)
    ELSE 0
  END AS pb_pensioengrondslag,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.h_status != 'sl'
         AND t2.ct_polis_p != '5'
         AND t2.h_inval_ad = 'n'
         AND t2.h_sys_code_op NOT IN ('8','9','10','11','12','13')
         AND t2.h_perc_op_1 != 0
         AND t2.h_perc_op_1 < 10
         AND t2.tmp_pensioensoort = 'act'
    THEN t2.h_perc_op_1
    ELSE 0
  END AS pb_perc_opbouw,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
         AND t2.h_status != 'sl'
         AND t2.ct_polis_p != '5'
         AND t2.h_inval_ad = 'n'
         AND t2.parttime_perc_dt_p != 0
    THEN t2.parttime_perc_dt_p
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
         AND t2.h_status != 'sl'
         AND t2.ct_polis_p != '5'
         AND t2.h_inval_ad = 'n'
    THEN 100
    ELSE 0
  END AS pb_perc_deeltijd,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN t2.h_einddat
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN t2.h_einddat
    ELSE ''
  END AS pb_pensioendatum,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN t2.djr_v_dat_p
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN t2.djr_v_dat_p
    ELSE ''
  END AS pb_datum_begin_opbouw,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND (t2.ct_polis_p = '10' OR t2.h_status = 'sl')
         AND t2.ontslag_dat_p NOT IN ('','00000000')
    THEN t2.ontslag_dat_p
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND (t2.ct_polis_p = '10' OR t2.h_status = 'sl')
         AND t2.ontslag_dat_p NOT IN ('','00000000')
    THEN t2.ontslag_dat_p
    ELSE ''
  END AS pb_datum_einde_deelneming,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
         AND t2.is_dekkings_code != '1'
         AND pb_deelname_status_code = '1'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
    THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
         AND t2.is_dekkings_code != '1'
         AND pb_deelname_status_code = '1'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.tmp_pensioensoort = 'act'
    THEN 'n'
    ELSE ''
  END AS pb_ind_premievrijst_jn,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.h_status = 'st'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
    THEN 'n'
    ELSE ''
  END AS pb_ind_premievrijst_ing_jn,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.act_toesl_cat IN ('2','3','4','5','6','99')
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
    THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.act_toesl_cat IN ('2','3','4','5','6','99')
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN 'n'
    ELSE ''
  END AS pb_ind_toeslag_actief,
  CASE
    WHEN t2.inact_toesl_cat IN ('2','3','4','5','6','99')
    THEN 'j'
    ELSE 'n'
  END AS pb_ind_toeslag_inactief,
  CASE
    WHEN t2.styg_vz_code = '14' AND t2.relnr != '25737' THEN 'n'
    WHEN NOT (pb_ind_toeslag_actief = 'j' OR pb_ind_toeslag_inactief = 'j') THEN ''
    WHEN (pb_ind_toeslag_actief = 'j' OR pb_ind_toeslag_inactief = 'j')
         AND (
           t2.act_toesl_mom != t2.inact_toesl_mom
           OR t2.act_toesl_cat != t2.inact_toesl_cat
           OR t2.act_max_toesl_perc != t2.inact_max_toesl_perc
           OR t2.act_min_toesl_perc != t2.inact_min_toesl_perc
           OR t2.act_fin_TYPE != t2.inact_fin_TYPE
           OR t2.act_maatstaf_TYPE != t2.inact_maatstaf_TYPE
           OR t2.act_maatstaf_peil_mnd != t2.inact_maatstaf_peil_mnd
         )
    THEN 'j'
    ELSE 'n'
  END AS pb_ind_toeslag_act_inact_afw,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN 'n'
    ELSE ''
  END AS pb_ind_rendementsgar_actief_jn,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code IN ('4','5','6','7')
         AND t2.tmp_policy_has_vz_11_19 IS NULL
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '1'
    THEN '0'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '2'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '3'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '5'
    THEN '2'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '4'
    THEN '2'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '6'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '7'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '1'
    THEN '0'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '2'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '3'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '5'
    THEN '2'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '4'
    THEN '2'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '6'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '7'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code = '1'
    THEN '0'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code IN ('2','3')
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code IN ('4','5','6','7')
         AND t2.tmp_policy_has_vz_11_19 = 'y'
    THEN '2'
    ELSE ''
  END AS pb_verevening_status,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code IN ('4','5','6','7')
         AND t2.tmp_policy_has_vz_11_19 IS NULL
    THEN ''
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '5'
    THEN '3'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm1'
         AND t2.echtsch_vereven_code = '4'
    THEN '4'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '5'
    THEN '3'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm2'
         AND t2.echtsch_vereven_code = '4'
    THEN '4'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code = '6'
         AND t2.tmp_policy_has_vz_11_19 = 'y'
    THEN '2'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code = '7'
         AND t2.tmp_policy_has_vz_11_19 = 'y'
    THEN '1'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code = '5'
         AND t2.tmp_policy_has_vz_11_19 = 'y'
    THEN '3'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.echtsch_vereven_code = '4'
         AND t2.tmp_policy_has_vz_11_19 = 'y'
    THEN '4'
    ELSE ''
  END AS pb_verevening_code,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND (t2.h_status = 'ac' OR (t2.h_status = 'sl' AND t2.reglement_aand = 'j'))
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
    THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND (t2.h_status = 'ac' OR (t2.h_status = 'sl' AND t2.reglement_aand = 'j'))
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN 'n'
    ELSE ''
  END AS pb_p123_tonen,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_policy_has_vz_20_38 = 'y'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.tmp_policy_has_vz_40_48 = 'y'
    THEN 'o'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_1 >= '20' AND t2.vz_vorm_g_1 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_2 >= '20' AND t2.vz_vorm_g_2 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_3 >= '20' AND t2.vz_vorm_g_3 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_4 >= '20' AND t2.vz_vorm_g_4 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_5 >= '20' AND t2.vz_vorm_g_5 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_6 >= '20' AND t2.vz_vorm_g_6 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_7 >= '20' AND t2.vz_vorm_g_7 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
         AND t2.vz_vorm_g_8 >= '20' AND t2.vz_vorm_g_8 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2')
    THEN 'o'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.tmp_policy_has_vz_20_38 = 'y'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.tmp_policy_has_vz_40_48 = 'y'
    THEN 'o'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_1 >= '20' AND t2.vz_vorm_g_1 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_2 >= '20' AND t2.vz_vorm_g_2 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_3 >= '20' AND t2.vz_vorm_g_3 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_4 >= '20' AND t2.vz_vorm_g_4 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_5 >= '20' AND t2.vz_vorm_g_5 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_6 >= '20' AND t2.vz_vorm_g_6 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_7 >= '20' AND t2.vz_vorm_g_7 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
         AND t2.vz_vorm_g_8 >= '20' AND t2.vz_vorm_g_8 <= '38'
    THEN 'b'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN 'o'
    ELSE ''
  END AS pb_code_PARTNER_bep_onbep,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) = 'm5'
         AND t2.byz_5_code_herv_p = '2'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) = 'm5'
    THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.byz_5_code_herv_p = '2'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
    THEN 'n'
    ELSE ''
  END AS pb_ind_herverzekerd_jn,
  CASE
    WHEN t2.byz_4_code_anw_p = '1' THEN 'j'
    WHEN t2.byz_4_code_anw_p = '2' THEN 'n'
    ELSE ''
  END AS pb_anw_basis_jn,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14' AND t2.relnr != '25737' THEN 'f1'
    WHEN t2.h_status IN ('ac','st') THEN tmp_toeslag_variant_act
    ELSE tmp_toeslag_variant_inact
  END AS pb_toeslag_variant,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14' AND t2.relnr != '25737' THEN 'i'
    WHEN t2.h_status IN ('ac','st') THEN 'a'
    ELSE 'i'
  END AS pb_toeslag_status,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14' AND t2.relnr != '25737' THEN 'm006'
    WHEN t2.h_status IN ('ac','st') THEN tmp_maatstaf_act
    ELSE tmp_maatstaf_inact
  END AS pb_maatstaf,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14' AND t2.relnr != '25737' THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_max_toesl_perc > 0 THEN t2.act_max_toesl_perc
    WHEN t2.inact_max_toesl_perc > 0 THEN t2.inact_max_toesl_perc
    ELSE 0
  END AS pb_maximale_verhoging,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND CAST(LEFT(t2.reference_date,4) AS INT) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN LEFT(t2.reference_date,4)
    WHEN t2.h_status IN ('ac','st') AND t2.act_toesl_jr_t0 > '0' THEN t2.act_toesl_jr_t0
    WHEN t2.inact_toesl_jr_t0 > '0' THEN t2.inact_toesl_jr_t0
    ELSE ''
  END AS pb_toeslag_jaar_t0,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND CAST(LEFT(t2.reference_date,4) AS INT) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_verleend_toesl_prc_t0 > 0 THEN t2.act_verleend_toesl_prc_t0
    WHEN t2.inact_verleend_toesl_prc_t0 > 0 THEN t2.inact_verleend_toesl_prc_t0
    ELSE 0
  END AS pb_toeslag_percentage_t0,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 1) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN CAST(LEFT(t2.reference_date,4) AS INT) - 1
    WHEN t2.h_status IN ('ac','st') AND t2.act_toesl_jr_tmin1 > '0' THEN t2.act_toesl_jr_tmin1
    WHEN t2.inact_toesl_jr_tmin1 > '0' THEN t2.inact_toesl_jr_tmin1
    ELSE ''
  END AS pb_toeslag_jaar_t1,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 1) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_verleend_toesl_prc_tmin1 > 0 THEN t2.act_verleend_toesl_prc_tmin1
    WHEN t2.inact_verleend_toesl_prc_tmin1 > 0 THEN t2.inact_verleend_toesl_prc_tmin1
    ELSE 0
  END AS pb_toeslag_percentage_t1,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 2) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN CAST(LEFT(t2.reference_date,4) AS INT) - 2
    WHEN t2.h_status IN ('ac','st') AND t2.act_toesl_jr_tmin2 > '0' THEN t2.act_toesl_jr_tmin2
    WHEN t2.inact_toesl_jr_tmin2 > '0' THEN t2.inact_toesl_jr_tmin2
    ELSE ''
  END AS pb_toeslag_jaar_t2,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 2) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_verleend_toesl_prc_tmin2 > 0 THEN t2.act_verleend_toesl_prc_tmin2
    WHEN t2.inact_verleend_toesl_prc_tmin2 > 0 THEN t2.inact_verleend_toesl_prc_tmin2
    ELSE 0
  END AS pb_toeslag_percentage_t2,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 3) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN CAST(LEFT(t2.reference_date,4) AS INT) - 3
    WHEN t2.h_status IN ('ac','st') AND t2.act_toesl_jr_tmin3 > '0' THEN t2.act_toesl_jr_tmin3
    WHEN t2.inact_toesl_jr_tmin3 > '0' THEN t2.inact_toesl_jr_tmin3
    ELSE ''
  END AS pb_toeslag_jaar_t3,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 3) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_verleend_toesl_prc_tmin3 > 0 THEN t2.act_verleend_toesl_prc_tmin3
    WHEN t2.inact_verleend_toesl_prc_tmin3 > 0 THEN t2.inact_verleend_toesl_prc_tmin3
    ELSE 0
  END AS pb_toeslag_percentage_t3,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN ''
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 4) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN CAST(LEFT(t2.reference_date,4) AS INT) - 4
    WHEN t2.h_status IN ('ac','st') AND t2.act_toesl_jr_tmin4 > '0' THEN t2.act_toesl_jr_tmin4
    WHEN t2.inact_toesl_jr_tmin4 > '0' THEN t2.inact_toesl_jr_tmin4
    ELSE ''
  END AS pb_toeslag_jaar_t4,
  CASE
    WHEN t2.tmp_overeenkomst_TYPE_step2 IN ('m4.05','m4.07') THEN 0
    WHEN t2.styg_vz_code = '14'
         AND t2.relnr != '25737'
         AND (CAST(LEFT(t2.reference_date,4) AS INT) - 4) > CAST(LEFT(t2.aanvangs_dat,4) AS INT)
    THEN t2.styg_vz_perc
    WHEN t2.h_status IN ('ac','st') AND t2.act_verleend_toesl_prc_tmin4 > 0 THEN t2.act_verleend_toesl_prc_tmin4
    WHEN t2.inact_verleend_toesl_prc_tmin4 > 0 THEN t2.inact_verleend_toesl_prc_tmin4
    ELSE 0
  END AS pb_toeslag_percentage_t4,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN t2.pb_beschikbare_premie_org
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) IN ('m1','m2')
    THEN t2.pb_beschikbare_premie_org
    ELSE 0
  END AS pb_beschikbare_premie,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN t2.pb_vrijgestelde_premie_org
    ELSE 0
  END AS pb_vrijgestelde_premie,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN t2.pb_betaalde_premie_org
    ELSE 0
  END AS pb_betaalde_premie,
  CASE
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) = 'm5'
         AND t2.veren_pensg_code = '2'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm4'
         AND left(t2.tmp_overeenkomst_TYPE_step1,2) = 'm5'
    THEN 'n'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
         AND t2.veren_pensg_code = '2'
    THEN 'j'
    WHEN left(t2.tmp_overeenkomst_TYPE_step2,2) = 'm5'
    THEN 'n'
    ELSE ''
  END AS pb_vereniging_gepensioneerden,
  'x' AS place_holder_1,
  CASE
    WHEN t2.act_toesl_cat = '' AND t2.act_fin_TYPE = '' AND t2.act_maatstaf_TYPE = '' THEN 'a0'
    WHEN t2.act_toesl_cat = '0' AND (t2.act_fin_TYPE IS NULL OR t2.act_maatstaf_TYPE IS NULL) THEN 'a0'
    WHEN t2.act_toesl_cat = '1' AND (t2.act_fin_TYPE IS NULL OR t2.act_maatstaf_TYPE IS NULL) THEN 'a0'
    WHEN t2.act_toesl_cat = '0' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'a0'
    WHEN t2.act_toesl_cat = '1' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'a0'
    WHEN t2.act_toesl_cat = '1' AND t2.act_fin_TYPE = '1' AND t2.act_maatstaf_TYPE = '1' THEN 'a0'
    WHEN t2.act_toesl_cat = '2' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.act_toesl_cat = '2' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.act_toesl_cat = '2' AND t2.act_fin_TYPE = '7' AND t2.act_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.act_toesl_cat = '2' AND t2.act_fin_TYPE = '10' AND t2.act_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '2' AND t2.act_maatstaf_TYPE = '1' THEN 'c7'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '3' AND t2.act_maatstaf_TYPE = '1' THEN 'c2'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '3' AND t2.act_maatstaf_TYPE = '4' THEN 'c2'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE = '1' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE = '2' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE = '3' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE = '4' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '5' AND t2.act_maatstaf_TYPE = '1' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '5' AND t2.act_maatstaf_TYPE = '4' THEN 'c1'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '1' THEN 'c8'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '2' THEN 'c8'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '4' THEN 'c8'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '7' AND t2.act_maatstaf_TYPE = '1' THEN 'c2'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '9' AND t2.act_maatstaf_TYPE = '1' THEN 'c9'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '10' AND t2.act_maatstaf_TYPE = '1' THEN 'c4'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '10' AND t2.act_maatstaf_TYPE = '4' THEN 'c4'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '11' AND t2.act_maatstaf_TYPE = '1' THEN 'c3'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '12' AND t2.act_maatstaf_TYPE = '1' THEN 'c3'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE = '12' AND t2.act_maatstaf_TYPE = '4' THEN 'c3'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '2' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd2'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '3' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd4'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '4' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd1'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '5' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd1'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd3'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '7' AND t2.act_maatstaf_TYPE = '2' THEN 'd4'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '9' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd6l'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE = '10' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd6e'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE IN ('11','12') AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'd6a'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '2' AND t2.act_maatstaf_TYPE = '3' THEN 'f1'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE IN ('4','5') AND t2.act_maatstaf_TYPE = '3' THEN 'f3'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE IN ('2','3','4') THEN 'f2'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '9' AND t2.act_maatstaf_TYPE = '2' THEN 'f4a'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '10' AND t2.act_maatstaf_TYPE = '4' THEN 'f4b'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '11' AND t2.act_maatstaf_TYPE = '4' THEN 'f4c'
    WHEN t2.act_toesl_cat = '6' AND t2.act_fin_TYPE IN ('2','11') AND t2.act_maatstaf_TYPE = '1' THEN ''
    WHEN t2.act_toesl_cat = '6' AND t2.act_fin_TYPE IN ('5','6') AND t2.act_maatstaf_TYPE = '1' THEN 'g'
    WHEN t2.act_toesl_cat = '99' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'g'
    ELSE ''
  END AS tmp_toeslag_variant_act,
  CASE
    WHEN t2.inact_toesl_cat = '' AND t2.inact_fin_TYPE = '' AND t2.inact_maatstaf_TYPE = '' THEN 'a0'
    WHEN t2.inact_toesl_cat = '0' AND (t2.inact_fin_TYPE IS NULL OR t2.inact_maatstaf_TYPE IS NULL) THEN 'a0'
    WHEN t2.inact_toesl_cat = '1' AND (t2.inact_fin_TYPE IS NULL OR t2.inact_maatstaf_TYPE IS NULL) THEN 'a0'
    WHEN t2.inact_toesl_cat = '0' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'a0'
    WHEN t2.inact_toesl_cat = '1' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'a0'
    WHEN t2.inact_toesl_cat = '1' AND t2.inact_fin_TYPE = '1' AND t2.inact_maatstaf_TYPE = '1' THEN 'a0'
    WHEN t2.inact_toesl_cat = '2' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.inact_toesl_cat = '2' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.inact_toesl_cat = '2' AND t2.inact_fin_TYPE = '7' AND t2.inact_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.inact_toesl_cat = '2' AND t2.inact_fin_TYPE = '10' AND t2.inact_maatstaf_TYPE = '1' THEN 'b'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '2' AND t2.inact_maatstaf_TYPE = '1' THEN 'c7'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '3' AND t2.inact_maatstaf_TYPE = '1' THEN 'c2'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '3' AND t2.inact_maatstaf_TYPE = '4' THEN 'c2'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE = '1' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE = '2' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE = '3' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE = '4' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '5' AND t2.inact_maatstaf_TYPE = '1' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '5' AND t2.inact_maatstaf_TYPE = '4' THEN 'c1'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE = '1' THEN 'c8'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE = '2' THEN 'c8'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE = '4' THEN 'c8'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '7' AND t2.inact_maatstaf_TYPE = '1' THEN 'c2'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '9' AND t2.inact_maatstaf_TYPE = '1' THEN 'c9'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '10' AND t2.inact_maatstaf_TYPE = '1' THEN 'c4'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '10' AND t2.inact_maatstaf_TYPE = '4' THEN 'c4'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '11' AND t2.inact_maatstaf_TYPE = '1' THEN 'c3'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '12' AND t2.inact_maatstaf_TYPE = '1' THEN 'c3'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE = '12' AND t2.inact_maatstaf_TYPE = '4' THEN 'c3'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '2' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd2'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '3' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd4'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '4' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd1'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '5' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd1'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd3'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '7' AND t2.inact_maatstaf_TYPE = '2' THEN 'd4'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '9' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd6l'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE = '10' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd6e'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE IN ('11','12') AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'd6a'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '2' AND t2.inact_maatstaf_TYPE = '3' THEN 'f1'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE IN ('4','5') AND t2.inact_maatstaf_TYPE = '3' THEN 'f3'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'f2'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '9' AND t2.inact_maatstaf_TYPE = '2' THEN 'f4a'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '10' AND t2.inact_maatstaf_TYPE = '4' THEN 'f4b'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '11' AND t2.inact_maatstaf_TYPE = '4' THEN 'f4c'
    WHEN t2.inact_toesl_cat = '6' AND t2.inact_fin_TYPE IN ('2','11') AND t2.inact_maatstaf_TYPE = '1' THEN ''
    WHEN t2.inact_toesl_cat = '6' AND t2.inact_fin_TYPE IN ('5','6') AND t2.inact_maatstaf_TYPE = '1' THEN 'g'
    WHEN t2.inact_toesl_cat = '99' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'g'
    ELSE ''
  END AS tmp_toeslag_variant_inact,
  CASE
    WHEN t2.act_toesl_cat = '' AND t2.act_fin_TYPE = '' AND t2.act_maatstaf_TYPE = '' THEN 'm000'
    WHEN t2.act_toesl_cat = '0' AND (t2.act_fin_TYPE IS NULL OR t2.act_maatstaf_TYPE IS NULL) THEN 'm000'
    WHEN t2.act_toesl_cat = '1' AND (t2.act_fin_TYPE IS NULL OR t2.act_maatstaf_TYPE IS NULL) THEN 'm000'
    WHEN t2.act_toesl_cat = '0' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'm000'
    WHEN t2.act_toesl_cat = '1' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'm000'
    WHEN t2.act_toesl_cat = '1' AND t2.act_fin_TYPE = '1' AND t2.act_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.act_toesl_cat = '2' AND t2.act_fin_TYPE IN ('4','6','7','10') AND t2.act_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE IN ('2','3','5','6','7','9','10','11','12') AND t2.act_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE IN ('3','4','5','6','10','12') AND t2.act_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE IN ('4','6') AND t2.act_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.act_toesl_cat = '3' AND t2.act_fin_TYPE IN ('4','6','9') AND t2.act_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.act_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.act_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.act_toesl_cat = '4' AND t2.act_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.act_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '2' AND t2.act_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE IN ('4','5') AND t2.act_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE IN ('4','5','6','9','10','11') AND t2.act_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '6' AND t2.act_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.act_toesl_cat = '5' AND t2.act_fin_TYPE = '9' AND t2.act_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.act_toesl_cat = '6' AND t2.act_fin_TYPE IN ('2','11') AND t2.act_maatstaf_TYPE = '1' THEN ''
    WHEN t2.act_toesl_cat = '6' AND t2.act_fin_TYPE IN ('5','6') AND t2.act_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.act_toesl_cat = '99' AND t2.act_fin_TYPE = '0' AND t2.act_maatstaf_TYPE = '0' THEN 'm000'
    ELSE ''
  END AS tmp_maatstaf_act,
  CASE
    WHEN t2.inact_toesl_cat = '' AND t2.inact_fin_TYPE = '' AND t2.inact_maatstaf_TYPE = '' THEN 'm000'
    WHEN t2.inact_toesl_cat = '0' AND (t2.inact_fin_TYPE IS NULL OR t2.inact_maatstaf_TYPE IS NULL) THEN 'm000'
    WHEN t2.inact_toesl_cat = '1' AND (t2.inact_fin_TYPE IS NULL OR t2.inact_maatstaf_TYPE IS NULL) THEN 'm000'
    WHEN t2.inact_toesl_cat = '0' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'm000'
    WHEN t2.inact_toesl_cat = '1' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'm000'
    WHEN t2.inact_toesl_cat = '1' AND t2.inact_fin_TYPE = '1' AND t2.inact_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.inact_toesl_cat = '2' AND t2.inact_fin_TYPE IN ('4','6','7','10') AND t2.inact_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE IN ('2','3','5','6','7','9','10','11','12') AND t2.inact_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE IN ('3','4','5','6','10','12') AND t2.inact_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE IN ('4','6','9') AND t2.inact_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.inact_toesl_cat = '3' AND t2.inact_fin_TYPE IN ('4','6') AND t2.inact_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.inact_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.inact_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.inact_toesl_cat = '4' AND t2.inact_fin_TYPE IN ('2','3','4','5','6','7','9','10','11','12') AND t2.inact_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '2' AND t2.inact_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE IN ('4','5') AND t2.inact_maatstaf_TYPE = '3' THEN 'm001'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE IN ('4','5','6','9','10','11') AND t2.inact_maatstaf_TYPE = '4' THEN 'm003'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '6' AND t2.inact_maatstaf_TYPE IN ('2','3','4') THEN 'm002'
    WHEN t2.inact_toesl_cat = '5' AND t2.inact_fin_TYPE = '9' AND t2.inact_maatstaf_TYPE = '2' THEN 'm002'
    WHEN t2.inact_toesl_cat = '6' AND t2.inact_fin_TYPE IN ('2','11') AND t2.inact_maatstaf_TYPE = '1' THEN ''
    WHEN t2.inact_toesl_cat = '6' AND t2.inact_fin_TYPE IN ('5','6') AND t2.inact_maatstaf_TYPE = '1' THEN 'm000'
    WHEN t2.inact_toesl_cat = '99' AND t2.inact_fin_TYPE = '0' AND t2.inact_maatstaf_TYPE = '0' THEN 'm000'
    ELSE ''
  END AS tmp_maatstaf_inact
FROM min_vz_cd_pa t1
LEFT JOIN join_6 t2
  ON t1.join_vz_cd_pa_vz_cd_pa = t2.join_vz_cd_pa_vz_cd_pa
  AND t1.join_pb_polis_nummer_pb_polis_nummer = t2.join_pb_polis_nummer_pb_polis_nummer
  AND t1.join_pb_polis_nummer_toevoeging_pb_polis_nummer_toevoeging = t2.join_pb_polis_nummer_toevoeging_pb_polis_nummer_toevoeging;


CREATE OR REPLACE TEMPORARY VIEW aggregation_1 AS
SELECT 
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  MIN(h_ingangsleeftijd) AS h_ingangsleeftijd_low
FROM pensioenleeftijd
GROUP BY 
  pb_polis_nummer,
  pb_polis_nummer_toevoeging

CREATE OR REPLACE TEMPORARY VIEW pensioenleeftijd AS
SELECT
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  vz_cd_pa,
  h_ingangsleeftijd,
  tmp_VZ_GROUP_uit
FROM generic_logic
WHERE vz_cd_pa IN ('11','12','13','14','15','16','17','18','19','60','61','62','63','64','65')
  AND h_ingangsleeftijd != '0'

CREATE OR REPLACE TEMPORARY VIEW join_2 AS (
SELECT
  t1.relnr,
  t1.volgnr,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.vz_cd_pa,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_uitbreidingsleeftijd_kind_nw AS pb_uitbreidingsleeftijd_kind,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.`____________________________________________`,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t2.pb_kap_bij_leven_tdns_dnstverb,
  t2.pb_kap_bij_leven_na_dnstverb,
  t2.pb_kap_bij_overl_tdns_dnstverb,
  t2.pb_kap_bij_overl_na_dnstverb,
  t2.tmp_ind_kapitaal_bij_leven,
  t2.tmp_ind_kapitaal_bij_overlijden,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t2.pb_ind_kap_bij_leven_bron,
  t2.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak,
  t1.h_einddat,
  t1.geb_dat_verzek_p
FROM generic_logic t1
LEFT JOIN xml_lvl_logic_1 t2
ON t1.pb_polis_nummer = t2.pb_polis_nummer
AND t1.pb_polis_nummer_toevoeging = t2.pb_polis_nummer_toevoeging
)

CREATE OR REPLACE TEMPORARY VIEW h_end_age AS
SELECT 
  relnr,
  volgnr,
  vz_cd_pa,
  h_end_age
FROM generic_logic
WHERE vz_cd_pa != '51'
  AND h_end_age != 0
GROUP BY
  relnr,
  volgnr,
  vz_cd_pa,
  h_end_age;


CREATE OR REPLACE TEMPORARY VIEW business_PARTNERs AS
SELECT
  pb_polis_nummer,
  tmp_bp_id_wg,
  tmp_bp_id_wn_m1_m2,
  tmp_bp_id_wn_m4,
  tmp_bp_id_wn_m5,
  tmp_bp_id_pr_m4,
  tmp_bp_id_pr_m5,
  tmp_DATE_FROM_PP_prod_part_wn_m1_m2,
  tmp_DATE_FROM_PP_prod_part_wn_m4,
  tmp_DATE_FROM_PP_prod_part_wn_m5
FROM cv_dec_cv_dlo_pubs_bp

CREATE OR REPLACE TEMPORARY VIEW join_10 AS (
SELECT
  t1.relnr,
  t1.volgnr,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.vz_cd_pa,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t2.highest_h_end_age AS i_highest_h_end_age,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak,
  t1.h_einddat,
  t1.geb_dat_verzek_p,
  CASE WHEN t2.highest_h_end_age IS NULL THEN '0' ELSE t2.highest_h_end_age END AS highest_h_end_age
FROM
  join_2 t1
  LEFT JOIN rank_1 t2
    ON t1.relnr = t2.relnr
    AND t1.volgnr = t2.volgnr
);


CREATE OR REPLACE TEMPORARY VIEW xml_level AS
SELECT
  xml_id,
  MAX(tmp_aan_scenariomoment_mpo) AS tmp_aan_scenariomoment_mpo,
  MAX(tmp_aan_scenariomoment_upo) AS tmp_aan_scenariomoment_upo,
  MAX(tmp_uit_scenariomoment_mpo) AS tmp_uit_scenariomoment_mpo,
  MAX(tmp_uit_scenariomoment_upo) AS tmp_uit_scenariomoment_upo
FROM scenario_comp
GROUP BY xml_id;


CREATE OR REPLACE TEMPORARY VIEW red_np_lft_mnd AS
SELECT relnr,
       volgnr,
       redukt_jr_aantal
FROM cv_dlo_pubs_red_np_lft_mnd

CREATE OR REPLACE TEMPORARY VIEW join_9 AS
SELECT
  t2.h_ingangsleeftijd_low,
  t1.relnr,
  t1.volgnr,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.vz_cd_pa,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t1.h_eindlft_op,
  t1.eindlft_pr_bet_wp,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.h_eindlft_vz_datum,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.highest_h_end_age,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak,
  t1.h_einddat,
  t1.geb_dat_verzek_p,
  CASE
    WHEN (
      LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m1','m2')
      OR (
        LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
        AND LEFT(tmp_overeenkomst_TYPE_step1, 2) IN ('m1','m2')
      )
    )
    THEN COALESCE(h_ingangsleeftijd_low, '0')
    ELSE '0'
  END AS tmp_ingangsleeftijd,
  CASE
    WHEN (
      LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m1','m2')
      OR (
        LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
        AND LEFT(tmp_overeenkomst_TYPE_step1, 2) IN ('m1','m2')
      )
    )
    THEN
      CASE
        WHEN tmp_ingangsleeftijd = '0' AND h_eindlft_op <> '' AND h_eindlft_op > '0'
        THEN CAST(h_eindlft_op AS INT) * 12
        WHEN tmp_ingangsleeftijd = '0' AND eindlft_pr_bet_wp <> '' AND eindlft_pr_bet_wp > '0'
        THEN CAST(eindlft_pr_bet_wp AS INT) * 12
        ELSE ''
      END
    ELSE ''
  END AS tmp_pb_pensioenleeftijd1,
  CASE
    WHEN h_einddat IS NULL
         OR h_einddat = ''
         OR geb_dat_verzek_p IS NULL
         OR geb_dat_verzek_p = ''
    THEN ''
    ELSE CASE
      WHEN (CAST(SUBSTRING(h_einddat, 5, 2) AS INT) - CAST(SUBSTRING(geb_dat_verzek_p, 5, 2) AS INT)) < 0
      THEN CAST((CAST(SUBSTRING(h_einddat, 5, 2) AS INT) - CAST(SUBSTRING(geb_dat_verzek_p, 5, 2) AS INT) + 12) AS STRING)
      ELSE CAST((CAST(SUBSTRING(h_einddat, 5, 2) AS INT) - CAST(SUBSTRING(geb_dat_verzek_p, 5, 2) AS INT)) AS STRING)
    END
  END AS tmp_pb_pensioenleeftijd2_mm,
  CASE
    WHEN h_einddat IS NULL
         OR h_einddat = ''
         OR geb_dat_verzek_p IS NULL
         OR geb_dat_verzek_p = ''
    THEN ''
    ELSE CASE
      WHEN (CAST(SUBSTRING(h_einddat, 5, 2) AS INT) - CAST(SUBSTRING(geb_dat_verzek_p, 5, 2) AS INT)) < 0
      THEN (CAST(LEFT(h_einddat, 4) AS INT) - CAST(LEFT(geb_dat_verzek_p, 4) AS INT) - 1)
      ELSE (CAST(LEFT(h_einddat, 4) AS INT) - CAST(LEFT(geb_dat_verzek_p, 4) AS INT))
    END
  END AS tmp_pb_pensioenleeftijd2_yy,
  CASE
    WHEN tmp_pb_pensioenleeftijd2_yy = ''
         OR tmp_pb_pensioenleeftijd2_mm = ''
    THEN ''
    ELSE
      (CAST(tmp_pb_pensioenleeftijd2_yy AS INT) * 12 + CAST(tmp_pb_pensioenleeftijd2_mm AS INT))
  END AS tmp_pb_pensioenleeftijd2,
  CASE
    WHEN
      LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m1','m2')
      OR (
        LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
        AND LEFT(tmp_overeenkomst_TYPE_step1, 2) IN ('m1','m2')
      )
    THEN
      CASE
        WHEN tmp_ingangsleeftijd <> '0' THEN tmp_ingangsleeftijd
        ELSE CASE
          WHEN tmp_ingangsleeftijd = '0'
               AND tmp_pb_pensioenleeftijd1 = ''
               AND tmp_pb_pensioenleeftijd2 = ''
          THEN ''
          ELSE CASE
            WHEN tmp_ingangsleeftijd = '0'
                 AND tmp_pb_pensioenleeftijd1 <> ''
                 AND tmp_pb_pensioenleeftijd2 = ''
            THEN tmp_pb_pensioenleeftijd1
            ELSE CASE
              WHEN tmp_ingangsleeftijd = '0'
                   AND tmp_pb_pensioenleeftijd1 = ''
                   AND tmp_pb_pensioenleeftijd2 <> ''
              THEN tmp_pb_pensioenleeftijd2
              ELSE CASE
                WHEN tmp_ingangsleeftijd = '0'
                     AND tmp_pb_pensioenleeftijd1 <> ''
                     AND tmp_pb_pensioenleeftijd2 <> ''
                     AND ABS(CAST(tmp_pb_pensioenleeftijd2 AS INT) - CAST(tmp_pb_pensioenleeftijd1 AS INT)) > 1
                THEN tmp_pb_pensioenleeftijd2
                ELSE CASE
                  WHEN tmp_ingangsleeftijd = '0'
                       AND tmp_pb_pensioenleeftijd1 <> ''
                       AND tmp_pb_pensioenleeftijd2 <> ''
                       AND ABS(CAST(tmp_pb_pensioenleeftijd2 AS INT) - CAST(tmp_pb_pensioenleeftijd1 AS INT)) <= 1
                  THEN tmp_pb_pensioenleeftijd1
                  ELSE ''
                END
              END
            END
          END
        END
      END
    ELSE ''
  END AS pb_pensioenleeftijd,
  CASE
    WHEN LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m1','m2')
    THEN pb_pensioenleeftijd
    WHEN (
      LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
      AND LEFT(tmp_overeenkomst_TYPE_step1, 2) IN ('m1','m2')
    )
    THEN pb_pensioenleeftijd
    ELSE ''
  END AS pb_pensioenrichtleeftijd
FROM
  join_10 t1
  LEFT JOIN aggregation_1 t2
    ON t1.pb_polis_nummer = t2.pb_polis_nummer
    AND t1.pb_polis_nummer_toevoeging = t2.pb_polis_nummer_toevoeging;


CREATE OR REPLACE TEMPORARY VIEW aanspraken AS
SELECT
  VZ_GROUP,
  ZVOLGNR AS ZVOLGNR_aan,
  ZPENSRTCD,
  ZAANSPRSTATCD,
  ZINGUITKCD,
  ZEINDUIKTCD,
  ZHERKUITKCD,
  ZXML_FLD_INGLFTUITK,
  ZXML_FLD_INGDATUITK,
  ZXML_FLD_ENDLFTUITK,
  ZXML_FLD_ENDDATUITK,
  ZXML_FLD_OMSLAGCD,
  ZXML_FLD_LFTOMSLAG,
  ZXML_FLD_DATOMSLAG,
  ZXML_FLD_FINANCD,
  ZXML_FLD_UITKBDRG,
  ZXML_FLD_STYGBDRG,
  ZXML_FLD_STYGPERC,
  zxml_fld_stygTYPE,
  ZXML_FLD_STYGDUUR,
  ZXML_FLD_AANVDATSTYG,
  ZXML_FLD_ENDDATTYDSTYG,
  ZXML_FLD_FLEXAOWMIN2,
  ZXML_FLD_FLEXAOW,
  ZXML_FLD_FLEXAOWplus1,
  ZXML_FLD_SCENMOMENT,
  ZXML_FLD_IND_BNP_VERW,
  ZFLD_UITKERING AS ZFLD_UITKERING_aan
FROM `cv_dec_zupompo_lego_asp`

CREATE OR REPLACE TEMPORARY VIEW join_1 AS (
SELECT
  t2.pb_pensioenregeling_nummer,
  t2.pb_pensioenuitvoerder_code,
  t2.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t2.pb_pensioenregeling_ingangsdat,
  t2.pb_deelname_status_code,
  t2.pb_beschikbare_premie,
  t2.pb_aanvullende_premie,
  t2.pb_vrijgestelde_premie,
  t2.pb_franchise,
  t2.pb_pensioengevend_salaris,
  t2.pb_pensioengrondslag,
  t2.pb_perc_opbouw,
  t2.pb_perc_deeltijd,
  t2.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t2.pb_datum_begin_opbouw,
  t2.pb_datum_einde_deelneming,
  t2.pb_ind_premievrijst_jn,
  t2.pb_ind_premievrijst_ing_jn,
  t2.pb_ind_toeslag_actief,
  t2.pb_ind_toeslag_inactief,
  t2.pb_ind_toeslag_act_inact_afw,
  t2.pb_ind_rendementsgar_actief_jn,
  t2.pb_verevening_status,
  t2.pb_verevening_code,
  t2.pb_p123_tonen,
  t2.pb_code_PARTNER_bep_onbep,
  t2.pb_ind_herverzekerd_jn,
  t2.pb_anw_basis_jn,
  t2.pb_toeslag_variant,
  t2.pb_toeslag_status,
  t2.pb_maatstaf,
  t2.pb_maximale_verhoging,
  t2.pb_toeslag_jaar_t0,
  t2.pb_toeslag_percentage_t0,
  t2.pb_toeslag_jaar_t1,
  t2.pb_toeslag_percentage_t1,
  t2.pb_toeslag_jaar_t2,
  t2.pb_toeslag_percentage_t2,
  t2.pb_toeslag_jaar_t3,
  t2.pb_toeslag_percentage_t3,
  t2.pb_toeslag_jaar_t4,
  t2.pb_toeslag_percentage_t4,
  t2.h_einddat,
  t1.relnr,
  t1.volgnr,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.vz_cd_pa,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t2.pb_betaalde_premie,
  t2.pb_vereniging_gepensioneerden,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.px_pensioenleeftijd,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t2.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak
FROM join_9 t1
LEFT JOIN xml_lvl_logic_2 t2
  ON t1.pb_polis_nummer = t2.pb_polis_nummer
  AND t1.pb_polis_nummer_toevoeging = t2.pb_polis_nummer_toevoeging
)

CREATE OR REPLACE TEMPORARY VIEW bp_but000 AS
SELECT
  PARTNER,
  BIRTHDT,
  XSEXM,
  XSEXF
FROM cv_dec_but000_bp_general;


CREATE OR REPLACE TEMPORARY VIEW join_5 AS
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_maximale_verhoging,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.pb_betaalde_premie,
  t1.pb_vereniging_gepensioneerden,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t2.redukt_jr_aantal,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak,
  CASE
    WHEN t2.redukt_jr_aantal IS NULL THEN 0
    WHEN t2.redukt_jr_aantal != '0' AND LTRIM(t2.redukt_jr_aantal, ' ') != '' THEN CAST(t2.redukt_jr_aantal AS INT) * 12
    ELSE 0
  END AS pb_reductie_np_lft_mnd
FROM join_1 t1
LEFT JOIN red_np_lft_mnd t2
  ON t1.relnr = t2.relnr
  AND t1.volgnr = t2.volgnr;


CREATE OR REPLACE TEMPORARY VIEW m1_m2_m4 AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  verwdt_log,
  run_timestamp,
  run_date,
  pb_bericht_versie,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_jn,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_code_PARTNER_bep_onbep,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_werknemer_id_corr AS pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  pb_klantnummer,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  pb_aop_TYPE,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_maximale_verhoging,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  tmp_VZ_GROUP,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_betaalde_premie,
  ct_vz,
  pb_vereniging_gepensioneerden,
  tmp_aan_vz_dat_code_3_flag,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date_corr AS pb_werknemer_prod_part_to_date
FROM wn_logic
WHERE LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m1','m2')
  OR (
    LEFT(tmp_overeenkomst_TYPE_step2, 2) IN ('m4')
    AND LEFT(tmp_overeenkomst_TYPE_step1, 2) IN ('m1','m2')
  )

CREATE OR REPLACE TEMPORARY VIEW bp_logic AS
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_aop_TYPE,
  t1.pb_maximale_verhoging,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.pb_betaalde_premie,
  t1.pb_vereniging_gepensioneerden,
  t1.`____________________________________________`,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.ct_polis_p,
  t1.echtsch_vereven_code,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_vz_dat_1_7,
  t2.tmp_bp_id_wn_m1_m2,
  t2.tmp_bp_id_wn_m4,
  t2.tmp_bp_id_wn_m5,
  t2.tmp_bp_id_pr_m5,
  t2.tmp_bp_id_wg,
  t1.tmp_overeenkomst_TYPE_step1,
  t2.tmp_bp_id_pr_m4,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t2.tmp_DATE_FROM_PP_prod_part_wn_m1_m2,
  t2.tmp_DATE_FROM_PP_prod_part_wn_m4,
  t2.tmp_DATE_FROM_PP_prod_part_wn_m5,
  t1.h_wpr_afwyk_code,
  t1.bedrijfstak,
  CASE
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') AND t1.tmp_bp_id_wn_m1_m2 IS NOT NULL THEN left(t1.tmp_bp_id_wn_m1_m2,10)
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m4') AND t1.tmp_bp_id_wn_m4 IS NOT NULL THEN left(t1.tmp_bp_id_wn_m4,10)
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t1.tmp_bp_id_wn_m5 IS NOT NULL THEN left(t1.tmp_bp_id_wn_m5,10)
    ELSE ''
  END AS pb_werknemer_id,
  CASE
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') AND t2.tmp_DATE_FROM_PP_prod_part_wn_m1_m2 IS NOT NULL THEN t2.tmp_DATE_FROM_PP_prod_part_wn_m1_m2
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m4') AND t2.tmp_DATE_FROM_PP_prod_part_wn_m4 IS NOT NULL THEN t2.tmp_DATE_FROM_PP_prod_part_wn_m4
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t2.tmp_DATE_FROM_PP_prod_part_wn_m5 IS NOT NULL THEN t2.tmp_DATE_FROM_PP_prod_part_wn_m5
    ELSE ''
  END AS pb_werknemer_prod_part_to_date,
  CASE
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') AND t1.tmp_bp_id_wn_m1_m2 IS NOT NULL AND right(t1.tmp_bp_id_wn_m1_m2,7) = 'e211044' THEN 'x'
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m4') AND t1.tmp_bp_id_wn_m4 IS NOT NULL AND right(t1.tmp_bp_id_wn_m4,7) = 'e211044' THEN 'x'
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t1.tmp_bp_id_wn_m5 IS NOT NULL AND right(t1.tmp_bp_id_wn_m5,7) = 'e211044' THEN 'x'
    ELSE ''
  END AS tmp_ind_err_211044,
  CASE
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN ''
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND NOT (t1.echtsch_vereven_code = '7' AND t1.ct_polis_p IN ('6','7')) THEN ''
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m4') AND t2.tmp_bp_id_pr_m4 IS NOT NULL THEN left(t2.tmp_bp_id_pr_m4,10)
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t2.tmp_bp_id_pr_m5 IS NOT NULL THEN left(t2.tmp_bp_id_pr_m5,10)
    ELSE ''
  END AS pb_PARTNER_id,
  CASE
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m1','m2') THEN ''
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t1.tmp_ind_PARTNER_is_exPARTNER = 't' THEN ''
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m4') AND t2.tmp_bp_id_pr_m4 IS NOT NULL AND right(t2.tmp_bp_id_pr_m4,7) = 'e211045' THEN 'x'
    WHEN left(t1.tmp_overeenkomst_TYPE_step2,2) IN ('m5') AND t2.tmp_bp_id_pr_m5 IS NOT NULL AND t1.pb_geb_datum_PARTNER != '00000000' AND t1.pb_geb_datum_PARTNER != '' AND right(t2.tmp_bp_id_pr_m5,7) = 'e211045' THEN 'x'
    ELSE ''
  END AS tmp_ind_err_211045,
  CASE
    WHEN t2.tmp_bp_id_wg IS NOT NULL THEN t2.tmp_bp_id_wg
    ELSE ''
  END AS pb_werkgever_id,
  t1.relnr AS pb_masterpolicy,
  t1.bedrijfstak AS pb_klantnummer
FROM join_5 t1
LEFT JOIN business_PARTNERs t2;


CREATE OR REPLACE TEMPORARY VIEW uitkeringen AS 
SELECT
  VZ_GROUP,
  ZVOLGNR AS ZVOLGNR_uit,
  ZUITKERINGCD,
  ZUITKDUUR,
  ZXML_FLD_INGLFTUITK,
  ZXML_FLD_INGDATUITK,
  ZBEP_END_UITKERINGCD,
  ZXML_FLD_ENDLFTUITK,
  ZXML_FLD_ENDDATUITK,
  ZXML_FLD_UITKBDRG,
  ZFLD_UITKERING AS ZFLD_UITKERING_uit,
  ZXML_FLD_STYGBDRG,
  ZXML_FLD_STYGPERC,
  zxml_fld_stygTYPE,
  ZXML_FLD_STYGDUUR,
  ZXML_FLD_AANVDATSTYG,
  ZXML_FLD_ENDDATTYDSTYG,
  ZUITKSTATCD,
  ZXML_FLD_SCENMOMENT
FROM cv_dec_zupompo_lego_uit;


CREATE OR REPLACE TEMPORARY VIEW wn_logic AS (
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_aop_TYPE,
  t1.pb_maximale_verhoging,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.`____________________________________________`,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.pb_werknemer_id,
  t1.pb_PARTNER_id,
  t1.pb_werkgever_id,
  t1.pb_masterpolicy,
  t1.pb_klantnummer,
  t1.pb_betaalde_premie,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.ct_polis_p,
  t1.pb_vereniging_gepensioneerden,
  t1.tmp_vz_dat_1_7,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.tmp_ind_err_211044,
  t1.tmp_ind_err_211045,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t2.BIRTHDT,
  t2.XSEXM,
  t2.XSEXF,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.pb_werknemer_prod_part_to_date,
  t1.h_wpr_afwyk_code,
  CASE WHEN (`pb_geb_datum_deelnemer` != `BIRTHDT`)
       THEN ''
       ELSE CASE WHEN ( (`pb_geslacht_deelnemer` = 'm' AND `XSEXM` != 'x')
                     OR (`pb_geslacht_deelnemer` = 'v' AND `XSEXF` != 'x`) )
                 THEN ''
                 ELSE `pb_werknemer_id`
            END
  END AS pb_werknemer_id_corr,
  CASE WHEN (`pb_werknemer_id_corr` = '')
       THEN ''
       ELSE `pb_werknemer_prod_part_to_date`
  END AS pb_werknemer_prod_part_to_date_corr,
  CASE WHEN (`pb_geb_datum_deelnemer` != `BIRTHDT`)
       THEN 'x'
       ELSE ''
  END AS tmp_ind_err_211038,
  CASE WHEN ( (`pb_geslacht_deelnemer` = 'm' AND `XSEXM` != 'x')
           OR (`pb_geslacht_deelnemer` = 'v' AND `XSEXF` != 'x`) )
       THEN 'x'
       ELSE ''
  END AS tmp_ind_err_211039
FROM bp_logic t1
LEFT JOIN bp_but000 t2
);


CREATE OR REPLACE TEMPORARY VIEW m4_m5 AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bericht_versie,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_jn,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_code_PARTNER_bep_onbep,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_werknemer_id_corr AS pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  pb_klantnummer,
  pb_betaalde_premie,
  ct_vz,
  tmp_VZ_GROUP_uit,
  tmp_VZ_GROUP_lat,
  h_eindlft_vz_datum,
  tmp_uit_vz_dat_pre,
  tmp_aan_vz_dat_code_5,
  tmp_aan_vz_dat_code_n,
  ct_polis_p,
  pb_vereniging_gepensioneerden,
  tmp_vz_dat_1_7,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date_corr AS pb_werknemer_prod_part_to_date,
  h_wpr_afwyk_code,
  CASE
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('11','12') THEN 'y'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('25','27') AND ct_vz = '0' THEN 'y'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('28','38','48') THEN 'y'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('47') AND h_wpr_afwyk_code = '2' AND ct_vz = '0' THEN 'y'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa NOT IN ('60','61','62','63','64','65','66','67','68','69','70','71') AND ct_vz IN ('1','2') THEN 'y'
    ELSE 'n'
  END AS tmp_uitkering_m5_flag,
  CASE
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('25','27') AND ct_vz = '0' THEN 'n'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('28','38','48') THEN 'n'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa IN ('47') AND h_wpr_afwyk_code = '2' AND ct_vz = '0' THEN 'n'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5') AND vz_cd_pa NOT IN ('11','12','70','71') AND ct_vz = '0' THEN 'y'
    WHEN substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m4')
         AND substring(tmp_overeenkomst_TYPE_step1,1,2) IN ('m5')
         AND vz_cd_pa NOT IN ('11','12','60','61','62','63','64','65','66','67','68','69','70','71') THEN 'y'
    ELSE 'n'
  END AS tmp_aanspraak_m4_m5_flag
FROM wn_logic
WHERE
  (
    substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m5')
    OR (
      substring(tmp_overeenkomst_TYPE_step2,1,2) IN ('m4')
      AND substring(tmp_overeenkomst_TYPE_step1,1,2) IN ('m5')
    )
  );


CREATE OR REPLACE TEMPORARY VIEW m1_2_4_aanspr AS
SELECT
  t2.ZVOLGNR_aan,
  t2.ZPENSRTCD,
  t2.zaansprstatcd,
  t2.ZINGUITKCD,
  t2.ZEINDUIKTCD,
  t2.ZHERKUITKCD,
  t2.ZXML_FLD_INGLFTUITK,
  t2.ZXML_FLD_INGDATUITK,
  t2.ZXML_FLD_ENDLFTUITK,
  t2.ZXML_FLD_ENDDATUITK,
  t2.ZXML_FLD_OMSLAGCD,
  t2.ZXML_FLD_LFTOMSLAG,
  t2.ZXML_FLD_DATOMSLAG,
  t2.ZXML_FLD_FINANCD,
  t2.ZXML_FLD_UITKBDRG,
  t2.ZXML_FLD_STYGBDRG,
  t2.ZXML_FLD_STYGPERC,
  t2.zxml_fld_stygTYPE,
  t2.ZXML_FLD_STYGDUUR,
  t2.ZXML_FLD_AANVDATSTYG,
  t2.ZXML_FLD_ENDDATTYDSTYG,
  t2.ZXML_FLD_FLEXAOWMIN2,
  t2.ZXML_FLD_FLEXAOW,
  t2.ZXML_FLD_FLEXAOWplus1,
  t2.ZXML_FLD_SCENMOMENT,
  t2.ZFLD_UITKERING_aan,
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.verwdt_log,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_reductie_np_toegepast,
  t1.pb_werknemer_id,
  t1.pb_PARTNER_id,
  t1.pb_werkgever_id,
  t1.pb_masterpolicy,
  t1.pb_klantnummer,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_maximale_verhoging,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.____________________________________________,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.tmp_VZ_GROUP,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.pb_betaalde_premie,
  t1.pb_vereniging_gepensioneerden,
  t1.tmp_aan_vz_dat_code_3_flag,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.tmp_ind_err_211038,
  t1.tmp_ind_err_211039,
  t1.tmp_ind_err_211044,
  t1.tmp_ind_err_211045,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.pb_werknemer_prod_part_to_date,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZPENSRTCD END AS pb_aan_pensioensoortcode,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZAANSPRSTATCD END AS pb_aan_aanspraakstatuscode,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZINGUITKCD END AS pb_aan_bepaling_ing_uitk_code,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_INGLFTUITK != 'y' THEN '' ELSE CASE WHEN vz_cd_pa IN ('38','48') THEN NULL END END AS pb_aan_ingangslftd_uitkering,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_INGDATUITK != 'y' THEN '' ELSE CASE WHEN vz_cd_pa IN ('38','48') THEN NULL END END AS pb_aan_ingangsdatum_uitkering,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZEINDUIKTCD END AS pb_aan_bepaling_eind_uitk_code,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_ENDLFTUITK != 'y' THEN '' ELSE h_end_age END AS pb_aan_eindleeftijd_uitkering,
  '' AS pb_aan_einddatum_uitkering,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZHERKUITKCD END AS pb_aan_herkomst_uitkering_code,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZXML_FLD_OMSLAGCD END AS pb_aan_omslag_code,
  '' AS pb_aan_leeftijd_omslag,
  '' AS pb_aan_datum_omslag,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE CASE WHEN vz_cd_pa = '69' THEN 'r' WHEN tmp_VZ_GROUP IN ('kapovl','bkapovl') THEN NULL END END AS pb_aan_financiering_code,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_UITKBDRG != 'y' THEN 0 ELSE CASE WHEN ZFLD_UITKERING_aan = 'lego_base.tot_verz' THEN ROUND(tot_verz,2) WHEN ZFLD_UITKERING_aan = 'px_base.px_ingekocht' THEN px_ingekocht WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_boven_verw' AND px_upo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01 WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_boven_verw' AND px_mpo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01 WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_onder_verw' THEN px_upo_idt_rel_op_onder_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_volgens_verw' THEN px_upo_idt_rel_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_boven_verw' THEN px_upo_idt_rel_op_boven_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_onder_verw' THEN px_mpo_idt_rel_op_onder_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_volgens_verw' THEN px_mpo_idt_rel_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_boven_verw' THEN px_mpo_idt_rel_op_boven_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_idt_nom_op_volgens_verw' AND RIGHT(reference_date,4) = '1231' THEN px_upo_idt_nom_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_udt_nom_op_volgens_verw' AND RIGHT(reference_date,4) = '1231' THEN px_upo_udt_nom_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_idt_nom_pp_volgens_verw' AND RIGHT(reference_date,4) = '1231' THEN px_upo_idt_nom_pp_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_udt_nom_pp_volgens_verw' AND RIGHT(reference_date,4) = '1231' THEN px_upo_udt_nom_pp_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_idt_nom_op_volgens_verw' AND RIGHT(reference_date,4) != '1231' THEN px_mpo_idt_nom_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_udt_nom_op_volgens_verw' AND RIGHT(reference_date,4) != '1231' THEN px_mpo_udt_nom_op_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_idt_nom_pp_volgens_verw' AND RIGHT(reference_date,4) != '1231' THEN px_mpo_idt_nom_pp_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_xxx_udt_nom_pp_volgens_verw' AND RIGHT(reference_date,4) != '1231' THEN px_mpo_udt_nom_pp_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_np_in_dnst_volgens_verw' THEN px_np_in_dnst_volgens_verw WHEN ZFLD_UITKERING_aan = 'px_base.px_np_uit_dnst_volgens_verw' THEN px_np_uit_dnst_volgens_verw ELSE 0 END END AS pb_aan_uitkering_bedrag,
  CASE WHEN styg_vz_code = '14' THEN 0 ELSE CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_STYGBDRG = 'n' THEN 0 ELSE CASE WHEN pb_aan_stijging_TYPE = 'e' AND styg_vz_bas_bedr > 0 THEN ROUND(styg_vz_perc / 100 * styg_vz_bas_bedr,2) WHEN pb_aan_stijging_TYPE = 'e' THEN ROUND(styg_vz_perc / 100 * tot_verz,2) ELSE 0 END END END AS pb_aan_stijging_bedrag,
  CASE WHEN styg_vz_code = '14' THEN 0 ELSE CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_STYGPERC = 'n' THEN 0 ELSE CASE WHEN pb_aan_stijging_TYPE = 's' THEN styg_vz_perc ELSE 0 END END END AS pb_aan_stijging_percentage,
  CASE WHEN styg_vz_code = '14' THEN '' ELSE CASE WHEN tmp_pensioensoort = 'uit' OR zxml_fld_stygTYPE = 'n' OR zxml_fld_stygTYPE IS NULL THEN '' ELSE CASE WHEN ((vz_cd_pa < '20' OR vz_cd_pa = '82') AND LTRIM(styg_vz_code) IN ('1','2')) THEN 'e' WHEN ((vz_cd_pa < '20' OR vz_cd_pa = '82') AND LTRIM(styg_vz_code) IN ('3','4','99')) THEN 's' WHEN ((vz_cd_pa >= '20' AND vz_cd_pa <= '50') AND LTRIM(styg_vz_code) IN ('1','2','5','6','92')) THEN 'e' WHEN ((vz_cd_pa >= '20' AND vz_cd_pa <= '50') AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94','99')) THEN 's' WHEN ((vz_cd_pa >= '51' AND vz_cd_pa <= '59') AND LTRIM(styg_vz_code) IN ('1','2','5','6','92')) THEN 'e' WHEN ((vz_cd_pa >= '51' AND vz_cd_pa <= '59') AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94','99')) THEN 's' WHEN (vz_cd_pa = '83' AND LTRIM(styg_vz_code) = '20') THEN 'e' WHEN (vz_cd_pa = '83' AND LTRIM(styg_vz_code) IN ('18','99')) THEN 's' ELSE '' END END END AS pb_aan_stijging_TYPE,
  CASE WHEN styg_vz_code = '14' THEN '' ELSE CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_STYGDUUR = 'n' THEN '' ELSE CASE WHEN vz_cd_pa < '20' THEN 'l' WHEN vz_cd_pa = '82' THEN 'l' WHEN ((vz_cd_pa >= '20' AND vz_cd_pa <= '50' AND LTRIM(styg_vz_code) IN ('1','2','3','4','5','6','7','8','92','94','99')) OR (vz_cd_pa IN('25','27') AND '16'='16')) THEN 'l' WHEN (vz_cd_pa >= '20' AND vz_cd_pa <= '59' AND LTRIM(styg_vz_code) IN ('9','10','11','12','16') AND NOT (vz_cd_pa IN('25','27') AND '16'='16')) THEN 't' ELSE '' END END END AS pb_aan_stijging_duur,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_AANVDATSTYG = 'n' THEN '' ELSE CASE WHEN vz_cd_pa < '20' AND LTRIM(styg_vz_code) IN ('1','2','3','4') THEN h_ingangslft_vz_datum ELSE '' END END AS pb_aan_aanvangsdatum_stijging,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_ENDDATTYDSTYG = 'n' THEN '' ELSE CASE WHEN vz_cd_pa >= '20' AND vz_cd_pa <= '59' AND LTRIM(styg_vz_code) IN ('9','10') THEN pb_pensioendatum WHEN vz_cd_pa = '27' AND LTRIM(styg_vz_code) IN ('12','16') THEN CAST(ADD_MONTHS(DATE(pb_geb_datum_deelnemer),780) AS STRING) ELSE '' END END AS pb_aan_einddatum_tijd_stijging,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZXML_FLD_FLEXAOWMIN2 END AS pb_aan_flex_aow_min2,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZXML_FLD_FLEXAOW END AS pb_aan_flex_aow,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE ZXML_FLD_FLEXAOWplus1 END AS pb_aan_flex_aow_plus1,
  CASE WHEN tmp_pensioensoort = 'uit' OR ZXML_FLD_SCENMOMENT != 'y' OR ZAANSPRSTATCD NOT IN ('7','8','9') THEN '' ELSE CASE WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '1' THEN 'pensioenleeftijd' WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '2' THEN 'vooruit' WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '3' THEN 'aow' WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '1' THEN 'pensioenleeftijd' WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '2' THEN 'vooruit' WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '3' THEN 'aow' ELSE '' END END AS pb_aan_scenariomoment,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE CASE WHEN ((vz_cd_pa = '30' AND LTRIM(styg_vz_code) IN ('5','6','8','9','10')) OR (vz_cd_pa = '35' AND LTRIM(styg_vz_code) = '8') OR (vz_cd_pa = '37' AND LTRIM(styg_vz_code) IN ('8','10')) OR (vz_cd_pa = '40' AND LTRIM(styg_vz_code) IN ('5','6','7','8','9','10','12')) OR (vz_cd_pa = '45' AND LTRIM(styg_vz_code) IN ('8','10')) OR (vz_cd_pa = '47' AND LTRIM(styg_vz_code) = '8') OR (vz_cd_pa = '51' AND LTRIM(styg_vz_code) IN ('5','6','7','8','9','10','12'))) THEN pb_pensioenleeftijd ELSE '' END END AS pb_aan_stijg_als_ovl_voor_lft,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE CASE WHEN LTRIM(styg_vz_code) = '14' THEN '' ELSE CASE WHEN LTRIM(styg_vz_code) IN ('92','94','99') THEN 'j' ELSE 'n' END END END AS pb_aan_afwijkende_stijging_jn,
  CASE WHEN tmp_pensioensoort = 'uit' THEN '' ELSE CASE WHEN vz_cd_pa IN ('30','40','47','51') != 'm4' THEN '780' ELSE '' END END AS pb_aan_stijging_tot_eindlftPARTNER
FROM m1_m2_m4 t1
LEFT JOIN aanspraken t2;


CREATE OR REPLACE TEMPORARY VIEW filt_m5_uitk AS
SELECT
    relnr,
    volgnr,
    vz_cd_pa,
    run_id,
    run_TYPE,
    reference_date,
    verwdt,
    run_timestamp,
    run_date,
    pb_bericht_versie,
    pb_bronsysteem_code,
    pb_polis_nummer,
    pb_polis_nummer_toevoeging,
    pb_versie_id,
    pb_label,
    pb_polis_mutatiedatum,
    pb_polis_extractiemoment,
    pb_geb_datum_deelnemer,
    pb_geslacht_deelnemer,
    pb_geb_datum_PARTNER,
    pb_geslacht_PARTNER,
    tmp_overeenkomst_TYPE_step2,
    pb_currency,
    pb_in_dienst,
    pb_uit_dienst,
    pb_wtp_regeling_jn,
    pb_pensioenregeling_nummer,
    pb_pensioenuitvoerder_code,
    pb_ind_regeling_netto_jn,
    pb_pensioenrichtleeftijd,
    pb_pensioenregeling_ingangsdat,
    pb_reductie_np_lft_mnd,
    pb_deelname_status_code,
    pb_beschikbare_premie,
    pb_aanvullende_premie,
    pb_vrijgestelde_premie,
    pb_franchise,
    pb_pensioengevend_salaris,
    pb_pensioengrondslag,
    pb_perc_opbouw,
    pb_perc_deeltijd,
    pb_pensioendatum,
    pb_pensioenleeftijd,
    pb_datum_begin_opbouw,
    pb_datum_einde_deelneming,
    pb_uitbreidingsleeftijd_kind,
    pb_ind_premievrijst_jn,
    pb_ind_premievrijst_ing_jn,
    pb_ind_toeslag_actief,
    pb_ind_toeslag_inactief,
    pb_ind_toeslag_act_inact_afw,
    pb_ind_rendementsgar_actief_jn,
    pb_verevening_status,
    pb_verevening_code,
    pb_p123_tonen,
    pb_code_PARTNER_bep_onbep,
    pb_ind_herverzekerd_jn,
    pb_anw_basis_jn,
    pb_code_bnp_verwerkt,
    pb_reductie_np_toegepast,
    pb_pensioenaanw_variabel_jn,
    pb_team_id,
    pb_team_naam,
    pb_factora_jaar,
    pb_factora_bedrag,
    pb_aop_TYPE,
    pb_maximale_verhoging,
    pb_aop_eindleeftijd,
    pb_aop_bedrag,
    pb_toeslag_variant,
    pb_toeslag_status,
    pb_maatstaf,
    pb_toeslag_jaar_t0,
    pb_toeslag_percentage_t0,
    pb_toeslag_jaar_t1,
    pb_toeslag_percentage_t1,
    pb_toeslag_jaar_t2,
    pb_toeslag_percentage_t2,
    pb_toeslag_jaar_t3,
    pb_toeslag_percentage_t3,
    pb_toeslag_jaar_t4,
    pb_toeslag_percentage_t4,
    tmp_VZ_GROUP,
    tmp_pensioensoort,
    px_te_bereiken,
    px_opgebouwd_kapitaal,
    px_upo_idt_rel_op_boven_verw,
    px_upo_idt_rel_op_volgens_verw,
    px_upo_idt_rel_op_onder_verw,
    px_mpo_idt_rel_op_boven_verw,
    px_mpo_idt_rel_op_volgens_verw,
    px_mpo_idt_rel_op_onder_verw,
    px_pensioenleeftijd,
    h_einddat,
    px_upo_ind_prog_methode,
    px_mpo_ind_prog_methode,
    px_eindleeftijd_aanwending,
    styg_vz_perc,
    styg_vz_code,
    styg_vz_bas_bedr,
    tmp_number_of_records_in_policy,
    h_end_age,
    h_ingangslft_vz_datum,
    h_ingangsleeftijd,
    tot_verz,
    px_ingekocht,
    px_upo_idt_nom_op_volgens_verw,
    px_upo_udt_nom_op_volgens_verw,
    px_upo_idt_nom_pp_volgens_verw,
    px_upo_udt_nom_pp_volgens_verw,
    px_np_in_dnst_volgens_verw,
    px_np_uit_dnst_volgens_verw,
    verwdt_log,
    aep_code_p,
    h_status,
    tmp_ind_split_policy_divorce,
    tmp_ind_recipient,
    tmp_ind_PARTNER_is_exPARTNER,
    tmp_ind_kapitaal_bij_leven,
    tmp_ind_kapitaal_bij_overlijden,
    pb_kap_bij_leven_tdns_dnstverb,
    pb_kap_bij_leven_na_dnstverb,
    pb_kap_bij_overl_tdns_dnstverb,
    pb_kap_bij_overl_na_dnstverb,
    px_mpo_idt_nom_op_volgens_verw,
    px_mpo_idt_nom_pp_volgens_verw,
    px_mpo_udt_nom_op_volgens_verw,
    px_mpo_udt_nom_pp_volgens_verw,
    pb_werknemer_id,
    pb_PARTNER_id,
    pb_werkgever_id,
    pb_masterpolicy,
    pb_klantnummer,
    pb_betaalde_premie,
    ct_vz,
    tmp_VZ_GROUP_uit,
    h_eindlft_vz_datum,
    tmp_uit_vz_dat_pre,
    tmp_uitkering_m5_flag,
    pb_vereniging_gepensioneerden,
    tmp_overeenkomst_TYPE_step1,
    tmp_ind_err_211038,
    tmp_ind_err_211039,
    tmp_ind_err_211044,
    tmp_ind_err_211045,
    ondnr,
    naam,
    verk_naam,
    niet_pw_contract,
    pb_ind_kap_bij_leven_bron,
    pb_ind_kap_bij_overlijden_bron,
    upo_verv_code,
    soort_rel_code,
    munt_code,
    pb_werknemer_prod_part_to_date
FROM `m4_m5`
WHERE tmp_uitkering_m5_flag = 'y'

CREATE OR REPLACE TEMPORARY VIEW m5_uitk AS
SELECT
  t2.ZVOLGNR_uit,
  t2.ZUITKERINGCD,
  t2.ZUITKDUUR,
  t2.ZXML_FLD_INGLFTUITK,
  t2.ZXML_FLD_INGDATUITK,
  t2.ZBEP_END_UITKERINGCD,
  t2.ZXML_FLD_ENDLFTUITK,
  t2.ZXML_FLD_ENDDATUITK,
  t2.ZXML_FLD_UITKBDRG,
  t2.ZFLD_UITKERING_uit,
  t2.ZXML_FLD_STYGBDRG,
  t2.ZXML_FLD_STYGPERC,
  t2.zxml_fld_stygTYPE,
  t2.ZXML_FLD_STYGDUUR,
  t2.ZXML_FLD_AANVDATSTYG,
  t2.ZXML_FLD_ENDDATTYDSTYG,
  t2.ZUITKSTATCD,
  t2.ZXML_FLD_SCENMOMENT,
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_reductie_np_toegepast,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_aop_TYPE,
  t1.pb_maximale_verhoging,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.pb_werknemer_id,
  t1.pb_PARTNER_id,
  t1.pb_werkgever_id,
  t1.pb_masterpolicy,
  t1.pb_klantnummer,
  t1.pb_betaalde_premie,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.h_eindlft_vz_datum,
  t1.tmp_uit_vz_dat_pre,
  t1.pb_vereniging_gepensioneerden,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.tmp_ind_err_211038,
  t1.tmp_ind_err_211039,
  t1.tmp_ind_err_211044,
  t1.tmp_ind_err_211045,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.pb_werknemer_prod_part_to_date,
  CASE
    WHEN LEFT(tmp_overeenkomst_TYPE_step2,2) IN ('m5') THEN
      CASE
        WHEN vz_cd_pa NOT IN ('60','61','62','63','64','65','66','67','68','69','70','71') THEN
          CASE WHEN vz_cd_pa IN ('11','12') THEN 'y' ELSE 'n' END
        ELSE 'n'
      END
    ELSE 'n'
  END AS tmp_uitkering_flag,
  ZUITKERINGCD AS pb_uit_uitkering_code,
  ZUITKDUUR AS pb_uit_uitkering_duur,
  CASE
    WHEN ZXML_FLD_INGLFTUITK != 'n' THEN
      CASE WHEN vz_cd_pa IN ('11','12','13','14','18','19') THEN h_ingangsleeftijd ELSE '' END
    ELSE ''
  END AS pb_uit_ingangslftd_uitkering,
  CASE
    WHEN ZXML_FLD_INGDATUITK != 'n' THEN
      CASE WHEN vz_cd_pa IN ('11','12','13','14','18','19') THEN h_ingangslft_vz_datum ELSE '' END
    ELSE ''
  END AS pb_uit_ingangsdatum_uitkering,
  ZBEP_END_UITKERINGCD AS pb_uit_bepaling_eind_uitk_code,
  CASE WHEN ZXML_FLD_ENDLFTUITK != 'n' THEN h_end_age ELSE '' END AS pb_uit_eindleeftijd_uitkering,
  CASE WHEN ZXML_FLD_ENDDATUITK != 'n' THEN h_eindlft_vz_datum ELSE '' END AS pb_uit_einddatum_uitkering,
  CASE
    WHEN ZXML_FLD_UITKBDRG = 'n' THEN 0
    ELSE CASE
      WHEN ZFLD_UITKERING_uit = 'lego_base.tot_verz' THEN ROUND(tot_verz,2)
      WHEN ZFLD_UITKERING_uit = 'px_base.px_upo_idt_rel_op_boven_verw' AND px_upo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01
      WHEN ZFLD_UITKERING_uit = 'px_base.px_mpo_idt_rel_op_boven_verw' AND px_mpo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01
      WHEN ZFLD_UITKERING_uit = 'px_base.px_upo_idt_rel_op_onder_verw' THEN px_upo_idt_rel_op_onder_verw
      WHEN ZFLD_UITKERING_uit = 'px_base.px_upo_idt_rel_op_volgens_verw' THEN px_upo_idt_rel_op_volgens_verw
      WHEN ZFLD_UITKERING_uit = 'px_base.px_upo_idt_rel_op_boven_verw' THEN px_upo_idt_rel_op_boven_verw
      WHEN ZFLD_UITKERING_uit = 'px_base.px_mpo_idt_rel_op_onder_verw' THEN px_mpo_idt_rel_op_onder_verw
      WHEN ZFLD_UITKERING_uit = 'px_base.px_mpo_idt_rel_op_volgens_verw' THEN px_mpo_idt_rel_op_volgens_verw
      WHEN ZFLD_UITKERING_uit = 'px_base.px_mpo_idt_rel_op_boven_verw' THEN px_mpo_idt_rel_op_boven_verw
      ELSE 0
    END
  END AS pb_uit_uitkering_bedrag,
  CASE
    WHEN ZXML_FLD_STYGBDRG != 'n' THEN
      CASE
        WHEN LTRIM(styg_vz_code) = '14' THEN 0
        ELSE CASE
          WHEN pb_uit_stijging_TYPE = 'e' AND styg_vz_bas_bedr > 0 THEN ROUND(styg_vz_perc/100*styg_vz_bas_bedr,2)
          ELSE 0
        END
      END
    ELSE 0
  END AS pb_uit_stijging_bedrag,
  CASE
    WHEN ZXML_FLD_STYGPERC != 'n' THEN
      CASE
        WHEN LTRIM(styg_vz_code) = '14' THEN 0
        ELSE CASE
          WHEN pb_uit_stijging_TYPE = 's' THEN styg_vz_perc
          ELSE 0
        END
      END
    ELSE 0
  END AS pb_uit_stijging_percentage,
  CASE
    WHEN zxml_fld_stygTYPE = 'n' THEN ''
    ELSE CASE
      WHEN LTRIM(styg_vz_code) = '14' THEN ''
      ELSE CASE
        WHEN CAST(vz_cd_pa AS INT) < 20 AND LTRIM(styg_vz_code) IN ('1','2','92') THEN 'e'
        ELSE CASE
          WHEN ((CAST(vz_cd_pa AS INT) < 20) OR vz_cd_pa = '82') AND LTRIM(styg_vz_code) IN ('3','4','8','99') THEN 's'
          ELSE CASE
            WHEN (CAST(vz_cd_pa AS INT) >= 20 AND CAST(vz_cd_pa AS INT) <= 50) AND LTRIM(styg_vz_code) IN ('1','2','5','6','92') THEN 'e'
            ELSE CASE
              WHEN (CAST(vz_cd_pa AS INT) >= 20 AND CAST(vz_cd_pa AS INT) <= 50) AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94') THEN 's'
              ELSE CASE
                WHEN (CAST(vz_cd_pa AS INT) >= 51 AND CAST(vz_cd_pa AS INT) <= 59) AND LTRIM(styg_vz_code) IN ('1','2','5','6','92') THEN 'e'
                ELSE CASE
                  WHEN (CAST(vz_cd_pa AS INT) >= 51 AND CAST(vz_cd_pa AS INT) <= 59) AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94') THEN 's'
                  ELSE CASE
                    WHEN vz_cd_pa IN ('81','82','83') THEN 's'
                    ELSE ''
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS pb_uit_stijging_TYPE,
  CASE
    WHEN ZXML_FLD_STYGDUUR = 'n' THEN ''
    ELSE CASE
      WHEN LTRIM(styg_vz_code) IN ('14','99') THEN ''
      ELSE CASE
        WHEN CAST(vz_cd_pa AS INT) < 20 THEN 'l'
        ELSE CASE
          WHEN vz_cd_pa IN ('81','82','83') THEN 'l'
          ELSE CASE
            WHEN ((CAST(vz_cd_pa AS INT) >= 20 AND CAST(vz_cd_pa AS INT) <= 59) AND LTRIM(styg_vz_code) IN ('1','2','3','4','5','6','7','8','92','94'))
                 OR (vz_cd_pa = '25' AND LTRIM(styg_vz_code) = '16') THEN 'l'
            ELSE CASE
              WHEN vz_cd_pa != '25' AND vz_cd_pa != '16' AND (CAST(vz_cd_pa AS INT) >= 20 AND CAST(vz_cd_pa AS INT) <= 59)
                   AND LTRIM(styg_vz_code) IN ('9','10','11','12','16') THEN 't'
              ELSE ''
            END
          END
        END
      END
    END
  END AS pb_uit_stijging_duur,
  CASE
    WHEN ZXML_FLD_AANVDATSTYG != 'n' THEN ''
    ELSE ''
  END AS pb_uit_aanvangsdatum_stijging,
  CASE
    WHEN ZXML_FLD_ENDDATTYDSTYG != 'n' THEN
      CASE
        WHEN pb_uit_stijging_duur = 't' THEN tmp_uit_vz_dat_pre
        ELSE ''
      END
    ELSE ''
  END AS pb_uit_einddatum_tijd_stijging,
  ZUITKSTATCD AS pb_uit_uitk_status_code,
  CASE
    WHEN ZXML_FLD_SCENMOMENT != 'y' OR ZUITKSTATCD NOT IN ('2','3','4') THEN ''
    ELSE CASE
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '1' THEN 'pensioenleeftijd'
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '2' THEN 'vooruit'
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '3' THEN 'aow'
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '1' THEN 'pensioenleeftijd'
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '2' THEN 'vooruit'
      WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '3' THEN 'aow'
      ELSE ''
    END
  END AS pb_uit_scenariomoment,
  CASE
    WHEN LTRIM(styg_vz_code) = '14' THEN ''
    ELSE CASE WHEN LTRIM(styg_vz_code) IN ('92','94','99') THEN 'j' ELSE 'n' END
  END AS pb_uit_afwijkende_stijging_jn
FROM filt_m5_uitk t1
LEFT JOIN uitkeringen t2;


CREATE OR REPLACE TEMPORARY VIEW filt_m4_m5_aanspk AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bericht_versie,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step2,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_jn,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_code_PARTNER_bep_onbep,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  px_te_bereiken,
  px_opgebouwd_kapitaal,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  px_pensioenleeftijd,
  h_einddat,
  px_upo_ind_prog_methode,
  px_mpo_ind_prog_methode,
  px_eindleeftijd_aanwending,
  styg_vz_perc,
  styg_vz_code,
  styg_vz_bas_bedr,
  tmp_number_of_records_in_policy,
  h_end_age,
  h_ingangslft_vz_datum,
  h_ingangsleeftijd,
  tot_verz,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_upo_udt_nom_op_volgens_verw,
  px_upo_idt_nom_pp_volgens_verw,
  px_upo_udt_nom_pp_volgens_verw,
  px_np_in_dnst_volgens_verw,
  px_np_uit_dnst_volgens_verw,
  verwdt_log,
  aep_code_p,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  px_mpo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_pp_volgens_verw,
  px_mpo_udt_nom_op_volgens_verw,
  px_mpo_udt_nom_pp_volgens_verw,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  pb_klantnummer,
  pb_betaalde_premie,
  ct_vz,
  tmp_VZ_GROUP_uit,
  tmp_VZ_GROUP_lat,
  h_eindlft_vz_datum,
  tmp_aanspraak_m4_m5_flag,
  ct_polis_p,
  tmp_aan_vz_dat_code_5,
  tmp_aan_vz_dat_code_n,
  pb_vereniging_gepensioneerden,
  tmp_vz_dat_1_7,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  pb_werknemer_prod_part_to_date,
  CASE
    WHEN LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm5'
      AND ct_polis_p IN ('8','9')
      AND vz_cd_pa = '51'
    THEN 'y'
    WHEN LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm5'
      AND ct_polis_p IN ('8','9')
      AND vz_cd_pa IN ('34','35','44','45')
      AND tmp_vz_dat_1_7 != ''
      AND tmp_vz_dat_1_7 < reference_date
    THEN 'y'
    WHEN LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
      AND LEFT(tmp_overeenkomst_TYPE_step1, 2) = 'm5'
      AND ct_polis_p IN ('8','9')
      AND vz_cd_pa = '51'
    THEN 'y'
    WHEN LEFT(tmp_overeenkomst_TYPE_step2, 2) = 'm4'
      AND LEFT(tmp_overeenkomst_TYPE_step1, 2) = 'm5'
      AND ct_polis_p IN ('8','9')
      AND vz_cd_pa IN ('34','35','44','45')
      AND tmp_vz_dat_1_7 != ''
      AND tmp_vz_dat_1_7 < reference_date
    THEN 'y'
    ELSE 'n'
  END AS tmp_ind_no_aanspraak
FROM m4_m5
WHERE tmp_aanspraak_m4_m5_flag = 'y'

CREATE OR REPLACE TEMPORARY VIEW m4_m5_aanspr AS
SELECT 
  t2.ZVOLGNR_aan,
  t2.ZPENSRTCD,
  t2.zaansprstatcd,
  t2.ZINGUITKCD,
  t2.ZEINDUIKTCD,
  t2.ZHERKUITKCD,
  t2.ZXML_FLD_INGLFTUITK,
  t2.ZXML_FLD_INGDATUITK,
  t2.ZXML_FLD_ENDLFTUITK,
  t2.ZXML_FLD_ENDDATUITK,
  t2.ZXML_FLD_OMSLAGCD,
  t2.ZXML_FLD_LFTOMSLAG,
  t2.ZXML_FLD_DATOMSLAG,
  t2.ZXML_FLD_FINANCD,
  t2.ZXML_FLD_UITKBDRG,
  t2.ZXML_FLD_STYGBDRG,
  t2.ZXML_FLD_STYGPERC,
  t2.zxml_fld_stygTYPE,
  t2.ZXML_FLD_STYGDUUR,
  t2.ZXML_FLD_AANVDATSTYG,
  t2.ZXML_FLD_ENDDATTYDSTYG,
  t2.ZXML_FLD_FLEXAOWMIN2,
  t2.ZXML_FLD_FLEXAOW,
  t2.ZXML_FLD_FLEXAOWplus1,
  t2.ZXML_FLD_SCENMOMENT,
  t2.ZFLD_UITKERING_aan,
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.run_timestamp,
  t1.run_date,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_reductie_np_toegepast,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_aop_TYPE,
  t1.pb_maximale_verhoging,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.____________________________________________,
  t1.tmp_VZ_GROUP,
  t1.tmp_pensioensoort,
  t1.px_te_bereiken,
  t1.px_opgebouwd_kapitaal,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.px_pensioenleeftijd,
  t1.h_einddat,
  t1.px_upo_ind_prog_methode,
  t1.px_mpo_ind_prog_methode,
  t1.px_eindleeftijd_aanwending,
  t1.styg_vz_perc,
  t1.styg_vz_code,
  t1.styg_vz_bas_bedr,
  t1.tmp_number_of_records_in_policy,
  t1.h_end_age,
  t1.h_ingangslft_vz_datum,
  t1.h_ingangsleeftijd,
  t1.tot_verz,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_upo_udt_nom_op_volgens_verw,
  t1.px_upo_idt_nom_pp_volgens_verw,
  t1.px_upo_udt_nom_pp_volgens_verw,
  t1.px_np_in_dnst_volgens_verw,
  t1.px_np_uit_dnst_volgens_verw,
  t1.verwdt_log,
  t1.aep_code_p,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_pp_volgens_verw,
  t1.px_mpo_udt_nom_op_volgens_verw,
  t1.px_mpo_udt_nom_pp_volgens_verw,
  t1.pb_werknemer_id,
  t1.pb_PARTNER_id,
  t1.pb_werkgever_id,
  t1.pb_klantnummer,
  t1.pb_masterpolicy,
  t1.pb_betaalde_premie,
  t1.ct_vz,
  t1.tmp_VZ_GROUP_uit,
  t1.tmp_VZ_GROUP_lat,
  t1.h_eindlft_vz_datum,
  t1.tmp_ind_no_aanspraak,
  t1.tmp_aan_vz_dat_code_5,
  t1.tmp_aan_vz_dat_code_n,
  t1.pb_vereniging_gepensioneerden,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.tmp_ind_err_211038,
  t1.tmp_ind_err_211039,
  t1.tmp_ind_err_211044,
  t1.tmp_ind_err_211045,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.pb_werknemer_prod_part_to_date,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZPENSRTCD END AS pb_aan_pensioensoortcode,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZAANSPRSTATCD END AS pb_aan_aanspraakstatuscode,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZINGUITKCD END AS pb_aan_bepaling_ing_uitk_code,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_INGLFTUITK != 'y' THEN '' 
      ELSE h_ingangsleeftijd 
    END 
  END AS pb_aan_ingangslftd_uitkering,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_INGDATUITK != 'y' THEN '' 
      ELSE h_ingangslft_vz_datum 
    END 
  END AS pb_aan_ingangsdatum_uitkering,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZEINDUIKTCD END AS pb_aan_bepaling_eind_uitk_code,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_ENDLFTUITK != 'y' THEN '' 
      ELSE h_end_age 
    END 
  END AS pb_aan_eindleeftijd_uitkering,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_ENDDATUITK != 'n' THEN h_eindlft_vz_datum 
      ELSE '' 
    END 
  END AS pb_aan_einddatum_uitkering,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZHERKUITKCD END AS pb_aan_herkomst_uitkering_code,
  CASE WHEN tmp_ind_no_aanspraak = 'y' THEN '' ELSE ZXML_FLD_OMSLAGCD END AS pb_aan_omslag_code,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_LFTOMSLAG = 'y' AND vz_cd_pa = '17' THEN '780' 
      WHEN ZXML_FLD_LFTOMSLAG = 'y' AND vz_cd_pa IN ('38','48') THEN '' 
      ELSE '' 
    END 
  END AS pb_aan_leeftijd_omslag,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN '' 
    ELSE CASE 
      WHEN ZXML_FLD_DATOMSLAG = 'y' AND vz_cd_pa IN ('38','48') THEN '' 
      ELSE '' 
    END 
  END AS pb_aan_financiering_code,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN 0
    ELSE CASE 
      WHEN ZXML_FLD_UITKBDRG != 'y' THEN 0
      ELSE CASE 
        WHEN ZFLD_UITKERING_aan = 'lego_base.tot_verz' THEN ROUND(tot_verz,2)
        WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_boven_verw' AND px_upo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01
        WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_boven_verw' AND px_mpo_idt_rel_op_boven_verw = 0 AND tot_verz != 0 THEN 0.01
        WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_onder_verw' THEN px_upo_idt_rel_op_onder_verw
        WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_volgens_verw' THEN px_upo_idt_rel_op_volgens_verw
        WHEN ZFLD_UITKERING_aan = 'px_base.px_upo_idt_rel_op_boven_verw' THEN px_upo_idt_rel_op_boven_verw
        WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_onder_verw' THEN px_mpo_idt_rel_op_onder_verw
        WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_volgens_verw' THEN px_mpo_idt_rel_op_volgens_verw
        WHEN ZFLD_UITKERING_aan = 'px_base.px_mpo_idt_rel_op_boven_verw' THEN px_mpo_idt_rel_op_boven_verw
        ELSE 0
      END
    END
  END AS pb_aan_uitkering_bedrag,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN 0
    WHEN styg_vz_code = '14' THEN 0
    WHEN ZXML_FLD_STYGBDRG = 'n' THEN 0
    ELSE CASE 
      WHEN pb_aan_stijging_TYPE = 'e' AND styg_vz_bas_bedr > 0 THEN ROUND(styg_vz_perc/100 * styg_vz_bas_bedr,2)
      WHEN pb_aan_stijging_TYPE = 'e' THEN ROUND(styg_vz_perc/100 * tot_verz,2)
      ELSE 0
    END
  END AS pb_aan_stijging_bedrag,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN 0
    WHEN styg_vz_code = '14' THEN 0
    WHEN ZXML_FLD_STYGPERC = 'n' THEN 0
    ELSE CASE 
      WHEN pb_aan_stijging_TYPE = 's' THEN styg_vz_perc
      ELSE 0
    END
  END AS pb_aan_stijging_percentage,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN styg_vz_code = '14' THEN ''
    WHEN zxml_fld_stygTYPE = 'n' OR zxml_fld_stygTYPE IS NULL THEN ''
    ELSE CASE 
      WHEN vz_cd_pa IN ('30','40','51','7','8','10','12') THEN ''
      WHEN (vz_cd_pa < '20' OR vz_cd_pa = '82') AND LTRIM(styg_vz_code) IN ('1','2') THEN 'e'
      WHEN (vz_cd_pa < '20' OR vz_cd_pa = '82') AND LTRIM(styg_vz_code) IN ('3','4','99') THEN 's'
      WHEN (vz_cd_pa >= '20' AND vz_cd_pa <= '50') AND LTRIM(styg_vz_code) IN ('1','2','5','6','92') THEN 'e'
      WHEN (vz_cd_pa >= '20' AND vz_cd_pa <= '50') AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94','99') THEN 's'
      WHEN (vz_cd_pa >= '51' AND vz_cd_pa <= '59') AND LTRIM(styg_vz_code) IN ('1','2','5','6','92') THEN 'e'
      WHEN (vz_cd_pa >= '51' AND vz_cd_pa <= '59') AND LTRIM(styg_vz_code) IN ('3','4','7','8','9','10','11','12','16','94','99') THEN 's'
      WHEN vz_cd_pa = '83' AND LTRIM(styg_vz_code) = '20' THEN 'e'
      WHEN vz_cd_pa = '83' AND LTRIM(styg_vz_code) IN ('18','99') THEN 's'
      ELSE ''
    END
  END AS pb_aan_stijging_TYPE,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN styg_vz_code = '14' THEN ''
    WHEN ZXML_FLD_STYGDUUR = 'n' THEN ''
    ELSE CASE 
      WHEN vz_cd_pa IN ('30','40','51','7','8','10','12') THEN ''
      WHEN vz_cd_pa < '20' THEN 'l'
      WHEN vz_cd_pa = '82' THEN 'l'
      WHEN (
           (vz_cd_pa >= '20' AND vz_cd_pa <= '59' AND LTRIM(styg_vz_code) IN ('1','2','3','4','5','6','7','8','92','94','99'))
           OR (vz_cd_pa IN ('25','27') AND '16' = '16')
          ) THEN 'l'
      WHEN (vz_cd_pa >= '20' AND vz_cd_pa <= '59' 
             AND LTRIM(styg_vz_code) IN ('9','10','11','12','16')
             AND NOT(vz_cd_pa IN ('25','27') AND '16'='16')
           ) THEN 't'
      ELSE ''
    END
  END AS pb_aan_stijging_duur,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN ZXML_FLD_AANVDATSTYG = 'n' THEN ''
    ELSE ''
  END AS pb_aan_aanvangsdatum_stijging,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN ZXML_FLD_ENDDATTYDSTYG = 'n' THEN ''
    ELSE ''
  END AS pb_aan_flex_aow_plus1,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN ZXML_FLD_SCENMOMENT != 'y' OR (zaansprstatcd NOT IN ('7','8','9')) THEN ''
    ELSE CASE 
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '1' THEN 'pensioenleeftijd'
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '2' THEN 'vooruit'
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' AND px_upo_ind_prog_methode = '3' THEN 'aow'
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '1' THEN 'pensioenleeftijd'
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '2' THEN 'vooruit'
      WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' AND px_mpo_ind_prog_methode = '3' THEN 'aow'
      ELSE ''
    END
  END AS pb_aan_scenariomoment,
  '' AS pb_aan_stijg_als_ovl_voor_lft,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN LTRIM(styg_vz_code) = '14' THEN ''
    WHEN LTRIM(styg_vz_code) IN ('92','94','99') THEN 'j'
    ELSE 'n'
  END AS pb_aan_afwijkende_stijging_jn,
  CASE 
    WHEN tmp_ind_no_aanspraak = 'y' THEN ''
    WHEN vz_cd_pa IN ('30','40','47','51') AND 'm4' <> 'm4' THEN '780'
    ELSE ''
  END AS pb_aan_stijging_tot_eindlftPARTNER
FROM filt_m4_m5_aanspk t1
LEFT JOIN aanspraken t2;


CREATE OR REPLACE TEMPORARY VIEW key_logic AS
SELECT
  pb_uit_uitkering_code,
  pb_uit_uitkering_duur,
  pb_uit_ingangslftd_uitkering,
  pb_uit_ingangsdatum_uitkering,
  pb_uit_bepaling_eind_uitk_code,
  pb_uit_eindleeftijd_uitkering,
  pb_uit_einddatum_uitkering,
  pb_uit_uitkering_bedrag,
  pb_uit_stijging_bedrag,
  pb_uit_stijging_percentage,
  pb_uit_stijging_TYPE,
  pb_uit_stijging_duur,
  pb_uit_aanvangsdatum_stijging,
  pb_uit_einddatum_tijd_stijging,
  pb_uit_uitk_status_code,
  pb_uit_scenariomoment,
  ZVOLGNR_uit,
  ZFLD_UITKERING_uit,
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  pb_bericht_versie,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  pb_overeenkomst_TYPE tmp_overeenkomst_TYPE_step2,
  pb_currency,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_jn,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_betaalde_premie,
  pb_code_PARTNER_bep_onbep,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_pensioenaanw_variabel_jn,
  pb_reductie_np_toegepast,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_aop_TYPE,
  pb_maximale_verhoging,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  ZVOLGNR_aan,
  h_status,
  tmp_ind_split_policy_divorce,
  tmp_ind_recipient,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  pb_aan_pensioensoortcode,
  pb_aan_aanspraakstatuscode,
  pb_aan_bepaling_ing_uitk_code,
  pb_aan_ingangslftd_uitkering,
  pb_aan_ingangsdatum_uitkering,
  pb_aan_bepaling_eind_uitk_code,
  pb_aan_eindleeftijd_uitkering,
  pb_aan_einddatum_uitkering,
  pb_aan_herkomst_uitkering_code,
  pb_aan_omslag_code,
  pb_aan_leeftijd_omslag,
  pb_aan_datum_omslag,
  pb_aan_financiering_code,
  pb_aan_uitkering_bedrag,
  pb_aan_stijging_bedrag,
  pb_aan_stijging_percentage,
  pb_aan_stijging_TYPE,
  pb_aan_stijging_duur,
  pb_aan_aanvangsdatum_stijging,
  pb_aan_einddatum_tijd_stijging,
  pb_aan_flex_aow_min2,
  pb_aan_flex_aow,
  pb_aan_flex_aow_plus1,
  pb_aan_scenariomoment,
  pb_aan_stijg_als_ovl_voor_lft,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  pb_klantnummer,
  verwdt_log,
  ZFLD_UITKERING_aan,
  pb_uit_afwijkende_stijging_jn,
  tmp_VZ_GROUP_lat,
  tmp_VZ_GROUP_uit,
  pb_aan_afwijkende_stijging_jn,
  pb_aan_stijging_tot_eindlftPARTNER,
  pb_vereniging_gepensioneerden,
  px_upo_idt_rel_op_boven_verw,
  px_upo_idt_rel_op_volgens_verw,
  px_upo_idt_rel_op_onder_verw,
  px_mpo_idt_rel_op_boven_verw,
  px_mpo_idt_rel_op_volgens_verw,
  px_mpo_idt_rel_op_onder_verw,
  tot_verz,
  tmp_overeenkomst_TYPE_step1,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  ondnr,
  naam,
  verk_naam,
  niet_pw_contract,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  px_ingekocht,
  px_upo_idt_nom_op_volgens_verw,
  px_mpo_idt_nom_op_volgens_verw,
  px_te_bereiken,
  pb_werknemer_prod_part_to_date,
  CONCAT(pb_polis_nummer, '-', pb_polis_nummer_toevoeging) AS xml_id,
  CASE
    WHEN (pb_aan_pensioensoortcode IS NOT NULL AND pb_aan_pensioensoortcode != '')
      THEN CONCAT(vz_cd_pa, '-', 'aan', ZVOLGNR_aan)
    WHEN (pb_uit_uitkering_code IS NOT NULL AND pb_uit_uitkering_code != '')
      THEN CONCAT(vz_cd_pa, '-', 'uit', ZVOLGNR_uit)
    ELSE ''
  END AS xml_sub_id
FROM union_2;


CREATE OR REPLACE TEMPORARY VIEW del_logic AS (
SELECT
  t1.relnr,
  t1.volgnr,
  t1.vz_cd_pa,
  t1.run_id,
  t1.run_TYPE,
  t1.reference_date,
  t1.verwdt,
  t1.verwdt_log,
  t1.run_timestamp,
  t1.run_date,
  t1.xml_id,
  t1.xml_sub_id,
  t1.pb_bericht_versie,
  t1.pb_bronsysteem_code,
  t1.pb_polis_nummer,
  t1.pb_polis_nummer_toevoeging,
  t1.pb_versie_id,
  t1.pb_label,
  t1.pb_polis_mutatiedatum,
  t1.pb_polis_extractiemoment,
  t1.pb_geb_datum_deelnemer,
  t1.pb_geslacht_deelnemer,
  t1.pb_geb_datum_PARTNER,
  t1.pb_geslacht_PARTNER,
  t1.tmp_overeenkomst_TYPE_step2,
  t1.pb_currency,
  t1.pb_in_dienst,
  t1.pb_uit_dienst,
  t1.pb_wtp_regeling_jn,
  t1.pb_pensioenregeling_nummer,
  t1.pb_pensioenuitvoerder_code,
  t1.pb_ind_regeling_netto_jn,
  t1.pb_pensioenrichtleeftijd,
  t1.pb_pensioenregeling_ingangsdat,
  t1.pb_reductie_np_lft_mnd,
  t1.pb_deelname_status_code,
  t1.pb_beschikbare_premie,
  t1.pb_aanvullende_premie,
  t1.pb_vrijgestelde_premie,
  t1.pb_franchise,
  t1.pb_pensioengevend_salaris,
  t1.pb_pensioengrondslag,
  t1.pb_perc_opbouw,
  t1.pb_perc_deeltijd,
  t1.pb_pensioendatum,
  t1.pb_pensioenleeftijd,
  t1.pb_datum_begin_opbouw,
  t1.pb_datum_einde_deelneming,
  t1.pb_uitbreidingsleeftijd_kind,
  t1.pb_ind_premievrijst_jn,
  t1.pb_ind_premievrijst_ing_jn,
  t1.pb_ind_toeslag_actief,
  t1.pb_ind_toeslag_inactief,
  t1.pb_ind_toeslag_act_inact_afw,
  t1.pb_ind_rendementsgar_actief_jn,
  t1.pb_verevening_status,
  t1.pb_verevening_code,
  t1.pb_p123_tonen,
  t1.pb_betaalde_premie,
  t1.pb_code_PARTNER_bep_onbep,
  t1.pb_ind_herverzekerd_jn,
  t1.pb_anw_basis_jn,
  t1.pb_code_bnp_verwerkt,
  t1.pb_reductie_np_toegepast,
  t1.pb_pensioenaanw_variabel_jn,
  t1.pb_werknemer_id,
  t1.pb_PARTNER_id,
  t1.pb_werkgever_id,
  t1.pb_masterpolicy,
  t1.pb_klantnummer,
  t1.pb_team_id,
  t1.pb_team_naam,
  t1.pb_factora_jaar,
  t1.pb_factora_bedrag,
  t1.pb_kap_bij_leven_tdns_dnstverb,
  t1.pb_kap_bij_leven_na_dnstverb,
  t1.pb_kap_bij_overl_tdns_dnstverb,
  t1.pb_kap_bij_overl_na_dnstverb,
  t1.pb_aop_TYPE,
  t1.pb_aop_eindleeftijd,
  t1.pb_aop_bedrag,
  t1.pb_toeslag_variant,
  t1.pb_toeslag_status,
  t1.pb_maatstaf,
  t1.pb_maximale_verhoging,
  t1.pb_toeslag_jaar_t0,
  t1.pb_toeslag_percentage_t0,
  t1.pb_toeslag_jaar_t1,
  t1.pb_toeslag_percentage_t1,
  t1.pb_toeslag_jaar_t2,
  t1.pb_toeslag_percentage_t2,
  t1.pb_toeslag_jaar_t3,
  t1.pb_toeslag_percentage_t3,
  t1.pb_toeslag_jaar_t4,
  t1.pb_toeslag_percentage_t4,
  t1.pb_aan_pensioensoortcode,
  t1.pb_aan_aanspraakstatuscode,
  t1.pb_aan_bepaling_ing_uitk_code,
  t1.pb_aan_ingangslftd_uitkering,
  t1.pb_aan_ingangsdatum_uitkering,
  t1.pb_aan_bepaling_eind_uitk_code,
  t1.pb_aan_eindleeftijd_uitkering,
  t1.pb_aan_einddatum_uitkering,
  t1.pb_aan_herkomst_uitkering_code,
  t1.pb_aan_omslag_code,
  t1.pb_aan_leeftijd_omslag,
  t1.pb_aan_datum_omslag,
  t1.pb_aan_financiering_code,
  t1.pb_aan_uitkering_bedrag,
  t1.pb_aan_stijging_bedrag,
  t1.pb_aan_stijging_percentage,
  t1.pb_aan_stijging_TYPE,
  t1.pb_aan_stijging_duur,
  t1.pb_aan_aanvangsdatum_stijging,
  t1.pb_aan_einddatum_tijd_stijging,
  t1.pb_aan_stijging_tot_eindlftPARTNER,
  t1.pb_aan_flex_aow_min2,
  t1.pb_aan_flex_aow,
  t1.pb_aan_flex_aow_plus1,
  t1.pb_aan_scenariomoment,
  t1.pb_aan_stijg_als_ovl_voor_lft,
  t1.pb_aan_afwijkende_stijging_jn,
  t1.pb_uit_uitkering_code,
  t1.pb_uit_uitkering_duur,
  t1.pb_uit_ingangslftd_uitkering,
  t1.pb_uit_ingangsdatum_uitkering,
  t1.pb_uit_bepaling_eind_uitk_code,
  t1.pb_uit_eindleeftijd_uitkering,
  t1.pb_uit_einddatum_uitkering,
  t1.pb_uit_uitkering_bedrag,
  t1.pb_uit_stijging_bedrag,
  t1.pb_uit_stijging_percentage,
  t1.pb_uit_stijging_TYPE,
  t1.pb_uit_stijging_duur,
  t1.pb_uit_aanvangsdatum_stijging,
  t1.pb_uit_einddatum_tijd_stijging,
  t1.pb_uit_uitk_status_code,
  t1.pb_uit_scenariomoment,
  t1.____________________________________________,
  t1.tmp_pensioensoort,
  t1.tmp_VZ_GROUP,
  t2.tmp_aan_scenariomoment_mpo,
  t2.tmp_aan_scenariomoment_upo,
  t2.tmp_uit_scenariomoment_mpo,
  t2.tmp_uit_scenariomoment_upo,
  t1.ZFLD_UITKERING_aan,
  t1.ZFLD_UITKERING_uit,
  t1.h_status,
  t1.tmp_ind_split_policy_divorce,
  t1.tmp_ind_recipient,
  t1.tmp_ind_PARTNER_is_exPARTNER,
  t1.tmp_ind_kapitaal_bij_leven,
  t1.tmp_ind_kapitaal_bij_overlijden,
  t1.pb_uit_afwijkende_stijging_jn,
  t1.tmp_VZ_GROUP_lat,
  t1.tmp_VZ_GROUP_uit,
  t1.pb_vereniging_gepensioneerden,
  t1.px_upo_idt_rel_op_boven_verw,
  t1.px_upo_idt_rel_op_volgens_verw,
  t1.px_upo_idt_rel_op_onder_verw,
  t1.px_mpo_idt_rel_op_boven_verw,
  t1.px_mpo_idt_rel_op_volgens_verw,
  t1.px_mpo_idt_rel_op_onder_verw,
  t1.tot_verz,
  t1.tmp_overeenkomst_TYPE_step1,
  t1.tmp_ind_err_211038,
  t1.tmp_ind_err_211039,
  t1.tmp_ind_err_211044,
  t1.tmp_ind_err_211045,
  t1.ondnr,
  t1.naam,
  t1.verk_naam,
  t1.niet_pw_contract,
  t1.pb_ind_kap_bij_leven_bron,
  t1.pb_ind_kap_bij_overlijden_bron,
  t1.upo_verv_code,
  t1.soort_rel_code,
  t1.munt_code,
  t1.px_ingekocht,
  t1.px_upo_idt_nom_op_volgens_verw,
  t1.px_mpo_idt_nom_op_volgens_verw,
  t1.px_te_bereiken,
  t1.pb_werknemer_prod_part_to_date,
  CASE
    WHEN (
      (t1.pb_aan_aanspraakstatuscode IS NULL OR t1.pb_aan_aanspraakstatuscode = '')
      AND
      (t1.pb_uit_uitk_status_code IS NULL OR t1.pb_uit_uitk_status_code = '')
    ) THEN 'x'
    ELSE CASE
      WHEN (t1.vz_cd_pa = '50') THEN 'x'
      ELSE CASE
        WHEN (t1.vz_cd_pa = '81' AND t1.h_status != 'ge') THEN 'x'
        ELSE CASE
          WHEN (t1.vz_cd_pa IN ('60','61','62','63','64','65','66','67','68','68','69') AND t1.h_status = 'ge') THEN 'x'
          ELSE CASE
            WHEN (LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm5' AND t1.run_TYPE = 'u') THEN 'x'
            ELSE CASE
              WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                    AND NOT (t1.pb_aan_aanspraakstatuscode IN ('7','8','9'))
                    AND t1.pb_aan_uitkering_bedrag = 0) THEN 'x'
              ELSE CASE
                WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                      AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                      AND (t1.pb_aan_uitkering_bedrag = 0 OR t1.pb_aan_uitkering_bedrag = 0.01)
                      AND (t1.px_ingekocht + t1.px_te_bereiken) = 0
                      AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) != 'm2') THEN 'x'
                ELSE CASE
                  WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                        AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                        AND (t1.pb_aan_uitkering_bedrag = 0 OR t1.pb_aan_uitkering_bedrag = 0.01)
                        AND t1.px_upo_idt_nom_op_volgens_verw = 0
                        AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_upo'
                        AND t1.px_upo_idt_rel_op_boven_verw = 0
                        AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2') THEN 'x'
                  ELSE CASE
                    WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                          AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                          AND (t1.pb_aan_uitkering_bedrag = 0 OR t1.pb_aan_uitkering_bedrag = 0.01)
                          AND t1.px_mpo_idt_nom_op_volgens_verw = 0
                          AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_mpo'
                          AND t1.px_mpo_idt_rel_op_boven_verw = 0
                          AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2') THEN 'x'
                    ELSE CASE
                      WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                            AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                            AND t1.ZFLD_UITKERING_aan IS NOT NULL
                            AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_upo'
                            AND t1.tmp_aan_scenariomoment_upo = '') THEN 'x'
                      ELSE CASE
                        WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                              AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                              AND t1.ZFLD_UITKERING_aan IS NOT NULL
                              AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_mpo'
                              AND t1.tmp_aan_scenariomoment_mpo = '') THEN 'x'
                        ELSE CASE
                          WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                                AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                                AND t1.ZFLD_UITKERING_aan IS NOT NULL
                                AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_upo'
                                AND t1.tmp_aan_scenariomoment_upo != ''
                                AND t1.tot_verz = 0
                                AND t1.px_upo_idt_rel_op_boven_verw = 0
                                AND t1.px_upo_idt_rel_op_volgens_verw = 0
                                AND t1.px_upo_idt_rel_op_onder_verw = 0) THEN 'x'
                          ELSE CASE
                            WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                                  AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                                  AND t1.ZFLD_UITKERING_aan IS NOT NULL
                                  AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_mpo'
                                  AND t1.tmp_aan_scenariomoment_mpo != ''
                                  AND t1.tot_verz = 0
                                  AND t1.px_mpo_idt_rel_op_boven_verw = 0
                                  AND t1.px_mpo_idt_rel_op_volgens_verw = 0
                                  AND t1.px_mpo_idt_rel_op_onder_verw = 0) THEN 'x'
                            ELSE CASE
                              WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                    AND NOT (t1.pb_uit_uitk_status_code IN ('2','3','4'))
                                    AND t1.pb_uit_uitkering_bedrag = 0) THEN 'x'
                              ELSE CASE
                                WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                      AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                      AND (t1.pb_uit_uitkering_bedrag = 0 OR t1.pb_uit_uitkering_bedrag = 0.01)
                                      AND (t1.px_ingekocht + t1.px_upo_idt_nom_op_volgens_verw) = 0
                                      AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_upo'
                                      AND t1.px_upo_idt_rel_op_boven_verw = 0) THEN 'x'
                                ELSE CASE
                                  WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                        AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                        AND (t1.pb_uit_uitkering_bedrag = 0 OR t1.pb_uit_uitkering_bedrag = 0.01)
                                        AND (t1.px_ingekocht + t1.px_mpo_idt_nom_op_volgens_verw) = 0
                                        AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_mpo'
                                        AND t1.px_mpo_idt_rel_op_boven_verw = 0) THEN 'x'
                                  ELSE CASE
                                    WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                          AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                          AND t1.ZFLD_UITKERING_uit IS NOT NULL
                                          AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_upo'
                                          AND t1.tmp_uit_scenariomoment_upo = '') THEN 'x'
                                    ELSE CASE
                                      WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                            AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                            AND t1.ZFLD_UITKERING_uit IS NOT NULL
                                            AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_mpo'
                                            AND t1.tmp_uit_scenariomoment_mpo = '') THEN 'x'
                                      ELSE CASE
                                        WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                              AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                              AND t1.ZFLD_UITKERING_uit IS NOT NULL
                                              AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_upo'
                                              AND t1.tmp_uit_scenariomoment_upo != ''
                                              AND t1.tot_verz = 0
                                              AND t1.px_upo_idt_rel_op_boven_verw = 0
                                              AND t1.px_upo_idt_rel_op_volgens_verw = 0
                                              AND t1.px_upo_idt_rel_op_onder_verw = 0) THEN 'x'
                                        ELSE CASE
                                          WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                                AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                                AND t1.ZFLD_UITKERING_uit IS NOT NULL
                                                AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_mpo'
                                                AND t1.tmp_uit_scenariomoment_mpo != ''
                                                AND t1.tot_verz = 0
                                                AND t1.px_mpo_idt_rel_op_boven_verw = 0
                                                AND t1.px_mpo_idt_rel_op_volgens_verw = 0
                                                AND t1.px_mpo_idt_rel_op_onder_verw = 0) THEN 'x'
                                          ELSE CASE
                                            WHEN (t1.pb_aan_aanspraakstatuscode IS NOT NULL
                                                  AND t1.pb_aan_aanspraakstatuscode IN ('7','8','9')
                                                  AND t1.ZFLD_UITKERING_aan IS NOT NULL
                                                  AND LEFT(t1.ZFLD_UITKERING_aan,14) = 'px_base.px_mpo'
                                                  AND RIGHT(t1.reference_date,4) = '1231'
                                                  AND t1.tmp_aan_scenariomoment_mpo = t1.tmp_aan_scenariomoment_upo) THEN 'x'
                                            ELSE CASE
                                              WHEN (t1.pb_uit_uitk_status_code IS NOT NULL
                                                    AND t1.pb_uit_uitk_status_code IN ('2','3','4')
                                                    AND t1.ZFLD_UITKERING_uit IS NOT NULL
                                                    AND LEFT(t1.ZFLD_UITKERING_uit,14) = 'px_base.px_mpo'
                                                    AND RIGHT(t1.reference_date,4) = '1231'
                                                    AND t1.tmp_uit_scenariomoment_mpo = t1.tmp_uit_scenariomoment_upo) THEN 'x'
                                              ELSE CASE
                                                WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                      AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                      AND t1.tmp_VZ_GROUP = 'kaplvn3'
                                                      AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                      AND t1.pb_aan_pensioensoortcode = '2') THEN 'x'
                                                ELSE CASE
                                                  WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                        AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                        AND t1.tmp_VZ_GROUP = 'kaplvn4') THEN 'x'
                                                  ELSE CASE
                                                    WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                          AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                          AND t1.tmp_VZ_GROUP = 'kaplvn1ovl'
                                                          AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                          AND t1.pb_aan_pensioensoortcode = '2') THEN 'x'
                                                    ELSE CASE
                                                      WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                            AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                            AND t1.tmp_VZ_GROUP = 'kaplvn2ovl'
                                                            AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                            AND t1.pb_aan_pensioensoortcode = '2') THEN 'x'
                                                      ELSE CASE
                                                        WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                              AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                              AND t1.tmp_VZ_GROUP = 'kaplvn3ovl'
                                                              AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                              AND t1.pb_aan_pensioensoortcode = '2') THEN 'x'
                                                        ELSE CASE
                                                          WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                                AND t1.tmp_VZ_GROUP = 'kaplvn4ovl') THEN 'x'
                                                          ELSE CASE
                                                            WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                  AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                                  AND t1.tmp_VZ_GROUP = 'kapovl') THEN 'x'
                                                            ELSE CASE
                                                              WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                    AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm2'
                                                                    AND t1.tmp_VZ_GROUP = 'kapovlll') THEN 'x'
                                                              ELSE CASE
                                                                WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                      AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                      AND t1.tmp_VZ_GROUP = 'kaplvn1') THEN 'x'
                                                                ELSE CASE
                                                                  WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                        AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                        AND t1.tmp_VZ_GROUP = 'kaplvn2') THEN 'x'
                                                                  ELSE CASE
                                                                    WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                          AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                          AND t1.tmp_VZ_GROUP = 'kaplvn3'
                                                                          AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                                          AND t1.pb_aan_pensioensoortcode = '1') THEN 'x'
                                                                    ELSE CASE
                                                                      WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                            AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                            AND t1.tmp_VZ_GROUP = 'kaplvn1ovl'
                                                                            AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                                            AND t1.pb_aan_pensioensoortcode = '1') THEN 'x'
                                                                      ELSE CASE
                                                                        WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                              AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                              AND t1.tmp_VZ_GROUP = 'kaplvn2ovl'
                                                                              AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                                              AND t1.pb_aan_pensioensoortcode = '1') THEN 'x'
                                                                        ELSE CASE
                                                                          WHEN (t1.tmp_ind_split_policy_divorce = 'y'
                                                                                AND LEFT(t1.tmp_overeenkomst_TYPE_step2,2) = 'm4'
                                                                                AND t1.tmp_VZ_GROUP = 'kaplvn3ovl'
                                                                                AND t1.pb_aan_pensioensoortcode IS NOT NULL
                                                                                AND t1.pb_aan_pensioensoortcode = '1') THEN 'x'
                                                                          ELSE ''
                                                                        END
                                                                      END
                                                                    END
                                                                  END
                                                                END
                                                              END
                                                            END
                                                          END
                                                        END
                                                      END
                                                    END
                                                  END
                                                END
                                              END
                                            END
                                          END
                                        END
                                      END
                                    END
                                  END
                                END
                              END
                            END
                          END
                        END
                      END
                    END
                  END
                END
              END
            END
          END
        END
      END
    END
  END AS pb_ind_aanspraak_deletion
FROM key_logic t1
LEFT JOIN xml_level t2
);


CREATE OR REPLACE TEMPORARY VIEW scenario_comp AS
SELECT
  xml_id,
  pb_aan_aanspraakstatuscode,
  pb_aan_scenariomoment,
  ZFLD_UITKERING_aan,
  ZFLD_UITKERING_uit,
  pb_uit_uitk_status_code,
  pb_uit_scenariomoment,
  CASE 
    WHEN ZFLD_UITKERING_aan IS NOT NULL THEN CASE WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_mpo' THEN pb_aan_scenariomoment ELSE '' END
    ELSE ''
  END AS tmp_aan_scenariomoment_mpo,
  CASE 
    WHEN ZFLD_UITKERING_aan IS NOT NULL THEN CASE WHEN LEFT(ZFLD_UITKERING_aan,14) = 'px_base.px_upo' THEN pb_aan_scenariomoment ELSE '' END
    ELSE ''
  END AS tmp_aan_scenariomoment_upo,
  CASE 
    WHEN ZFLD_UITKERING_uit IS NOT NULL THEN CASE WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_mpo' THEN pb_uit_scenariomoment ELSE '' END
    ELSE ''
  END AS tmp_uit_scenariomoment_mpo,
  CASE 
    WHEN ZFLD_UITKERING_uit IS NOT NULL THEN CASE WHEN LEFT(ZFLD_UITKERING_uit,14) = 'px_base.px_upo' THEN pb_uit_scenariomoment ELSE '' END
    ELSE ''
  END AS tmp_uit_scenariomoment_upo
FROM key_logic
WHERE pb_aan_aanspraakstatuscode IN ('7','8','9')
  OR pb_uit_uitk_status_code IN ('2','3','4');


CREATE OR REPLACE TEMPORARY VIEW ovt_dga_logic AS (
SELECT 
  `relnr`,
  `volgnr`,
  `vz_cd_pa`,
  `run_id`,
  `run_TYPE`,
  `reference_date`,
  `verwdt`,
  `verwdt_log`,
  `run_timestamp`,
  `run_date`,
  `xml_id`,
  `xml_sub_id`,
  `pb_bericht_versie`,
  `pb_bronsysteem_code`,
  `pb_polis_nummer`,
  `pb_polis_nummer_toevoeging`,
  `pb_versie_id`,
  `pb_label`,
  `pb_polis_mutatiedatum`,
  `pb_polis_extractiemoment`,
  `pb_geb_datum_deelnemer`,
  `pb_geslacht_deelnemer`,
  `pb_geb_datum_PARTNER`,
  `pb_geslacht_PARTNER`,
  `tmp_overeenkomst_TYPE_step2`,
  `pb_currency`,
  `pb_in_dienst`,
  `pb_uit_dienst`,
  `pb_wtp_regeling_jn`,
  `pb_pensioenregeling_nummer`,
  `pb_pensioenuitvoerder_code`,
  `pb_ind_regeling_netto_jn`,
  `pb_pensioenrichtleeftijd`,
  `pb_pensioenregeling_ingangsdat`,
  `pb_vereniging_gepensioneerden`,
  `pb_reductie_np_lft_mnd`,
  `pb_deelname_status_code`,
  `pb_beschikbare_premie`,
  `pb_aanvullende_premie`,
  `pb_vrijgestelde_premie`,
  `pb_franchise`,
  `pb_pensioengevend_salaris`,
  `pb_pensioengrondslag`,
  `pb_perc_opbouw`,
  `pb_perc_deeltijd`,
  `pb_pensioendatum`,
  `pb_pensioenleeftijd`,
  `pb_datum_begin_opbouw`,
  `pb_datum_einde_deelneming`,
  `pb_uitbreidingsleeftijd_kind`,
  `pb_ind_premievrijst_jn`,
  `pb_ind_premievrijst_ing_jn`,
  `pb_ind_toeslag_actief`,
  `pb_ind_toeslag_inactief`,
  `pb_ind_toeslag_act_inact_afw`,
  `pb_ind_rendementsgar_actief_jn`,
  `pb_verevening_status`,
  `pb_verevening_code`,
  `pb_p123_tonen`,
  `pb_betaalde_premie`,
  `pb_code_PARTNER_bep_onbep`,
  `pb_ind_herverzekerd_jn`,
  `pb_anw_basis_jn`,
  `pb_code_bnp_verwerkt`,
  `pb_reductie_np_toegepast`,
  `pb_pensioenaanw_variabel_jn`,
  `pb_werknemer_id`,
  `pb_PARTNER_id`,
  `pb_werkgever_id`,
  `pb_masterpolicy`,
  `pb_klantnummer`,
  `pb_team_id`,
  `pb_team_naam`,
  `pb_factora_jaar`,
  `pb_factora_bedrag`,
  `pb_kap_bij_leven_tdns_dnstverb`,
  `pb_kap_bij_leven_na_dnstverb`,
  `pb_kap_bij_overl_tdns_dnstverb`,
  `pb_kap_bij_overl_na_dnstverb`,
  `pb_aop_TYPE`,
  `pb_aop_eindleeftijd`,
  `pb_aop_bedrag`,
  `pb_toeslag_variant`,
  `pb_toeslag_status`,
  `pb_maatstaf`,
  `pb_maximale_verhoging`,
  `pb_toeslag_jaar_t0`,
  `pb_toeslag_percentage_t0`,
  `pb_toeslag_jaar_t1`,
  `pb_toeslag_percentage_t1`,
  `pb_toeslag_jaar_t2`,
  `pb_toeslag_percentage_t2`,
  `pb_toeslag_jaar_t3`,
  `pb_toeslag_percentage_t3`,
  `pb_toeslag_jaar_t4`,
  `pb_toeslag_percentage_t4`,
  `pb_aan_pensioensoortcode`,
  `pb_aan_aanspraakstatuscode`,
  `pb_aan_bepaling_ing_uitk_code`,
  `pb_aan_ingangslftd_uitkering`,
  `pb_aan_ingangsdatum_uitkering`,
  `pb_aan_bepaling_eind_uitk_code`,
  `pb_aan_eindleeftijd_uitkering`,
  `pb_aan_einddatum_uitkering`,
  `pb_aan_herkomst_uitkering_code`,
  `pb_aan_omslag_code`,
  `pb_aan_leeftijd_omslag`,
  `pb_aan_datum_omslag`,
  `pb_aan_financiering_code`,
  `pb_aan_uitkering_bedrag`,
  `pb_aan_stijging_bedrag`,
  `pb_aan_stijging_percentage`,
  `pb_aan_stijging_TYPE`,
  `pb_aan_stijging_duur`,
  `pb_aan_aanvangsdatum_stijging`,
  `pb_aan_einddatum_tijd_stijging`,
  `pb_aan_stijging_tot_eindlftPARTNER`,
  `pb_aan_flex_aow_min2`,
  `pb_aan_flex_aow`,
  `pb_aan_flex_aow_plus1`,
  `pb_aan_scenariomoment`,
  `pb_aan_stijg_als_ovl_voor_lft`,
  `pb_aan_afwijkende_stijging_jn`,
  `pb_uit_uitkering_code`,
  `pb_uit_uitkering_duur`,
  `pb_uit_ingangslftd_uitkering`,
  `pb_uit_ingangsdatum_uitkering`,
  `pb_uit_bepaling_eind_uitk_code`,
  `pb_uit_eindleeftijd_uitkering`,
  `pb_uit_einddatum_uitkering`,
  `pb_uit_uitkering_bedrag`,
  `pb_uit_stijging_bedrag`,
  `pb_uit_stijging_percentage`,
  `pb_uit_stijging_TYPE`,
  `pb_uit_stijging_duur`,
  `pb_uit_aanvangsdatum_stijging`,
  `pb_uit_einddatum_tijd_stijging`,
  `pb_uit_uitk_status_code`,
  `pb_uit_scenariomoment`,
  `pb_uit_afwijkende_stijging_jn`,
  `pb_ind_aanspraak_deletion`,
  `tmp_pensioensoort`,
  `tmp_VZ_GROUP`,
  `tmp_VZ_GROUP_lat`,
  `tmp_VZ_GROUP_uit`,
  `h_status`,
  `tmp_ind_split_policy_divorce`,
  `tmp_ind_recipient`,
  `tmp_ind_PARTNER_is_exPARTNER`,
  `tmp_ind_kapitaal_bij_leven`,
  `tmp_ind_kapitaal_bij_overlijden`,
  `tmp_overeenkomst_TYPE_step1`,
  `tmp_ind_err_211038`,
  `tmp_ind_err_211039`,
  `tmp_ind_err_211044`,
  `tmp_ind_err_211045`,
  `ondnr`,
  `naam`,
  `verk_naam`,
  `niet_pw_contract`,
  `pb_ind_kap_bij_leven_bron`,
  `pb_ind_kap_bij_overlijden_bron`,
  `upo_verv_code`,
  `soort_rel_code`,
  `munt_code`,
  `pb_werknemer_prod_part_to_date`,
  CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm1.01') THEN 'm1.03'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm1.02') THEN 'm1.04'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm2.01') THEN 'm2.03'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm2.02') THEN 'm2.04'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm4.01') THEN 'm4.02'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm4.05') THEN 'm4.06'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm4.07') THEN 'm4.08'
       ELSE CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*')) AND `tmp_overeenkomst_TYPE_step2` = 'm5.01') THEN 'm5.03'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm1.01') THEN 'm1.03'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm1.02') THEN 'm1.04'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm2.01') THEN 'm2.03'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm2.02') THEN 'm2.04'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm4.01') THEN 'm4.02'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm4.05') THEN 'm4.06'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm4.07') THEN 'm4.08'
       ELSE CASE WHEN (`relnr` = '89062' AND `tmp_overeenkomst_TYPE_step2` = 'm5.01') THEN 'm5.03'
       ELSE `tmp_overeenkomst_TYPE_step2`
       END END END END END END END END END END END END END END END END AS `tmp_overeenkomst_TYPE_step3`,
  CASE WHEN (`ondnr` = '64' AND ((`naam` rlike '.*dga.*') OR (`verk_naam` rlike '.*dga.*'))) THEN 'j'
       ELSE CASE WHEN (`relnr` = '89062') THEN 'n'
       ELSE ''
       END
  END AS `pb_pensioenwetplichtig`
FROM `del_logic`
);


CREATE OR REPLACE TEMPORARY VIEW ovt_err_logic AS
SELECT
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211045,
  tmp_ind_err_211044,
  tmp_overeenkomst_TYPE_step1,
  tmp_overeenkomst_TYPE_step2,
  tmp_ind_kapitaal_bij_overlijden,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_recipient,
  tmp_ind_split_policy_divorce,
  h_status,
  tmp_VZ_GROUP_uit,
  tmp_VZ_GROUP_lat,
  tmp_VZ_GROUP,
  tmp_pensioensoort,
  pb_ind_aanspraak_deletion,
  pb_uit_afwijkende_stijging_jn,
  pb_uit_scenariomoment,
  pb_uit_uitk_status_code,
  pb_uit_einddatum_tijd_stijging,
  pb_uit_aanvangsdatum_stijging,
  pb_uit_stijging_duur,
  pb_uit_stijging_TYPE,
  pb_uit_stijging_percentage,
  pb_uit_stijging_bedrag,
  pb_uit_uitkering_bedrag,
  pb_uit_einddatum_uitkering,
  pb_uit_eindleeftijd_uitkering,
  pb_uit_bepaling_eind_uitk_code,
  pb_uit_ingangsdatum_uitkering,
  pb_uit_ingangslftd_uitkering,
  pb_uit_uitkering_duur,
  pb_uit_uitkering_code,
  pb_aan_afwijkende_stijging_jn,
  pb_aan_stijg_als_ovl_voor_lft,
  pb_aan_scenariomoment,
  pb_aan_flex_aow_plus1,
  pb_aan_flex_aow,
  pb_aan_flex_aow_min2,
  pb_aan_stijging_tot_eindlftPARTNER,
  pb_aan_einddatum_tijd_stijging,
  pb_aan_aanvangsdatum_stijging,
  pb_aan_stijging_duur,
  pb_aan_stijging_TYPE,
  pb_aan_stijging_percentage,
  pb_aan_stijging_bedrag,
  pb_aan_uitkering_bedrag,
  pb_aan_financiering_code,
  pb_aan_datum_omslag,
  pb_aan_leeftijd_omslag,
  pb_aan_omslag_code,
  pb_aan_herkomst_uitkering_code,
  pb_aan_einddatum_uitkering,
  pb_aan_eindleeftijd_uitkering,
  pb_aan_bepaling_eind_uitk_code,
  pb_aan_ingangsdatum_uitkering,
  pb_aan_ingangslftd_uitkering,
  pb_aan_bepaling_ing_uitk_code,
  pb_aan_aanspraakstatuscode,
  pb_aan_pensioensoortcode,
  pb_toeslag_percentage_t4,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t0,
  pb_maximale_verhoging,
  pb_maatstaf,
  pb_toeslag_status,
  pb_toeslag_variant,
  pb_aop_bedrag,
  pb_aop_eindleeftijd,
  pb_aop_TYPE,
  pb_kap_bij_overl_na_dnstverb,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_factora_bedrag,
  pb_factora_jaar,
  pb_team_naam,
  pb_team_id,
  pb_klantnummer,
  pb_masterpolicy,
  pb_werkgever_id,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_pensioenaanw_variabel_jn,
  pb_reductie_np_toegepast,
  pb_code_bnp_verwerkt,
  pb_anw_basis_jn,
  pb_ind_herverzekerd_jn,
  pb_code_PARTNER_bep_onbep,
  pb_betaalde_premie,
  pb_p123_tonen,
  pb_verevening_code,
  pb_verevening_status,
  pb_ind_rendementsgar_actief_jn,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_actief,
  pb_ind_premievrijst_ing_jn,
  pb_ind_premievrijst_jn,
  pb_uitbreidingsleeftijd_kind,
  pb_datum_einde_deelneming,
  pb_datum_begin_opbouw,
  pb_pensioenleeftijd,
  pb_pensioendatum,
  pb_perc_deeltijd,
  pb_perc_opbouw,
  pb_pensioengrondslag,
  pb_pensioengevend_salaris,
  pb_franchise,
  pb_vrijgestelde_premie,
  pb_aanvullende_premie,
  pb_beschikbare_premie,
  pb_deelname_status_code,
  pb_reductie_np_lft_mnd,
  pb_vereniging_gepensioneerden,
  pb_pensioenregeling_ingangsdat,
  pb_pensioenrichtleeftijd,
  pb_ind_regeling_netto_jn,
  pb_pensioenuitvoerder_code,
  pb_pensioenregeling_nummer,
  pb_wtp_regeling_jn,
  pb_uit_dienst,
  pb_in_dienst,
  pb_currency,
  pb_pensioenwetplichtig,
  tmp_overeenkomst_TYPE_step3,
  pb_geslacht_PARTNER,
  pb_geb_datum_PARTNER,
  pb_geslacht_deelnemer,
  pb_geb_datum_deelnemer,
  pb_polis_extractiemoment,
  pb_polis_mutatiedatum,
  pb_label,
  pb_versie_id,
  pb_polis_nummer_toevoeging,
  pb_polis_nummer,
  pb_bronsysteem_code,
  pb_bericht_versie,
  xml_sub_id,
  xml_id,
  run_date,
  run_timestamp,
  verwdt_log,
  verwdt,
  reference_date,
  run_TYPE,
  run_id,
  vz_cd_pa,
  volgnr,
  relnr,
  pb_ind_kap_bij_leven_bron,
  pb_ind_kap_bij_overlijden_bron,
  upo_verv_code,
  soort_rel_code,
  munt_code,
  niet_pw_contract,
  pb_werknemer_prod_part_to_date,
  CASE
    WHEN upo_verv_code = '5' THEN 'x7.09'
    WHEN soort_rel_code = '8' THEN 'x7.10'
    WHEN munt_code = '9' THEN 'x7.02'
    WHEN niet_pw_contract = '1' AND upo_verv_code = '0' THEN 'x7.11'
    ELSE tmp_overeenkomst_TYPE_step3
  END AS tmp_overeenkomst_TYPE_step4
FROM ovt_dga_logic;


CREATE OR REPLACE TEMPORARY VIEW standdatum AS
SELECT
  relnr,
  volgnr,
  vz_cd_pa,
  run_id,
  run_TYPE,
  reference_date,
  verwdt,
  run_timestamp,
  run_date,
  xml_id,
  xml_sub_id,
  pb_bericht_versie,
  pb_bronsysteem_code,
  pb_polis_nummer,
  pb_polis_nummer_toevoeging,
  pb_versie_id,
  pb_label,
  pb_polis_mutatiedatum,
  pb_polis_extractiemoment,
  pb_geb_datum_deelnemer,
  pb_geslacht_deelnemer,
  pb_geb_datum_PARTNER,
  pb_geslacht_PARTNER,
  tmp_overeenkomst_TYPE_step4 AS pb_overeenkomst_TYPE,
  pb_currency,
  pb_pensioenwetplichtig,
  pb_in_dienst,
  pb_uit_dienst,
  pb_wtp_regeling_jn,
  pb_pensioenregeling_nummer,
  pb_pensioenuitvoerder_code,
  pb_ind_regeling_netto_jn,
  pb_pensioenrichtleeftijd,
  pb_pensioenregeling_ingangsdat,
  pb_vereniging_gepensioneerden,
  pb_reductie_np_lft_mnd,
  pb_deelname_status_code,
  pb_beschikbare_premie,
  pb_aanvullende_premie,
  pb_vrijgestelde_premie,
  pb_franchise,
  pb_pensioengevend_salaris,
  pb_pensioengrondslag,
  pb_perc_opbouw,
  pb_perc_deeltijd,
  pb_pensioendatum,
  pb_pensioenleeftijd,
  pb_datum_begin_opbouw,
  pb_datum_einde_deelneming,
  pb_uitbreidingsleeftijd_kind,
  pb_ind_premievrijst_jn,
  pb_ind_premievrijst_ing_jn,
  pb_ind_toeslag_actief,
  pb_ind_toeslag_inactief,
  pb_ind_toeslag_act_inact_afw,
  pb_ind_rendementsgar_actief_jn,
  pb_verevening_status,
  pb_verevening_code,
  pb_p123_tonen,
  pb_betaalde_premie,
  pb_code_PARTNER_bep_onbep,
  pb_ind_herverzekerd_jn,
  pb_anw_basis_jn,
  pb_code_bnp_verwerkt,
  pb_reductie_np_toegepast,
  pb_pensioenaanw_variabel_jn,
  pb_werknemer_id,
  pb_PARTNER_id,
  pb_werkgever_id,
  pb_masterpolicy,
  pb_klantnummer,
  pb_team_id,
  pb_team_naam,
  pb_factora_jaar,
  pb_factora_bedrag,
  pb_kap_bij_leven_tdns_dnstverb,
  pb_kap_bij_leven_na_dnstverb,
  pb_ind_kap_bij_leven_bron,
  pb_kap_bij_overl_tdns_dnstverb,
  pb_kap_bij_overl_na_dnstverb,
  pb_ind_kap_bij_overlijden_bron,
  pb_aop_TYPE,
  pb_aop_eindleeftijd,
  pb_aop_bedrag,
  pb_toeslag_variant,
  pb_toeslag_status,
  pb_maatstaf,
  pb_maximale_verhoging,
  pb_toeslag_jaar_t0,
  pb_toeslag_percentage_t0,
  pb_toeslag_jaar_t1,
  pb_toeslag_percentage_t1,
  pb_toeslag_jaar_t2,
  pb_toeslag_percentage_t2,
  pb_toeslag_jaar_t3,
  pb_toeslag_percentage_t3,
  pb_toeslag_jaar_t4,
  pb_toeslag_percentage_t4,
  pb_aan_pensioensoortcode,
  pb_aan_aanspraakstatuscode,
  pb_aan_bepaling_ing_uitk_code,
  pb_aan_ingangslftd_uitkering,
  pb_aan_ingangsdatum_uitkering,
  pb_aan_bepaling_eind_uitk_code,
  pb_aan_eindleeftijd_uitkering,
  pb_aan_einddatum_uitkering,
  pb_aan_omslag_code,
  pb_aan_herkomst_uitkering_code,
  pb_aan_leeftijd_omslag,
  pb_aan_datum_omslag,
  pb_aan_financiering_code,
  pb_aan_uitkering_bedrag,
  pb_aan_stijging_bedrag,
  pb_aan_stijging_percentage,
  pb_aan_stijging_TYPE,
  pb_aan_stijging_duur,
  pb_aan_aanvangsdatum_stijging,
  pb_aan_einddatum_tijd_stijging,
  pb_aan_flex_aow_min2,
  pb_aan_flex_aow,
  pb_aan_flex_aow_plus1,
  pb_aan_scenariomoment,
  pb_aan_stijging_tot_eindlftPARTNER,
  pb_aan_stijg_als_ovl_voor_lft,
  pb_aan_afwijkende_stijging_jn,
  pb_uit_uitkering_code,
  pb_uit_uitkering_duur,
  pb_uit_ingangslftd_uitkering,
  pb_uit_ingangsdatum_uitkering,
  pb_uit_bepaling_eind_uitk_code,
  pb_uit_eindleeftijd_uitkering,
  pb_uit_einddatum_uitkering,
  pb_uit_uitkering_bedrag,
  pb_uit_stijging_bedrag,
  pb_uit_stijging_percentage,
  pb_uit_stijging_TYPE,
  pb_uit_stijging_duur,
  pb_uit_aanvangsdatum_stijging,
  pb_uit_einddatum_tijd_stijging,
  pb_uit_uitk_status_code,
  pb_uit_scenariomoment,
  pb_uit_afwijkende_stijging_jn,
  h_status,
  tmp_pensioensoort,
  tmp_VZ_GROUP,
  tmp_VZ_GROUP_lat,
  tmp_VZ_GROUP_uit,
  verwdt_log,
  pb_ind_aanspraak_deletion,
  tmp_ind_kapitaal_bij_leven,
  tmp_ind_kapitaal_bij_overlijden,
  tmp_ind_PARTNER_is_exPARTNER,
  tmp_ind_recipient,
  tmp_ind_split_policy_divorce,
  tmp_overeenkomst_TYPE_step1,
  tmp_overeenkomst_TYPE_step2,
  tmp_overeenkomst_TYPE_step3,
  tmp_ind_err_211038,
  tmp_ind_err_211039,
  tmp_ind_err_211044,
  tmp_ind_err_211045,
  pb_werknemer_prod_part_to_date,
  CASE
    WHEN LEFT(tmp_overeenkomst_TYPE_step4, 2) = 'm5'
    THEN REPLACE(DATE_FORMAT(DATE_ADD(TO_DATE(reference_date, 'yyyy-MM-dd'), 1), 'yyyy-MM-dd'), '-','')
    ELSE reference_date
  END AS pb_polis_standdatum
FROM ovt_err_logic